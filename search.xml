<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[iOS Runloop æ·±å…¥æµ…å‡º]]></title>
    <url>%2F2018%2F07%2F28%2Fios-runloop%2F</url>
    <content type="text"><![CDATA[iOS Runloop æ·±å…¥æµ…å‡ºRunloopæ˜¯ä»€ä¹ˆï¼Ÿè‹¹æœå®˜æ–¹æ–‡æ¡£è§£é‡Šï¼š A run loop is a piece of infrastructure used to manage events arriving asynchronously on a thread. A run loop works by monitoring one or more event sources for the thread. As events arrive, the system wakes up the thread and dispatches the events to the run loop, which then dispatches them to the handlers you specify. If no events are present and ready to be handled, the run loop puts the thread to sleep. æ ¹æ®ä»¥ä¸Šè¿™ä¸ªæ®µè½ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾—çŸ¥ä¸€ä¸ªé‡è¦çš„ä¿¡æ¯ï¼ŒRunloopæ˜¯ç”¨æ¥å¤„ç†å¼‚æ­¥è¾¾åˆ°çº¿ç¨‹ä¸Šäº‹ä»¶çš„ä¸€ç§åŸºç¡€ç»“æ„ã€‚æ‰€ä»¥ï¼Œè¦æƒ³ç†è§£å¥½Runloopï¼Œæˆ‘ä»¬é¦–å…ˆå¾—æŠŠçº¿ç¨‹ç†è§£æ¸…æ¥šäº†ï¼Œè®¸å¤šåŒå­¦è·³è¿‡çº¿ç¨‹ç›´æ¥å»ç†è§£Runloop(æ›´ä¸å¯å–çš„æ˜¯æœ‰éƒ¨åˆ†åŒå­¦åªæ˜¯ä¸ºäº†åº”ä»˜é¢è¯•è€Œæ­»èƒŒç¡¬è®°Runloopç›¸å…³çŸ¥è¯†ï¼Œå¾€å¾€è¿‡åå°±å¿˜è®°äº†)ï¼Œå¾€å¾€æå¾—ä¸€å¤´é›¾æ°´ï¼Œä¸ç†è§£ä¸ºä»€ä¹ˆè¦æœ‰è¿™ç§ä¸œè¥¿ï¼Œå³ä½¿ç½‘ç»œä¸Šçœ‹äº†å‡ ç¯‡ç›´æ¥è®²è¿°Runloopå¹¶è´´æœ‰å¾ˆå¤šæºä»£ç åˆ†æçš„æ–‡ç« ï¼Œä¹Ÿå§‹ç»ˆæ²¡æœ‰ææ‡‚æ¥é¾™å»è„‰ã€‚è¦è®°ä½ï¼ŒRunloopä»…ä»…åªæ˜¯ç®¡ç†äº‹ä»¶å¼‚æ­¥è¾¾åˆ°çº¿ç¨‹çš„ä¸€ç§ç»“æ„è€Œå·²ï¼Œå…¶ç›®çš„æ˜¯è§£å†³å¤šçº¿ç¨‹ç®¡ç†ä¸­çš„é—®é¢˜ï¼ˆçº¿ç¨‹ç®¡ç†ä¸­ï¼Œè¿˜æœ‰å…¶ä»–æ‰‹æ®µå¯ä»¥å®ç°ç±»ä¼¼Runloopè¿™ç§æœºåˆ¶ï¼Œä¾‹å¦‚ä½¿ç”¨ä¿¡å·é‡, åªä¸è¿‡ä¾èµ–Runloopæ›´ä¸ºç®€å•ï¼‰ã€‚ çº¿ç¨‹å·ä¸ªæ‡’ï¼Œè¿˜æ˜¯å€Ÿç”¨è‹¹æœå®˜æ–¹æ–‡æ¡£çš„è§£é‡Šæ¥è§£é‡Šä»€ä¹ˆæ˜¯çº¿ç¨‹:] Each process (application) in OS X or iOS is made up of one or more threads, each of which represents a single path of execution through the applicationâ€™s code. Every application starts with a single thread, which runs the applicationâ€™s main function. Applications can spawn additional threads, each of which executes the code of a specific function. When an application spawns a new thread, that thread becomes an independent entity inside of the applicationâ€™s process space. Each thread has its own execution stack and is scheduled for runtime separately by the kernel. A thread can communicate with other threads and other processes, perform I/O operations, and do anything else you might need it to do. Because they are inside the same process space, however, all threads in a single application share the same virtual memory space and have the same access rights as the process itself. å¤§æ„å°±æ˜¯æ¯ä¸ªOS Xæˆ–è€…iOSæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½ä¼šä»¥ä¸€ä¸ªçº¿ç¨‹å¼€å§‹ï¼Œè¿™ä¸ªçº¿ç¨‹æ‰§è¡Œåº”ç”¨ç¨‹åºçš„mainæ–¹æ³•ã€‚åº”ç”¨ç¨‹åºå¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨åº”ç”¨ç¨‹åºå†…éƒ½ä¼šæœ‰ç‹¬ç«‹çš„å¤„ç†ç©ºé—´ã€å †æ ˆå¹¶ä¸”è¢«kernelåˆ†åˆ«åœ¨è¿è¡Œæ—¶å®‰æ’æ‰§è¡Œæ—¶é—´ã€‚ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä¸åŒè¿›ç¨‹å†…çš„å…¶ä»–çº¿ç¨‹é€šä¿¡ç”šè‡³å…¶ä»–è¿›ç¨‹ã€æ‰§è¡ŒI/Oæ“ä½œæˆ–è€…æ˜¯ä»»ä½•ä½ æƒ³è®©å®ƒåšçš„äº‹æƒ…ã€‚ ä¸ºä»€ä¹ˆéœ€è¦æœ‰çº¿ç¨‹ï¼Ÿåœ¨ä¼ ç»Ÿçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜åœ°å€ç©ºé—´å’Œä¸€ä¸ªç”¨äºæ§åˆ¶çš„çº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œç°åœ¨çš„æƒ…å†µæ›´å¤šçš„æƒ…å†µä¸‹è¦æ±‚åœ¨åŒä¸€åœ°å€ç©ºé—´ä¸‹æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚å› æ­¤çº¿ç¨‹è¢«å¼•å…¥æ“ä½œç³»ç»Ÿã€‚ å¦‚æœéè¦è¯´æ˜¯ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ï¼Œè¿˜ä¸å¦‚è¯´ä¸ºä»€ä¹ˆéœ€è¦è¿›ç¨‹ä¸­è¿˜æœ‰å…¶å®ƒè¿›ç¨‹ã€‚è¿™äº›è¿›ç¨‹ä¸­åŒ…å«çš„å…¶å®ƒè¿·ä½ è¿›ç¨‹å°±æ˜¯çº¿ç¨‹çº¿ç¨‹ä¹‹æ‰€ä»¥è¯´æ˜¯è¿·ä½ è¿›ç¨‹ï¼Œæ˜¯å› ä¸ºçº¿ç¨‹å’Œè¿›ç¨‹æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œæ¯”å¦‚çº¿ç¨‹å’Œè¿›ç¨‹çš„çŠ¶æ€éƒ½æœ‰è¿è¡Œï¼Œå°±ç»ªï¼Œé˜»å¡çŠ¶æ€ã€‚è¿™å‡ ç§çŠ¶æ€ç†è§£èµ·æ¥éå¸¸ç®€å•ï¼Œå½“è¿›ç¨‹æ‰€éœ€çš„èµ„æºæ²¡æœ‰åˆ°ä½æ—¶ä¼šæ˜¯é˜»å¡çŠ¶æ€ï¼Œå½“è¿›ç¨‹æ‰€éœ€çš„èµ„æºåˆ°ä½æ—¶ä½†CPUæ²¡æœ‰åˆ°ä½æ—¶æ˜¯å°±ç»ªçŠ¶æ€ï¼Œå½“è¿›ç¨‹æ—¢æœ‰æ‰€éœ€çš„èµ„æºï¼Œåˆæœ‰CPUæ—¶ï¼Œå°±ä¸ºè¿è¡ŒçŠ¶æ€ã€‚ å‡è®¾æ²¡æœ‰çº¿ç¨‹ï¼Œç›¸å½“äºè¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå¾ˆå¤šæƒ…å†µä¸‹çš„ç”¨æˆ·ä½“éªŒæ˜¯æ— æ³•æ¥å—çš„ã€‚æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œä½¿ç”¨iPhoneæ‹æ‘„è§†é¢‘æˆ–è€…ç…§ç‰‡åï¼Œç›¸æœºappéœ€è¦å°†ç…§ç‰‡æˆ–è€…è§†é¢‘å†™å…¥ç£ç›˜ï¼Œè€Œè®¿é—®ç£ç›˜çš„æ—¶é—´å†…çº¿ç¨‹æ˜¯é˜»å¡çš„ï¼Œè¿™ä¸ªæ—¶å€™åœ¨ç›¸æœºappæ— è®ºæ‰§è¡Œä»€ä¹ˆæ“ä½œéƒ½ä¸ä¼šç›¸åº”ï¼Œå› ä¸ºä»…æœ‰çš„çº¿ç¨‹åœ¨å¿™ç€å¤„ç†æ•°æ®å†™å…¥å‘¢ã€‚è€Œå¦‚æœå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä»…ä»…éœ€è¦å¤„ç†è‡ªå·±é‚£ä¸€éƒ¨åˆ†åº”è¯¥å®Œæˆçš„ä»»åŠ¡ï¼Œè€Œä¸ç”¨å»å…³å¿ƒå’Œå…¶ä»–çº¿ç¨‹çš„å†²çªï¼Œå› æ­¤ç®€åŒ–äº†ç¼–ç¨‹æ¨¡å‹ã€‚ åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨NSThreadåˆ›å»ºçº¿ç¨‹ 123456789101112131415- (void)viewDidLoad &#123; [super viewDidLoad]; self.thread = [[NSThread alloc] initWithTarget:self selector:@selector(onThreadStart:) object:nil]; self.thread.name = @"myThread"; [self.thread start];&#125;- (void)onThreadStart:(id)args &#123; NSLog(@"Execution in thread [%@]", [NSThread currentThread].name);&#125;- (void)persistVideoClips &#123; //è¿™é‡Œæœ‰å­˜å‚¨è§†é¢‘ä¿¡æ¯çš„ä»£ç &#125; å¯ä»¥çœ‹åˆ°æ§åˆ¶å°æ‰“å°Execution in thread [myThread] ä½¿ç”¨çº¿ç¨‹ç»§ç»­å‰é¢è®²çš„å­˜å‚¨è§†é¢‘çš„ä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ç•Œé¢åŠ ä¸Šä¸€ä¸ªæŒ‰é’®ï¼Œæ¯æ¬¡ç‚¹å‡»å°±ä½¿ç”¨çº¿ç¨‹æ¨¡æ‹Ÿä¿å­˜è§†é¢‘(ä¹Ÿè®¸ä½ ä¼šè¯´ï¼Œå¯ä»¥ä½¿ç”¨GCDæˆ–è€…NSOperationQueueæ¥å®Œæˆå•Šï¼å¯¹ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªä¹Ÿéƒ½æ˜¯è‹¹æœæä¾›çš„å¤šçº¿ç¨‹ç®¡ç†åº“ï¼Œæˆ‘ä»¬è¦ç ”ç©¶ä¸ºä»€ä¹ˆè‹¹æœå¼•å…¥Runloopå°±éœ€è¦ä»çº¿ç¨‹ä¸Šå»è€ƒè™‘)ã€‚ 123456789101112131415161718- (void)viewDidLoad &#123; [super viewDidLoad]; self.videoClips = [NSMutableArray array];&#125;- (IBAction)onButtonTapped:(id)sender &#123; self.thread = [[NSThread alloc] initWithTarget:self selector:@selector(onThreadStart:) object:[self.videoClips copy]]; self.thread.name = @"myThread"; [self.thread start];&#125;- (void)onThreadStart:(id)args &#123; //è¿™é‡Œæœ‰å­˜å‚¨è§†é¢‘ä¿¡æ¯çš„ä»£ç  @autoreleasepool &#123; NSLog(@"Execution in thread [%@]", [NSThread currentThread].name); NSLog(@"saving video clips"); &#125;&#125; è¿™ç§æ–¹å¼æ˜¯å¼ºçƒˆä¸æ¨èçš„ï¼Œæƒ³å¿…ä¹Ÿæ²¡æœ‰äººä¼šè¿™ä¹ˆå¹²ï¼Œå› ä¸ºçº¿ç¨‹çš„åˆ›å»ºæ˜¯æ˜‚è´µçš„ã€‚ Threading has a real cost to your program (and the system) in terms of memory use and performance. Each thread requires the allocation of memory in both the kernel memory space and your programâ€™s memory space. The core structures needed to manage your thread and coordinate its scheduling are stored in the kernel using wired memory. Your threadâ€™s stack space and per-thread data is stored in your programâ€™s memory space. Most of these structures are created and initialized when you first create the threadâ€”a process that can be relatively expensive because of the required interactions with the kernel. ä¸ºäº†è§£å†³æ¶ˆè€—è¿™ä¸ªé—®é¢˜ï¼Œèªæ˜çš„äººå¯¹çº¿ç¨‹è¿›è¡Œäº†å°è£…ï¼Œä½¿ç”¨ç»§æ‰¿å®ç°äº†è‡ªå·±çš„LCThread 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778/** * LCThread.h */ typedef void (^LCActionBlock)(void);@interface LCThread : NSThread- (void)queueAction:(LCActionBlock)action;@end/** * LCThread.m */#import "LCThread.h"@interface LCThread ()@property (strong, nonatomic) NSMutableArray&lt;LCActionBlock&gt; *actions;@property (strong, nonatomic) NSObject *mutex;@end@implementation LCThread- (instancetype)init&#123; self = [super init]; if (self) &#123; _actions = [NSMutableArray array]; _mutex = [NSObject new]; &#125; return self;&#125;- (void)queueAction:(LCActionBlock)action &#123; @synchronized(self.mutex) &#123; [self.actions addObject:[action copy]]; &#125;&#125;- (void)main &#123; while (true) &#123; @autoreleasepool &#123; @synchronized(self.mutex) &#123; NSArray&lt;LCActionBlock&gt; *actions = [self.actions copy]; [self.actions removeAllObjects]; [actions enumerateObjectsUsingBlock:^(LCActionBlock _Nonnull action, NSUInteger idx, BOOL * _Nonnull stop) &#123; @try &#123; action(); &#125; @catch(NSException *error) &#123; NSLog(@"error occurred: %@", error); &#125; &#125;]; &#125; &#125; [NSThread sleepForTimeInterval:0.3]; &#125;&#125;@end/* * ä¸»ç•Œé¢ä»£ç  */- (void)viewDidLoad &#123; [super viewDidLoad]; self.thread = [LCThread new]; self.thread.name = @"myThread"; [self.thread start];&#125;- (IBAction)onButtonTapped:(id)sender &#123; [self.thread queueAction:^&#123; NSLog(@"Execution in thread [%@]", [NSThread currentThread].name); NSLog(@"saving video clips"); &#125;];&#125; ç°åœ¨ç‚¹å‡»æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°video clipsæ­£ç¡®åœ°åœ¨æˆ‘ä»¬åˆ›å»ºçš„çº¿ç¨‹ä¸­è°ƒç”¨ï¼ŒåŸºæœ¬è¾¾åˆ°æˆ‘ä»¬è®©ä¿å­˜è§†é¢‘çš„ä»£ç åœ¨åå°çº¿ç¨‹æ‰§è¡Œçš„ç›®çš„ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰ç¼ºç‚¹ï¼š ä¸ºäº†è®©çº¿ç¨‹ä¸€ç›´è¿è¡Œä½†åˆä¸å æ»¡CPUæ—¶é—´ï¼Œæˆ‘ä»¬å¼•å…¥äº†[NSThread sleepForTimeInterval:0.3]ï¼Œäººä¸ºåœ°è®©çº¿ç¨‹â€œæ´»ç€â€ å³ä½¿actionsä¸ºç©ºï¼Œçº¿ç¨‹ä¹Ÿéœ€è¦ä»ä¼‘çœ ä¸­é†’æ¥æ£€æŸ¥è¿˜æœ‰æ²¡æœ‰éœ€è¦å¤„ç†çš„actionï¼Œå¸¦æ¥äº†æ— æ„ä¹‰çš„æ¶ˆè€— æ— æ³•éšå¿ƒæ‰€æ¬²åœ°å”¤é†’çº¿ç¨‹ï¼Œåªèƒ½è¢«åŠ¨ç­‰å¾…çº¿ç¨‹ä¼‘çœ è¶³å¤Ÿé•¿çš„æ—¶é—´ æ— æ³•å¯¹LCThreadä½¿ç”¨performSelector:onThread:withObject:waitUntilDoneç­‰æ–¹æ³• ä¸ºäº†è§£å†³åŒ…æ‹¬è¿™ä¸ªä¾‹å­é‡åˆ°çš„é—®é¢˜ï¼Œè‹¹æœå¼•å…¥äº†Runloopçš„å®ç°ã€‚ Runloopç°åœ¨å†æ¥æ‹œè¯»ä¸€ä¸‹è‹¹æœå¯¹Runloopçš„è§£é‡Š Run loops are part of the fundamental infrastructure associated with threads. A run loop is an event processing loop that you use to schedule work and coordinate the receipt of incoming events. The purpose of a run loop is to keep your thread busy when there is work to do and put your thread to sleep when there is none. è¿™ä¸æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¹ˆï¼Ÿå½“æœ‰å·¥ä½œéœ€è¦çº¿ç¨‹åšçš„æ—¶å€™ï¼Œå°±è®©å®ƒå¹²æ´»ï¼Œä¸éœ€è¦å®ƒçš„æ—¶å€™ï¼Œå°±è®©å®ƒä¼‘æ¯å»ã€‚â€œå¬ä¹‹å³æ¥æŒ¥ä¹‹å³å»â€ï¼Œåœ¨ä¼‘çœ æ—¶å‡ ä¹ä¸å ç”¨ç³»ç»Ÿèµ„æºã€‚ å°è¯•ä½¿ç”¨Runloopè‹¹æœä¸å…è®¸ç›´æ¥åˆ›å»ºRunloopï¼Œå®ƒåªæä¾›äº†ä¸¤ä¸ªè‡ªåŠ¨è·å–çš„å‡½æ•°ï¼šCFRunloopGetMain()å’ŒCFRunloopGetCurrent()ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738/// å…¨å±€çš„Dictionaryï¼Œkey æ˜¯ pthread_tï¼Œ value æ˜¯ CFRunLoopRefstatic CFMutableDictionaryRef loopsDic;/// è®¿é—® loopsDic æ—¶çš„é”static CFSpinLock_t loopsLock; /// è·å–ä¸€ä¸ª pthread å¯¹åº”çš„ RunLoopã€‚CFRunLoopRef _CFRunLoopGet(pthread_t thread) &#123; OSSpinLockLock(&amp;loopsLock); if (!loopsDic) &#123; // ç¬¬ä¸€æ¬¡è¿›å…¥æ—¶ï¼Œåˆå§‹åŒ–å…¨å±€Dicï¼Œå¹¶å…ˆä¸ºä¸»çº¿ç¨‹åˆ›å»ºä¸€ä¸ª RunLoopã€‚ loopsDic = CFDictionaryCreateMutable(); CFRunLoopRef mainLoop = _CFRunLoopCreate(); CFDictionarySetValue(loopsDic, pthread_main_thread_np(), mainLoop); &#125; /// ç›´æ¥ä» Dictionary é‡Œè·å–ã€‚ CFRunLoopRef loop = CFDictionaryGetValue(loopsDic, thread)); if (!loop) &#123; /// å–ä¸åˆ°æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª loop = _CFRunLoopCreate(); CFDictionarySetValue(loopsDic, thread, loop); /// æ³¨å†Œä¸€ä¸ªå›è°ƒï¼Œå½“çº¿ç¨‹é”€æ¯æ—¶ï¼Œé¡ºä¾¿ä¹Ÿé”€æ¯å…¶å¯¹åº”çš„ RunLoopã€‚ _CFSetTSD(..., thread, loop, __CFFinalizeRunLoop); &#125; OSSpinLockUnLock(&amp;loopsLock); return loop;&#125; CFRunLoopRef CFRunLoopGetMain() &#123; return _CFRunLoopGet(pthread_main_thread_np());&#125; CFRunLoopRef CFRunLoopGetCurrent() &#123; return _CFRunLoopGet(pthread_self());&#125; ç°åœ¨å°±è®©æˆ‘ä»¬åœ¨åˆ›å»ºçš„çº¿ç¨‹ä¸­ä½¿ç”¨å®ƒå§ 123456789101112131415161718- (void)viewDidLoad &#123; [super viewDidLoad]; self.videoClips = [NSMutableArray array]; self.thread = [[NSThread alloc] initWithBlock:^&#123; NSLog(@"Execution in thread [%@]", [NSThread currentThread].name); [[NSRunLoop currentRunLoop] run]; &#125;]; self.thread.name = @"myThread"; [self.thread start];&#125;- (IBAction)onButtonTapped:(id)sender &#123; [self performSelector:@selector(persistVideoClips:) onThread:self.thread withObject:[self.videoClips copy] waitUntilDone:NO];&#125;- (void)persistVideoClips:(NSArray *)clips &#123; NSLog(@"saving video clips");&#125; å•Šå•Šå•Š~ï¼æŒ‰ç…§æˆ‘ä»¬é¢„æƒ³çš„ç»“æœï¼Œè¿è¡Œä»¥åæ¯æ¬¡ç‚¹å‡»å±å¹•éƒ½åº”è¯¥æœ‰è¾“å‡ºï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬ç‚¹å‡»å±å¹•å¹¶æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œæ²¡æœ‰æ‰“å°saving video clipsã€‚ æ ¹æ®è‹¹æœå®˜æ–¹æ–‡æ¡£ - Starting the Run loopçš„è§£é‡Š A run loop must have at least one input source or timer to monitor. If one is not attached, the run loop exits immediately. å› ä¸ºæ²¡æœ‰input sourceæˆ–è€…timer sourceï¼Œæ‰€ä»¥Runloopåœ¨å¯åŠ¨åå°±ç«‹å³é€€å‡ºäº†ã€‚ æ·±å…¥Runloopä¸å¯¹Runloopä¸€ç•ªäº†è§£ï¼Œå¾ˆéš¾é©¾é©­ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å…ˆæ¥ç†Ÿæ‚‰ç†Ÿæ‚‰Runloopã€‚Runloopåœ¨æºä»£ç ä¸­ä½“ç°ä¸ºä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡çš„æ˜¯NSRunloopæˆ–è€…CFRunloopRefï¼ŒCFRunloopRefæ˜¯åœ¨ CoreFoundation æ¡†æ¶å†…çš„ï¼Œå®ƒæä¾›äº†çº¯Cçš„å‡½æ•°APIï¼Œæ‰€æœ‰è¿™äº› API éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒNSRunloopä»…ä»…æ˜¯CFRunloopRefçš„objective-cçš„å°è£…ï¼Œæä¾›äº†é¢å‘å¯¹è±¡çš„ APIï¼Œä½†æ˜¯è¿™äº› API ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚CFRunLoopRef çš„ä»£ç æ˜¯å¼€æºçš„ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œhttp://opensource.apple.com/tarballs/CF/ä¸‹è½½åˆ°æ•´ä¸ª CoreFoundation çš„æºç æ¥æŸ¥çœ‹ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥é€šè¿‡ä»£ç æ¥äº†è§£å®ƒçš„å†…éƒ¨é€»è¾‘(ä¸ºäº†é˜…è¯»æ–¹ä¾¿ï¼Œæå–äº†é‡è¦çš„éƒ¨åˆ†å±•ç¤ºï¼Œå¦‚æœä¸æƒ³é˜…è¯»å¯ä»¥ç›´æ¥è·³è¿‡çœ‹åé¢çš„æµç¨‹å›¾)ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133//ä½¿ç”¨kCFRunLoopDefaultModeå¯åŠ¨Runloopvoid CFRunLoopRun(void) &#123; /* DOES CALLOUT */ int32_t result; do &#123; result = CFRunLoopRunSpecific(CFRunLoopGetCurrent(), kCFRunLoopDefaultMode, 1.0e10, false); CHECK_FOR_FORK(); &#125; while (kCFRunLoopRunStopped != result &amp;&amp; kCFRunLoopRunFinished != result);&#125;//ä½¿ç”¨æŒ‡å®šçš„modeå¯åŠ¨RunloopSInt32 CFRunLoopRunInMode(CFStringRef modeName, CFTimeInterval seconds, Boolean returnAfterSourceHandled) &#123; /* DOES CALLOUT */ CHECK_FOR_FORK(); return CFRunLoopRunSpecific(CFRunLoopGetCurrent(), modeName, seconds, returnAfterSourceHandled);&#125;SInt32 CFRunLoopRunSpecific(runloop, modeName, seconds, returnAfterSourceHandled) &#123; /* DOES CALLOUT */ if (__CFRunLoopIsDeallocating(runloop)) return kCFRunLoopRunFinished; //é¦–å…ˆæ ¹æ®modeNameæ‰¾åˆ°å¯¹åº”çš„mode CFRunLoopModeRef currentMode = __CFRunLoopFindMode(runloop, modeName, false); //å¦‚æœmodeä¸ºç©ºï¼Œæˆ–è€…modeé‡Œé¢æ²¡æœ‰[sources,timers,observers]ç›´æ¥è¿”å› if (NULL == currentMode || __CFRunLoopModeIsEmpty(runloop, currentMode, runloop-&gt;_currentMode)) &#123; return kCFRunLoopRunFinished; &#125; int32_t result = kCFRunLoopRunFinished; //é€šçŸ¥observersï¼Œå³å°†è¿›å…¥loop if (currentMode-&gt;_observerMask &amp; kCFRunLoopEntry ) __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopEntry); //è°ƒç”¨å†…éƒ¨å‡½æ•°è¿›å…¥loop result = __CFRunLoopRun(runloop, currentMode, seconds, returnAfterSourceHandled, previousMode); //é€šçŸ¥observersï¼ŒRunloopå³å°†é€€å‡º if (currentMode-&gt;_observerMask &amp; kCFRunLoopExit ) __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopExit); return result;&#125;//è¿›å…¥loopçš„å†…éƒ¨å‡½æ•°static int32_t __CFRunLoopRun(runloop, currentMode, seconds, stopAfterHandle) &#123; int32_t retVal = 0; Boolean isTimerSource = false; //è·å¾—timerçš„port mach_port_name_t timerPort = MACH_PORT_NULL; if (runloop-&gt;_queue) &#123; timerPort = _dispatch_runloop_root_queue_get_port_4CF(runloop-&gt;_queue); if (!timerPort) &#123; CRASH("Unable to get port for run loop mode queue (%d)", -1); &#125; &#125; do &#123; // 2. é€šçŸ¥ Observers: RunLoop å³å°†è§¦å‘ Timer å›è°ƒã€‚ __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeTimers); // 3. é€šçŸ¥ Observers: RunLoop å³å°†è§¦å‘ Source0 (éport) å›è°ƒã€‚ __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeSources); // æ‰§è¡Œè¢«åŠ å…¥çš„block __CFRunLoopDoBlocks(runloop, currentMode); // 4. RunLoop è§¦å‘ Source0 (éport) å›è°ƒã€‚ Boolean sourceHandledThisLoop = __CFRunLoopDoSources0(runloop, currentMode, stopAfterHandle); if (sourceHandledThisLoop) &#123; __CFRunLoopDoBlocks(runloop, currentMode); &#125; //5. å¦‚æœæœ‰ Source1 (åŸºäºport) å¤„äº ready çŠ¶æ€ï¼Œç›´æ¥å¤„ç†è¿™ä¸ª Source1 ç„¶åè·³è½¬å»9 if (MACH_PORT_NULL != dispatchPort &amp;&amp; !didDispatchPortLastTime) &#123; msg = (mach_msg_header_t *)msg_buffer; if (__CFRunLoopServiceMachPort(dispatchPort, &amp;msg, sizeof(msg_buffer), &amp;livePort, 0, &amp;voucherState, NULL)) &#123; goto handle_msg; &#125; &#125; // é€šçŸ¥ Observers: RunLoopçš„çº¿ç¨‹å³å°†è¿›å…¥ä¼‘çœ  if (!sourceHandledThisLoop) &#123; __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeWaiting); &#125; // 7. è°ƒç”¨ mach_msg ç­‰å¾…æ¥å— mach_port çš„æ¶ˆæ¯ã€‚çº¿ç¨‹å°†è¿›å…¥ä¼‘çœ , ç›´åˆ°è¢«ä¸‹é¢æŸä¸€ä¸ªäº‹ä»¶å”¤é†’ã€‚ // â€¢ ä¸€ä¸ªåŸºäº port çš„Source çš„äº‹ä»¶ã€‚ // â€¢ ä¸€ä¸ª Timer åˆ°æ—¶é—´äº† // â€¢ RunLoop è‡ªèº«çš„è¶…æ—¶æ—¶é—´åˆ°äº† // â€¢ è¢«å…¶ä»–ä»€ä¹ˆè°ƒç”¨è€…æ‰‹åŠ¨å”¤é†’ __CFRunLoopServiceMachPort(waitSet, &amp;msg, sizeof(msg_buffer), &amp;livePort, poll ? 0 : TIMEOUT_INFINITY, &amp;voucherState, &amp;voucherCopy); isTimerSource = timerPort != MACH_PORT_NULL &amp;&amp; livePort == timerPort; // 8. é€šçŸ¥ Observers: Runloopçš„çº¿ç¨‹åˆšåˆšè¢«å”¤é†’äº† __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopAfterWaiting); handle_msg: // 9.1 å¦‚æœæ˜¯timerå”¤é†’ï¼Œè§¦å‘è¿™ä¸ªTimerçš„å›è°ƒã€‚ if(isTimerSource) &#123; __CFRunLoopDoTimers(runloop, currentMode, mach_absolute_time() //9.2 å¦‚æœæ˜¯main dispatchçš„å”¤é†’ï¼Œæ‰§è¡Œblock &#125; else if(msg_is_dispatch) &#123; __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(msg); //9.3 å¦‚æœä¸€ä¸ª Source1 (åŸºäºport) å”¤é†’ï¼Œå¤„ç†source1 &#125; else &#123; CFRunLoopSourceRef source1 = __CFRunLoopModeFindSourceForMachPort(runloop, currentMode, livePort); sourceHandledThisLoop = __CFRunLoopDoSource1(runloop, currentMode, source1, msg); if (sourceHandledThisLoop) &#123; mach_msg(reply, MACH_SEND_MSG, reply); &#125; &#125; // å†æ¬¡ç¡®ä¿æ˜¯å¦æœ‰åŒæ­¥çš„æ–¹æ³•éœ€è¦è°ƒç”¨ __CFRunLoopDoBlocks(runloop, currentMode); if (sourceHandledThisLoop &amp;&amp; stopAfterHandle) &#123; // è¿›å…¥loopæ—¶å‚æ•°è¯´å¤„ç†å®Œäº‹ä»¶å°±è¿”å›ã€‚ retVal = kCFRunLoopRunHandledSource; &#125; else if (timeout) &#123; // è¶…å‡ºä¼ å…¥å‚æ•°æ ‡è®°çš„è¶…æ—¶æ—¶é—´äº† retVal = kCFRunLoopRunTimedOut; &#125; else if (__CFRunLoopIsStopped(runloop)) &#123; // è¢«å¤–éƒ¨è°ƒç”¨è€…å¼ºåˆ¶åœæ­¢äº† retVal = kCFRunLoopRunStopped; &#125; else if (currentMode-&gt;_stopped) &#123; // currentMode è¢«å¼ºåˆ¶åœæ­¢ï¼Œè°ƒç”¨å†…éƒ¨_CFRunLoopStopMode currentMode-&gt;_stopped = false; retVal = kCFRunLoopRunStopped; &#125; else if (__CFRunLoopModeIsEmpty(runloop, currentMode)) &#123; // source/timer/observerä¸€ä¸ªéƒ½æ²¡æœ‰äº† retVal = kCFRunLoopRunFinished; &#125; &#125; while(0 == retVal); return retVal;&#125; é€šè¿‡ä¸Šé¢çš„ä¼ªä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸ŠRunloopå°±æ˜¯å†…éƒ¨æ˜¯ä¸€ä¸ªdo-whileè°ƒç”¨çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ç®¡ç†çº¿ç¨‹éœ€è¦å¤„ç†çš„äº‹ä»¶å’Œæ¶ˆæ¯ï¼Œå¹¶åœ¨æ²¡æœ‰å¤„ç†æ¶ˆæ¯æ—¶ä¼‘çœ ä»¥é¿å…å ç”¨ç³»ç»Ÿèµ„æºï¼Œåœ¨æœ‰æ¶ˆæ¯åˆ°æ¥æ—¶ç«‹åˆ»è¢«å”¤é†’ã€‚çº¿ç¨‹æ‰§è¡Œäº†Runloopåï¼Œå…¶å†…éƒ¨å°±ä¼šä¸€ç›´å¤„äºæ¥æ”¶æ¶ˆæ¯-&gt;ä¼‘çœ -&gt;å¤„ç†æ¶ˆæ¯çš„å¾ªç¯ä¸­ï¼Œç›´åˆ°å¾ªç¯ç»“æŸæ¡ä»¶æ»¡è¶³æ‰ä¼šé€€å‡ºï¼Œç»“æŸçº¿ç¨‹ã€‚ ä¸‹å›¾å±•ç¤ºäº†Runloopè¿è¡Œæ—¶çš„å…³é”®æµç¨‹ï¼š é€šè¿‡ä»£ç å’Œæµç¨‹å›¾æˆ‘ä»¬æœ‰äº†åˆæ­¥çš„äº†è§£ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ç§ç¥ç§˜çš„æ„Ÿè§‰ï¼Œåˆ«æ€¥ï¼Œæ¥ä¸‹æ¥å°±ä¸ºæ‚¨ä¸€ä¸€ä»‹ç»ä»€ä¹ˆæ˜¯modeï¼Œsource, observerså’Œcalloutsã€‚ Runloop modesä»æºç å¾ˆå®¹æ˜“çœ‹å‡ºï¼ŒRunloopæ€»æ˜¯è¿è¡Œåœ¨æŸç§ç‰¹å®šçš„CFRunLoopModeRefä¸‹ï¼Œæ¯æ¬¡è¿è¡ŒCFRunLoopRunå‡½æ•°æ—¶å¿…é¡»æŒ‡å®šä¸€ç§Modeï¼Œè¿™ä¸ªmodeç§°ä¸ºcurrent modeã€‚é€šè¿‡CFRunloopRefçš„ç»“æ„ä½“å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªRunloopå¯ä»¥åŒ…å«Nä¸ªmodesï¼Œæ¯ä¸ªmodeåˆå¯ä»¥åŒ…å«è‹¥å¹²ä¸ªSources/Timers/Observersã€‚å½“åˆ‡æ¢Modeæ—¶å¿…é¡»é€€å‡ºcurrent modeï¼Œç„¶åå†é‡æ–°è¿›å…¥ã€‚ CFRunloopModeå’ŒCFRunloopçš„ç»“æ„å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849struct __CFRunLoopMode &#123; CFRuntimeBase _base; pthread_mutex_t _lock; /* must have the run loop locked before locking this */ CFStringRef _name; Boolean _stopped; char _padding[3]; CFMutableSetRef _sources0; // source0 CFMutableSetRef _sources1; // source1 CFMutableArrayRef _observers; CFMutableArrayRef _timers; CFMutableDictionaryRef _portToV1SourceMap; __CFPortSet _portSet; CFIndex _observerMask;#if USE_DISPATCH_SOURCE_FOR_TIMERS dispatch_source_t _timerSource; dispatch_queue_t _queue; Boolean _timerFired; // set to true by the source when a timer has fired Boolean _dispatchTimerArmed;#endif#if USE_MK_TIMER_TOO mach_port_t _timerPort; Boolean _mkTimerArmed;#endif#if DEPLOYMENT_TARGET_WINDOWS DWORD _msgQMask; void (*_msgPump)(void);#endif uint64_t _timerSoftDeadline; /* TSR */ uint64_t _timerHardDeadline; /* TSR */&#125;; struct __CFRunLoop &#123; CFRuntimeBase _base; pthread_mutex_t _lock; /* locked for accessing mode list */ __CFPort _wakeUpPort; // used for CFRunLoopWakeUp Boolean _unused; volatile _per_run_data *_perRunData; // reset for runs of the run loop pthread_t _pthread; uint32_t _winthread; CFMutableSetRef _commonModes; CFMutableSetRef _commonModeItems; CFRunLoopModeRef _currentMode; CFMutableSetRef _modes; struct _block_item *_blocks_head; struct _block_item *_blocks_tail; CFAbsoluteTime _runTime; CFAbsoluteTime _sleepTime; CFTypeRef _counterpart;&#125;; Common Modesä¸€ä¸ª Mode å¯ä»¥å°†è‡ªå·±æ ‡è®°ä¸º&quot;Common&quot;å±æ€§ï¼ˆé€šè¿‡å°†å…¶ ModeName æ·»åŠ åˆ°RunLoopçš„ _commonModes ä¸­ï¼‰ã€‚æ¯å½“ RunLoopçš„å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒRunLoopéƒ½ä¼šè‡ªåŠ¨å°†_commonModeItemsé‡Œçš„ Source/Observer/Timer åŒæ­¥åˆ°å…·æœ‰ â€œCommonâ€ æ ‡è®°çš„æ‰€æœ‰Modeé‡Œã€‚ åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼šä¸»çº¿ç¨‹çš„RunLoopé‡Œæœ‰ä¸¤ä¸ªé¢„ç½®çš„ Modeï¼škCFRunLoopDefault Mode å’Œ UITrackingRunLoopModeã€‚è¿™ä¸¤ä¸ª Mode éƒ½å·²ç»è¢«æ ‡è®°ä¸ºâ€Commonâ€å±æ€§ã€‚DefaultMode æ˜¯ App å¹³æ—¶æ‰€å¤„çš„çŠ¶æ€ï¼ŒTrackingRunLoopMode æ˜¯è¿½è¸ª ScrollView æ»‘åŠ¨æ—¶çš„çŠ¶æ€ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ª Timer å¹¶åŠ åˆ° DefaultModeæ—¶ï¼ŒTimerä¼šå¾—åˆ°é‡å¤å›è°ƒï¼Œä½†æ­¤æ—¶æ»‘åŠ¨ä¸€ä¸ªTableViewæ—¶ï¼ŒRunLoopä¼šå°† mode åˆ‡æ¢ä¸º TrackingRunLoopModeï¼Œè¿™æ—¶ Timer å°±ä¸ä¼šè¢«å›è°ƒï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå½±å“åˆ°æ»‘åŠ¨æ“ä½œã€‚å¦‚æœä½ æƒ³è®©è¿™ä¸ªTimerï¼Œåœ¨ä¸¤ä¸ª Mode ä¸­éƒ½èƒ½å¾—åˆ°å›è°ƒï¼Œæœ‰ä¸‰ç§åŠæ³•ï¼š å°†è¿™ä¸ªTimeråˆ†åˆ«åŠ å…¥è¿™ä¸¤ä¸ª Mode å°†TimeråŠ å…¥åˆ°é¡¶å±‚çš„ RunLoop çš„ â€œcommonModeItemsâ€ ä¸­ã€‚â€commonModeItemsâ€ è¢« RunLoop è‡ªåŠ¨æ›´æ–°åˆ°æ‰€æœ‰å…·æœ‰â€Commonâ€å±æ€§çš„ Mode é‡Œå» å°†TimeråŠ å…¥åˆ°kCFRunLoopCommonModesï¼ˆåé¢å°èŠ‚ä¼šæåˆ°ï¼‰é‡Œé¢ å¸¸è§modesä»‹ç» NSDefaultRunLoopModeï¼šAppçš„é»˜è®¤ Modeã€‚è¿™ä¸ªmodeåº”è¯¥ç”¨åœ¨çº¿ç¨‹é»˜è®¤ã€ç©ºé—²å’Œç­‰å¾…äº‹ä»¶æ—¶ã€‚ UITrackingRunLoopModeï¼šç•Œé¢è·Ÿè¸ª Modeï¼Œç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»– Mode å½±å“ UIInitializationRunLoopModeï¼š åœ¨åˆšå¯åŠ¨ App æ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª Modeï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨ GSEventReceiveRunLoopModeï¼š æ¥å—ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨ Modeï¼Œé€šå¸¸ç”¨ä¸åˆ° NSRunLoopCommonModesï¼šé€šè¿‡å°†å¯¹è±¡ï¼ˆtimer/source/observerï¼‰é€šè¿‡CFRunLoopAddCommonModeåŠ å…¥åˆ°Runloopåï¼Œèƒ½å¤Ÿè¢«åŒæ­¥åˆ°æ‰€æœ‰æ ‡è®°ä¸º&quot;common&quot;çš„modesé‡Œ å¸¸ç”¨æ¥å£1234567891011121314151617181920212223///å°†ä¸€ä¸ªmodeåŠ å…¥åˆ°common modesçš„seté‡Œé¢CFRunLoopAddCommonMode(CFRunLoopRef runloop, CFStringRef modeName);///ä»¥æŒ‡å®šmodeåœ¨å½“å‰çº¿ç¨‹å¯åŠ¨runloopCFRunLoopRunResult CFRunLoopRunInMode(CFRunLoopMode mode, CFTimeInterval seconds, Boolean returnAfterSourceHandled);///æ·»åŠ ä¸€ä¸ªsourceåˆ°æŒ‡å®šçš„modeCFRunLoopAddSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFStringRef modeName);///åˆ¤æ–­æŒ‡å®šçš„modeæ˜¯å¦åŒ…å«ä¼ å…¥çš„sourceCFRunLoopContainsSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFRunLoopMode mode);///å°†ä¸€ä¸ªsourceä»æŒ‡å®šmodeä¸­ç§»é™¤CFRunLoopRemoveSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFStringRef modeName);///æ·»åŠ ä¸€ä¸ªobserveråˆ°æŒ‡å®šçš„modeCFRunLoopAddObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFStringRef modeName);///åˆ¤æ–­æŒ‡å®šçš„modeæ˜¯å¦åŒ…å«ä¼ å…¥çš„observerCFRunLoopContainsObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFRunLoopMode mode);///å°†ä¸€ä¸ªobserverä»æŒ‡å®šmodeä¸­ç§»é™¤CFRunLoopRemoveObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFStringRef modeName);///æ·»åŠ ä¸€ä¸ªtimeråˆ°æŒ‡å®šçš„modeCFRunLoopAddTimer(CFRunLoopRef rl, CFRunLoopTimerRef timer, CFStringRef mode);///å°†timerä»æŒ‡å®šçš„modeä¸­ç§»é™¤CFRunLoopRemoveTimer(CFRunLoopRef rl, CFRunLoopTimerRef timer, CFStringRef mode); SourcesSourcesæ˜¯ç”¨æ¥å”¤é†’Runloopçš„çº¿ç¨‹çš„ CFRunLoopSourceRefCFRunLoopSourceRefå¯¹åº”ä¸¤ç§æº: source0å’Œsource1ã€‚å…¶ä¸­Source1å’ŒTimer sourceéƒ½å±äºç«¯å£äº‹ä»¶æºï¼Œä¸åŒçš„æ˜¯æ‰€æœ‰çš„Timeréƒ½å…±ç”¨ä¸€ä¸ªç«¯å£ï¼Œè€Œæ¯ä¸ªsource1éƒ½æœ‰è‡ªå·±çš„ç«¯å£ã€‚ source0ï¼šè´Ÿè´£appå†…éƒ¨äº‹ä»¶ï¼ŒåªåŒ…å«ä¸€ä¸ªå›è°ƒå‡½æ•°æŒ‡é’ˆï¼Œä¸èƒ½ä¸»åŠ¨è§¦å‘äº‹ä»¶ã€‚ä½¿ç”¨æ—¶ï¼Œéœ€è¦å…ˆè°ƒç”¨CFRunLoopSourceSignal(source),å°†è¿™ä¸ªSourceæ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œç„¶åæ‰‹åŠ¨è°ƒç”¨ CFRunLoopWakeUp(runloop) æ¥å”¤é†’ RunLoopï¼Œè®©å…¶å¤„ç†è¿™ä¸ªäº‹ä»¶ Source1ï¼šé™¤äº†åŒ…å«å›è°ƒæŒ‡é’ˆå¤–è¿˜åŒ…å«ä¸€ä¸ªmach portï¼Œå’Œsource0ä¸åŒï¼Œsource1å¯ä»¥ç›‘å¬ç³»ç»Ÿç«¯å£æˆ–è€…å’Œå…¶ä»–çº¿ç¨‹äº’å‘æ¶ˆæ¯ï¼Œå®ƒèƒ½å¤Ÿä¸»åŠ¨å”¤é†’Runloopã€‚ CFRunLoopTimerRefTimerä¼šåœ¨ä¸€ä¸ªé¢„è®¾çš„æ—¶é—´å†…å‘çº¿ç¨‹ä¼ é€’åŒæ­¥æ¶ˆæ¯ã€‚Timeræ˜¯ä¸Runloopçš„modeæ¥è”ç³»åœ¨ä¸€èµ·çš„ï¼Œå¦‚æœTimeræ‰€åœ¨çš„modeæ²¡æœ‰è¢«Runloopæ‰€ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ä¼šè¢«è°ƒç”¨ç›´åˆ°Runloopåˆ‡æ¢åˆ°Timeræ‰€å±çš„modeã€‚åŒæ ·åœ°ï¼Œå¦‚æœTimeråœ¨Runloopå¤„ç†äº‹åŠ¡è¿‡ç¨‹ä¸­è§¦å‘äº†ï¼Œé‚£å°±éœ€è¦ç­‰åˆ°Runloopä¸‹ä¸€æ¬¡loopæ‰èƒ½æ‰§è¡ŒTimerçš„å›è°ƒäº†ã€‚å¦‚æœRunloopå‹æ ¹å°±æ²¡æœ‰è·‘èµ·æ¥ï¼Œé‚£ä¹ˆTimeræ— è®ºå¦‚ä½•ä¹Ÿä¸ä¼šè§¦å‘çš„ã€‚ Observersä¸sourcesç›¸åï¼ŒRunloop observersæ˜¯ç”¨æ¥è§‚å¯ŸRunloopçš„çŠ¶æ€å˜åŒ–çš„ã€‚å½“RunloopçŠ¶æ€æ”¹å˜ï¼Œå¯ä»¥é€šè¿‡observersçš„å›è°ƒæ¥æ”¶åˆ°ç›¸åº”çš„å˜åŒ–ã€‚ 12345678910struct __CFRunLoopObserver &#123; CFRuntimeBase _base; pthread_mutex_t _lock; CFRunLoopRef _runLoop; CFIndex _rlCount; CFOptionFlags _activities; /* immutable */ CFIndex _order; /* immutable */ CFRunLoopObserverCallBack _callout; /* immutable */ CFRunLoopObserverContext _context; /* immutable, except invalidation */&#125;; å¯ä»¥è§‚å¯Ÿåˆ°çš„çŠ¶æ€æœ‰ï¼š 12345678910/* Run Loop Observer Activities */typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123; kCFRunLoopEntry = (1UL &lt;&lt; 0), // è¿›å…¥RunLoop kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), // å³å°†å¼€å§‹Timerå¤„ç† kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), // å³å°†å¼€å§‹Sourceå¤„ç† kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), // å³å°†è¿›å…¥ä¼‘çœ  kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), //ä»ä¼‘çœ çŠ¶æ€å”¤é†’ kCFRunLoopExit = (1UL &lt;&lt; 7), //é€€å‡ºRunLoop kCFRunLoopAllActivities = 0x0FFFFFFFU&#125;; Call outåœ¨å¼€å‘è¿‡ç¨‹ä¸­å‡ ä¹æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯é€šè¿‡Call outè¿›è¡Œå›è°ƒçš„(æ— è®ºæ˜¯Observerçš„çŠ¶æ€é€šçŸ¥è¿˜æ˜¯Timerã€Sourceçš„å¤„ç†)ï¼Œè€Œç³»ç»Ÿåœ¨å›è°ƒæ—¶é€šå¸¸ä½¿ç”¨å¦‚ä¸‹å‡ ä¸ªå‡½æ•°è¿›è¡Œå›è°ƒ(æ¢å¥è¯è¯´ä½ çš„ä»£ç å…¶å®æœ€ç»ˆéƒ½æ˜¯é€šè¿‡ä¸‹é¢å‡ ä¸ªå‡½æ•°æ¥è´Ÿè´£è°ƒç”¨çš„ï¼Œå³ä½¿ä½ è‡ªå·±ç›‘å¬Observerä¹Ÿä¼šå…ˆè°ƒç”¨ä¸‹é¢çš„å‡½æ•°ç„¶åé—´æ¥é€šçŸ¥ä½ ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨å †æ ˆä¸­ç»å¸¸çœ‹åˆ°è¿™äº›å‡½æ•°)ï¼š 123456static void __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__() __attribute__((noinline));static void __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__() __attribute__((noinline));static void __CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__() __attribute__((noinline));static void __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__() __attribute__((noinline));static void __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__() __attribute__((noinline));static void __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__() __attribute__((noinline)); Runloopçš„ä¼‘çœ RunLoopæœ€æ ¸å¿ƒçš„äº‹æƒ…å°±æ˜¯ä¿è¯çº¿ç¨‹åœ¨æ²¡æœ‰æ¶ˆæ¯æ—¶ä¼‘çœ ä»¥é¿å…å ç”¨ç³»ç»Ÿèµ„æºï¼Œæœ‰æ¶ˆæ¯æ—¶èƒ½å¤ŸåŠæ—¶å”¤é†’ã€‚RunLoopçš„è¿™ä¸ªæœºåˆ¶å®Œå…¨ä¾é ç³»ç»Ÿå†…æ ¸æ¥å®Œæˆï¼Œå…·ä½“æ¥è¯´æ˜¯è‹¹æœæ“ä½œç³»ç»Ÿæ ¸å¿ƒç»„ä»¶Darwinä¸­çš„Machæ¥å®Œæˆçš„ï¼ˆDarwinæ˜¯å¼€æºçš„ï¼‰ 1234567891011121314151617/* * Routine: mach_msg * Purpose: * Send and/or receive a message. If the message operation * is interrupted, and the user did not request an indication * of that fact, then restart the appropriate parts of the * operation silently (trap version does not restart). */__WATCHOS_PROHIBITED __TVOS_PROHIBITEDextern mach_msg_return_t mach_msg( mach_msg_header_t *msg, mach_msg_option_t option, mach_msg_size_t send_size, mach_msg_size_t rcv_size, mach_port_name_t rcv_name, mach_msg_timeout_t timeout, mach_port_name_t notify); ä½¿ç”¨Runloopä½¿ç”¨NSMachPortä½œä¸ºsource (source1)ç»è¿‡ä¸Šä¸€èŠ‚çš„åˆ†æï¼Œå·²ç»å¯¹Runloopæœ‰äº†æ·±å…¥çš„äº†è§£ã€‚ç°åœ¨å°±èƒ½ä¿®æ”¹ä¹‹å‰çš„ä¾‹å­ï¼Œè®©å®ƒèƒ½æ­£å¸¸å·¥ä½œèµ·æ¥äº†ã€‚ä¸ºäº†è®©Runloopä¸é€€å‡ºï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åˆ›å»ºä¸€ä¸ªNSMachPortæ·»åŠ åˆ°Runloopé‡Œé¢ã€‚ 12345678910111213141516171819- (void)viewDidLoad &#123; [super viewDidLoad]; self.videoClips = [NSMutableArray array]; self.thread = [[NSThread alloc] initWithBlock:^&#123; NSRunLoop *runloop = [NSRunLoop currentRunLoop]; [runloop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode]; [runloop run]; &#125;]; self.thread.name = @"myThread"; [self.thread start];&#125;- (IBAction)onButtonTapped:(id)sender &#123; [self performSelector:@selector(persistVideoClips:) onThread:self.thread withObject:[self.videoClips copy] waitUntilDone:NO];&#125;- (void)persistVideoClips:(NSArray *)clips &#123; NSLog(@"Execution in thread [%@], saving video clips", [NSThread currentThread].name);&#125; è¿è¡Œåï¼Œç‚¹å‡»æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºExecution in thread [myThread], saving video clipsã€‚ è‡ªå®šä¹‰source (Source0)æˆ‘ä»¬æŠŠä¾‹å­ç”¨source0çš„æ–¹å¼ä¿®æ”¹ä¸€ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455void runloopSourceScheduleRoutine(void *info, CFRunLoopRef runloop, CFRunLoopMode mode) &#123; NSLog(@"Schedule routine: source is added to runloop");&#125;void runloopSourceCancelRoutine(void *info, CFRunLoopRef runloop, CFRunLoopMode mode) &#123; NSLog(@"Cancel Routine: source removed from runloop");&#125;void runloopSourcePerformRoutine(void *info) &#123; NSLog(@"In thread [%@], Perform Routine: source has fired", [NSThread currentThread].name);&#125;@interface MyThread ()@property (assign, nonatomic) CFRunLoopSourceRef source;@property (assign, nonatomic) CFRunLoopRef runloop;@end@implementation MyThread- (void)dealloc &#123; self.source = NULL; self.runloop = NULL;&#125;- (void)main &#123; @autoreleasepool &#123; NSRunLoop *runloop = [NSRunLoop currentRunLoop]; self.runloop = [runloop getCFRunLoop]; CFRunLoopSourceContext context = &#123;0, (__bridge void *)(self), NULL, NULL, NULL, NULL, NULL, runloopSourceScheduleRoutine, runloopSourceCancelRoutine, runloopSourcePerformRoutine &#125;; self.source = CFRunLoopSourceCreate(NULL, 0, &amp;context); CFRunLoopAddSource(self.runloop, self.source, kCFRunLoopDefaultMode); [runloop run]; &#125;&#125;- (void)triggerSource0 &#123; CFRunLoopSourceSignal(self.source); CFRunLoopWakeUp(self.runloop);&#125;/** * ViewController */- (void)viewDidLoad &#123; [super viewDidLoad]; self.videoClips = [NSMutableArray array]; self.thread = [MyThread new]; self.thread.name = @"myThread"; [self.thread start];&#125;- (IBAction)buttonTapped:(id)sender &#123; [self.thread triggerSource0];&#125; ä½¿ç”¨Observer1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859void addObserver(CFRunLoopRef runloop) &#123; CFRunLoopObserverRef observer = CFRunLoopObserverCreateWithHandler( kCFAllocatorDefault, kCFRunLoopAllActivities, YES, 0, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) &#123; /* kCFRunLoopEntry = (1UL &lt;&lt; 0), è¿›å…¥å·¥ä½œ kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), å³å°†å¤„ç†Timersäº‹ä»¶ kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), å³å°†å¤„ç†Sourceäº‹ä»¶ kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), å³å°†ä¼‘çœ  kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), è¢«å”¤é†’ kCFRunLoopExit = (1UL &lt;&lt; 7), é€€å‡ºRunLoop kCFRunLoopAllActivities = 0x0FFFFFFFU ç›‘å¬æ‰€æœ‰äº‹ä»¶ */ switch (activity) &#123; case kCFRunLoopEntry: NSLog(@"è¿›å…¥"); break; case kCFRunLoopBeforeTimers: NSLog(@"å³å°†å¤„ç†Timeräº‹ä»¶"); break; case kCFRunLoopBeforeSources: NSLog(@"å³å°†å¤„ç†Sourceäº‹ä»¶"); break; case kCFRunLoopBeforeWaiting: NSLog(@"å³å°†ä¼‘çœ "); break; case kCFRunLoopAfterWaiting: NSLog(@"è¢«å”¤é†’"); break; case kCFRunLoopExit: NSLog(@"é€€å‡ºRunLoop"); break; default: break; &#125; &#125; ); CFRunLoopAddObserver(runloop, observer, kCFRunLoopDefaultMode); CFRelease(observer);&#125;@interface ViewController ()@property (weak ,nonatomic) NSTimer *timer;@end@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; self.timer = [NSTimer scheduledTimerWithTimeInterval:2.0 repeats:YES block:^(NSTimer * _Nonnull timer) &#123; NSLog(@"timer tick"); &#125;]; addObserver(CFRunLoopGetCurrent());&#125;@end æ§åˆ¶å°æ‰“å°çš„éƒ¨åˆ†ä¿¡æ¯ï¼š 2018-08-02 14:46:40.994863+0800 ObserverDemo[4707:559984] è¢«å”¤é†’2018-08-02 14:46:40.995346+0800 ObserverDemo[4707:559984] å³å°†å¤„ç†Timeräº‹ä»¶2018-08-02 14:46:40.995468+0800 ObserverDemo[4707:559984] å³å°†å¤„ç†Sourceäº‹ä»¶2018-08-02 14:46:40.995584+0800 ObserverDemo[4707:559984] å³å°†ä¼‘çœ 2018-08-02 14:46:41.584618+0800 ObserverDemo[4707:559984] è¢«å”¤é†’2018-08-02 14:46:41.584982+0800 ObserverDemo[4707:559984] timer tick2018-08-02 14:46:41.585309+0800 ObserverDemo[4707:559984] å³å°†å¤„ç†Timeräº‹ä»¶2018-08-02 14:46:41.585592+0800 ObserverDemo[4707:559984] å³å°†å¤„ç†Sourceäº‹ä»¶2018-08-02 14:46:41.585810+0800 ObserverDemo[4707:559984] å³å°†ä¼‘çœ 2018-08-02 14:46:43.584045+0800 ObserverDemo[4707:559984] è¢«å”¤é†’2018-08-02 14:46:43.584247+0800 ObserverDemo[4707:559984] timer tick2018-08-02 14:46:43.584424+0800 ObserverDemo[4707:559984] å³å°†å¤„ç†Timeräº‹ä»¶2018-08-02 14:46:43.584539+0800 ObserverDemo[4707:559984] å³å°†å¤„ç†Sourceäº‹ä»¶2018-08-02 14:46:43.584685+0800 ObserverDemo[4707:559984] å³å°†ä¼‘çœ 2018-08-02 14:46:45.584768+0800 ObserverDemo[4707:559984] è¢«å”¤é†’2018-08-02 14:46:45.585063+0800 ObserverDemo[4707:559984] timer tick2018-08-02 14:46:45.585379+0800 ObserverDemo[4707:559984] å³å°†å¤„ç†Timeräº‹ä»¶2018-08-02 14:46:45.585638+0800 ObserverDemo[4707:559984] å³å°†å¤„ç†Sourceäº‹ä»¶2018-08-02 14:46:45.585864+0800 ObserverDemo[4707:559984] å³å°†ä¼‘çœ  å¯ä»¥çœ‹åˆ°æµç¨‹è·Ÿæˆ‘ä»¬åœ¨æ·±å…¥Runloopåˆ†æçš„ä¸€æ ·ã€‚ å‚è€ƒèµ„æ–™è‹¹æœçš„Threading Programming Guide Kenshinçš„iOSåˆ¨æ ¹é—®åº•-æ·±å…¥ç†è§£Runloop ibiremeçš„æ·±å…¥ç†è§£Runloop]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è·å¾—è¿è¡Œæ—¶æŒ‡å®šDOMå…ƒç´ çš„Style]]></title>
    <url>%2F2018%2F07%2F16%2Fjavascript-get-style%2F</url>
    <content type="text"><![CDATA[è·å¾—è¿è¡Œæ—¶æŒ‡å®šDOMå…ƒç´ çš„Styleåœ¨å·¥ä½œä¸­æœ‰æ—¶å€™éœ€è¦è·å¾—æŒ‡å®šDOMå…ƒç´ æ˜¯å¦å…·æœ‰æŸç§styleï¼Œå†…è”æ ·å¼å’Œå±‚å æ ·å¼éƒ½éœ€è¦æ£€æŸ¥ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿç›´æ¥ä¸Šä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738/** * å°†å­—ç¬¦ä¸²ä¸­çš„'-'å¼€å§‹çš„å­å­—ç¬¦ä¸²å»æ‰'-'å¹¶æ›¿æ¢ä¸ºå¤§å†™å­—æ¯ * ä¾‹å¦‚background-color,ä¼šè¢«æ›¿æ¢ä¸ºbackgroundColor */function camelize(str) &#123; return str.replace(/-(\w)/g, function (strMatch, p1)&#123; return p1.toUpperCase(); &#125;);&#125;/** * è·å¾—æŒ‡å®šå…ƒç´ çš„æŒ‡å®šstyle * @param elem DOM å…ƒç´  * @param property styleçš„åå­— */function getStyle(elem, property) &#123; if (!elem || !property) &#123; console.log('elem or property should not be undefined or null.'); return null; &#125; var value = null; if(elem.style)&#123; value = elem.style[camelize(property)];//å…ˆè·å–æ˜¯å¦æœ‰å†…è”æ ·å¼ &#125; try &#123; // æ— å†…è”æ ·å¼ï¼Œåˆ™è·å–å±‚å æ ·å¼è¡¨è®¡ç®—åçš„æ ·å¼ if (!value || value === "") &#123; if (document.defaultView &amp;&amp; document.defaultView.getComputedStyle) &#123; var css = document.defaultView.getComputedStyle(elem,null); value = css ? css.getPropertyValue(property) : null; &#125; &#125; &#125; catch (error) &#123; console.log(error); &#125; return value;&#125; camelizeæ–¹æ³•å°†ä¼ å…¥çš„styleåç§°ä¸­çš„-æ›¿æ¢æ‰ï¼Œå› ä¸ºå†…è”æ ·å¼çš„åç§°ä¸­ä¸åŒ…æ‹¬å®ƒã€‚å¦‚getStyleæ–¹æ³•æ‰€ä½“ç°çš„ï¼Œä¼˜å…ˆåœ¨å†…è”æ ·å¼ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°å°±è¿”å›ï¼Œå¦åˆ™è°ƒç”¨defaultViewçš„getComputedStyleæ–¹æ³•æ¥è·å¾—å±‚å æ ·å¼è¡¨ä¸­çš„styleã€‚ defaultViewä»€ä¹ˆæ˜¯defaultView? æ ¹æ®https://developer.mozilla.org/zh-CN/docs/Web/API/Document/defaultViewæ‰€è¯´ï¼š åœ¨æµè§ˆå™¨ä¸­ï¼Œè¯¥å±æ€§è¿”å›å½“å‰ document å¯¹è±¡æ‰€å…³è”çš„ window å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼šè¿”å› nullã€‚ getComputedStyle Window.getComputedStyle()æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨åº”ç”¨æ´»åŠ¨æ ·å¼è¡¨å¹¶è§£æè¿™äº›å€¼å¯èƒ½åŒ…å«çš„ä»»ä½•åŸºæœ¬è®¡ç®—åæŠ¥å‘Šå…ƒç´ çš„æ‰€æœ‰CSSå±æ€§çš„å€¼ã€‚ ç§æœ‰çš„CSSå±æ€§å€¼å¯ä»¥é€šè¿‡å¯¹è±¡æä¾›çš„APIæˆ–é€šè¿‡ç®€å•åœ°ä½¿ç”¨CSSå±æ€§åç§°è¿›è¡Œç´¢å¼•æ¥è®¿é—®ã€‚ å‚è€ƒï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Window/getComputedStyle]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¯¹æŠ—åç¼–è¯‘ä¹‹ä½¿ç”¨å¯†ç è¡¨æ¥ä¿æŠ¤ä»£ç ä¸­çš„å­—ç¬¦ä¸²]]></title>
    <url>%2F2018%2F07%2F13%2Fpassword-table%2F</url>
    <content type="text"><![CDATA[å¯¹æŠ—åç¼–è¯‘ä¹‹ä½¿ç”¨å¯†ç è¡¨æ¥ä¿æŠ¤ä»£ç ä¸­çš„å­—ç¬¦ä¸²åœ¨æœ€è¿‘å‡ ä¸ªæœˆçš„æ—¶é—´å†…ï¼Œç”±äºå·¥ä½œçš„å…³ç³»ï¼Œä¸€ç›´åœ¨å¯¹æŠ—äº’è”ç½‘çš„é»‘è‰²äº§ä¸šï¼Œå°±æ˜¯ä¼ è¯´ä¸­çš„ä¼—å¤šåˆ·æœºå·¥ä½œå®¤ã€‚ä»–ä»¬æ‹¥æœ‰æ•°é‡ä¼—å¤šçš„è¶Šç‹±è®¾å¤‡ï¼Œåªè¦æœ‰åˆ©å¯å›¾ï¼Œå°±ä¼šå¯¹ç›®æ ‡ipaè¿›è¡Œç ´è§£æ¥è¾¾åˆ°è·åˆ©çš„ç›®çš„ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œè‹¹æœè®¾å¤‡å’Œappçš„å®‰å…¨æ€§è¦æ¯”éš”å£å®‰å“é«˜å‡ºè®¸å¤šï¼Œä½†è¿™ä¸ªæ˜¯åœ¨æœ‰è‹¹æœçˆ¸çˆ¸è®¾è®¡çš„ä¸€ç³»åˆ—å®‰å…¨ä¿æŠ¤æªæ–½ä¸‹é¢ï¼Œä¹Ÿå°±æ˜¯åœ¨éè¶Šç‹±ç¯å¢ƒä¸‹ã€‚ä¸€æ—¦appè·‘åœ¨è¶Šç‹±çš„ç¯å¢ƒä¸‹ï¼Œå¹¶ä¸”å¼€å‘è€…æ²¡æœ‰åšä»»ä½•ä¿æŠ¤æªæ–½çš„è¯ï¼Œé‚£å°±ç›¸å½“äºè£¸å¥”äº†ã€‚ å®‰å…¨è¿™ä¸ªé—®é¢˜å¾ˆå¤§ï¼Œæˆ‘ä»…åˆ†äº«ç»™å¤§å®¶å·¥ä½œä¸­æˆ‘å­¦åˆ°çš„ç»éªŒï¼Œä¹‹åæˆ‘ä¼šä¸€ç‚¹ä¸€ç‚¹æ›´æ–°æˆ‘çš„blogï¼Œå¦‚æœæœ‰æ›´å¤šæ—¶é—´ï¼Œè¿˜æœ‰å¼€æºä¸€äº›ä»£ç åˆ°æˆ‘çš„githubä¸Šã€‚ä»Šå¤©å…ˆæ¥è°ˆè°ˆç¨‹åºä¸­å­—ç¬¦ä¸²çš„å®‰å…¨é—®é¢˜ã€‚ ä¸€èˆ¬ç¨‹åºä¸­å¯¹æ•æ„Ÿå­—ç¬¦ä¸²å¤„ç†çš„ä¾‹å­ä¸€èˆ¬ç¨‹åºå‘˜å› ä¸ºå·¥æœŸèµ¶æˆ–è€…æ²¡æœ‰å®‰å…¨æ€§ä¸Šçš„é¡¾è™‘ï¼Œå¯¹appä¸­æ•æ„Ÿçš„å­—ç¬¦ä¸²ï¼Œå°¤å…¶æ˜¯è·Ÿè‡ªå®¶æœåŠ¡å™¨é€šä¿¡çš„ç§é’¥å•¦ï¼Œèº«ä»½éªŒè¯keyå•¦ï¼Œéƒ½æ˜¯ç”¨ä¸€ä¸ªå…¨å±€å­—ç¬¦ä¸²å¸¸é‡æ¥ä¿å­˜ï¼Œå°±è·Ÿä¸‹é¢ä»£ç ä¸€æ ·ï¼š secret.h æ–‡ä»¶1extern NSString * const secretKey; secret.m æ–‡ä»¶1NSString * const secretKey = @&quot;nzPHmNrbjuVOO7dX&quot;; è¿™æ ·åšçš„ç»“æœæ˜¯ï¼Œå›¾è°‹ä¸è½¨çš„äººåªè¦åˆ©ç”¨åç¼–è¯‘å·¥å…·å°±èƒ½å¤Ÿè½»è€Œæ˜“ä¸¾è·å¾—appä¸­ä»»æ„æ•æ„Ÿä¿¡æ¯ï¼Œå¯¹å…¬å¸åˆ©ç›Šé€ æˆå·¨å¤§æŸå¤±ã€‚æœ‰ä¸å°‘åç¼–è¯‘å·¥å…·å¯ä»¥ä½¿ç”¨ï¼Œä¾‹å¦‚Hopper Disassembler, IDA Proç­‰å·¥å…·ã€‚ å¦‚ä½•æœ‰æ•ˆé˜²æ­¢å­—ç¬¦ä¸²æ³„éœ²æ•æ„Ÿä¿¡æ¯åŠæ³•è‚¯å®šæœ‰ä¸å°‘ï¼Œæˆ‘è¿™é‡Œåˆ†äº«æˆ‘ä»¬è‡ªå·±åœ¨ç”¨çš„åŠæ³•ã€‚ åŸºæœ¬æƒ³æ³•å°±æ˜¯é¢„å…ˆé…ç½®å¥½ä¸€ä¸ªå­—ç¬¦è¡¨ ç„¶åå°†éœ€è¦éšè—çš„æ•æ„Ÿä¿¡æ¯å­—ç¬¦ä¸²ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦ä»è¡¨é‡ŒæŸ¥åˆ°å‡ºç›¸åº”çš„ä½ç½®è®°ä¸‹æ¥ ç¨‹åºä½¿ç”¨çš„æ—¶å€™è·Ÿç¬¬2æ­¥çš„ä½ç½®ç»„æˆçš„å­—ç¬¦æ•°ç»„ï¼ŒæŠŠå­—ç¬¦ä¸²è¿˜åŸå‡ºæ¥ ä»£ç åˆ†äº« ä»£ç åœ¨iOSå’Œandroidä¸¤ä¸ªå¹³å°éƒ½èƒ½å¤Ÿä½¿ç”¨ ç”Ÿæˆå¯†ç è¡¨å‡è®¾æˆ‘ä»¬ç°åœ¨é¢„å…ˆé…ç½®çš„å­—ç¬¦è¡¨ä¸ºABCD123456 å…ˆé€šè¿‡è¿™ä¸ªç½‘ç«™http://www.online-toolz.com/tools/text-hex-convertor.phpè·å¾—è¿™ä¸ªå­—ç¬¦ä¸²çš„hex code 41424344313233343536ï¼Œç„¶ååœ¨ç¨‹åºä¸­å£°æ˜ä¸€ä¸ªæ•°ç»„hex_tableæ¥å­˜å‚¨å®ƒï¼ˆè§ä¸‹é¢çš„ä»£ç ï¼‰ 12345//PasswordTable.c//source string: ABCD123456static const uint8_t hex_table[TABLE_SIZE] = &#123; 0x41,0x42,0x43,0x44,0x31,0x32,0x33,0x34,0x35,0x36 &#125;; æŸ¥è¯¢å¹¶è¾“å‡ºå­—ç¬¦åœ¨å¯†ç è¡¨ä¸­çš„ä½ç½®ä½¿ç”¨ä¸‹é¢çš„ä»£ç å¯ä»¥åœ¨consoleçœ‹åˆ°å¯¹åº”çš„æ•°ç»„ï¼Œå°†å®ƒcopyä¸‹æ¥ï¼Œä¾‹å¦‚æˆ‘ä»¬è¿™é‡Œä¼ å…¥â€™BCD456â€™åç”Ÿæˆå¯¹åº”çš„intæ•°ç»„len = 6 { 1, 2, 3, 7, 8, 9, }ï¼ŒæŠŠè¿™ä¸ªæ•°ç»„è®°ä¸‹æ¥ã€‚12345678910111213141516171819//PasswordTable.c/** * lookup magic numbers in terms of the given str based * on magic table. */void lookupMagics(const char * str, size_t str_len)&#123; printf("len = %li &#123;", str_len); for (int j = 0; j &lt; str_len; j++) &#123; for (int i = 0; i &lt; TABLE_SIZE; i++) &#123; if (hex_table[i] == str[j]) &#123; printf(" %i,", i); break; &#125; &#125; &#125; printf(" &#125;\n");&#125; ä»å¯†ç è¡¨ç”ŸæˆåŸå­—ç¬¦ä¸²123456789101112131415//PasswordTable.h#define TABLE_SIZE 10/** Convert integer array to string based on built-in hex table. @param array integer array. @param arr_len length of the array. @param buffer string buffer for receiving result, make sure it was alloced. @param buffer_len length of the buffer. @return 0 success, -1 if buffer_len is less than arr_len. */int convertMagics2String(int * array, size_t arr_len, char * buffer, size_t buffer_len); 12345678910111213141516171819202122232425262728//PasswordTable.c//source string: ABCD123456static const uint8_t hex_table[TABLE_SIZE] = &#123; 0x41,0x42,0x43,0x44,0x31,0x32,0x33,0x34,0x35,0x36 &#125;;int convertMagics2String(int * array, size_t arr_len, char * buffer, size_t buffer_len)&#123; if (buffer_len &lt;= arr_len) &#123; return -1; &#125; memset((void *)buffer, 0, arr_len + 1); for (int i = 0; i &lt; arr_len; i++) &#123; buffer[i] = hex_table[array[i]]; &#125; return 0;&#125;//main.c#include "PasswordTable.h"int main() &#123; int magics[] = &#123;1, 2, 3, 7, 8, 9&#125;;//ä¹‹å‰ç”±è°ƒç”¨lookupMagicsç”Ÿæˆçš„æ•´å½¢æ•°ç»„ char str[7]; convertMagics2String(magics, 6, str, 7); printf("the source string is %s\n", str); //å°†ä¼šæ‰“å°: the source string is BCD456 return 0;&#125; åœ¨ä¸Šé¢ä»£ç ä¸­mainå‡½æ•°çš„ä¾‹å­å°±æ˜¯ä½ åœ¨å®é™…ä»£ç ä¸­çš„æ ·å­ã€‚è¿™æ ·åšäº†ä»¥åï¼Œåç¼–è¯‘å·¥å…·å°±å¾ˆéš¾å¿«é€Ÿå®¹æ˜“åœ°é€šè¿‡å­—ç¬¦ä¸²è·å¾—å…³é”®ä¿¡æ¯äº†ï¼Œé™¤éå¯¹æ–¹å¯¹ä½ çš„ä»£ç æŠ±æœ‰æå¤§çš„å…´è¶£ï¼Œæ„¿æ„èŠ±æ—¶é—´åˆ†æã€‚ æœ€åå†å¤šè¯´ä¸€ç‚¹ï¼Œä¸ºäº†è¿›ä¸€æ­¥åŠ å¼ºå®‰å…¨æ€§ï¼Œå»ºè®®å¯¹ä»¥ä¸Šcå‡½æ•°è¿›è¡Œæ··æ·†ï¼Œå°†è¿›ä¸€æ­¥åŠ å¤§åç¼–è¯‘åˆ†æçš„éš¾åº¦ã€‚]]></content>
      <categories>
        <category>é€†å‘å·¥ç¨‹</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>android</tag>
        <tag>é€†å‘å·¥ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨Fastlaneå’ŒJenkinsæ„å»ºè‡ªåŠ¨æ‰“åŒ…ç³»ç»Ÿ (Part 2)]]></title>
    <url>%2F2018%2F07%2F02%2Fjenkins-fastlane-part2%2F</url>
    <content type="text"><![CDATA[Fastlane match ä½¿ç”¨å·²ç»å­˜åœ¨çš„è¯ä¹¦ç»è¿‡ç¬¬ä¸€éƒ¨åˆ†çš„å­¦ä¹ ï¼ŒFastlaneè¿™ä¸ªå·¥å…·ç¡®å®å¾ˆå¥½ç”¨ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯ä¹¦ï¼Œè‡ªåŠ¨æ‰“åŒ…ï¼Œè‡ªåŠ¨ä¼ åˆ°appstoreï¼Œä¸€åˆ‡çœ‹ä¸Šå¾ˆå®Œç¾ã€‚ä½†æ˜¯ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œmatchæ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨å·²ç»å­˜åœ¨çš„è¯ä¹¦å’Œprovisiong profilesçš„ï¼Œæ¢å¥è¯è¯´å°±æ˜¯æ¯æ¬¡è°ƒç”¨fastlane matchçš„æ—¶å€™ï¼Œå¦‚æœå‘ç°git repoæ²¡æœ‰å°±ä¼šä¸ºä½ ç”Ÿæˆæ–°çš„ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªé™åˆ¶ä¼šè®©å¾ˆå¤šç°æœ‰é¡¹ç›®çš„å¼€å‘è€…æœ›è€Œç”Ÿç•ã€‚å¥½åœ¨ï¼Œæˆ‘ä»¬æœ‰åŠæ³•å¯ä»¥è®©å®ƒæ”¯æŒç°æœ‰è¯ï¼Œä½†æ˜¯è¿™ä¸ªåŠæ³•ç¨å¾®æœ‰ç‚¹éº»çƒ¦ï¼Œå› ä¸ºå®ƒä¸æ˜¯è‡ªåŠ¨çš„ã€‚ å¦‚æœä½ è¿˜æœªäº†è§£ä»€ä¹ˆæ˜¯fastlaneï¼Œè¯·å…ˆé˜…è¯»ä½¿ç”¨Fastlaneå’ŒJenkinsæ„å»ºè‡ªåŠ¨æ‰“åŒ…ç³»ç»Ÿ (Part 1) å¯¼å‡ºè¯ä¹¦åœ¨æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ç°æœ‰çš„è¯ä¹¦å‰ï¼Œå…ˆå¾—ä¿è¯æ‰€æœ‰éœ€è¦çš„è¯ä¹¦å’Œç§é’¥éƒ½å·²ç»è¢«å¯¼å‡ºå¹¶ä¸”ä¿å­˜åœ¨æœ¬åœ°ã€‚ é¦–å…ˆ æ‰“å¼€keychain, é€‰æ‹©è¦å°†è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„è¯ä¹¦ï¼Œç„¶åé€‰æ‹©å¯¼å‡º åœ¨File Formaté€‰æ‹©å¯¼å‡ºä¸º.ceræ–‡ä»¶ã€‚ ç„¶åï¼Œå†æ¬¡é€‰æ‹©å¯¼å‡ºï¼Œåœ¨File Formaté€‰æ‹©å¯¼å‡ºä¸ºp12å¯¼å‡ºç§é’¥ï¼ˆä¸è¦è®¾ç½®å¯†ç ï¼Œå› ä¸ºå¦‚æœè®¾ç½®äº†å¯†ç åï¼Œfastlaneå°±æ— æ³•å¯¼å…¥ç§é’¥äº†ï¼‰ã€‚ ä¸‹ä¸€æ­¥å°±æ˜¯å»æŸ¥æ‰¾è¯ä¹¦åœ¨apple developer portalçš„idäº†ï¼ˆåç»­éœ€è¦ä»¥è¿™ä¸ªidæ¥ä¸ºè¯ä¹¦å’Œç§é’¥å‘½åï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªä¿¡æ¯åœ¨ç®¡ç†åå°æ˜¯çœ‹ä¸åˆ°çš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦å€ŸåŠ©fastlaneå†…éƒ¨ç›´æ¥ä½¿ç”¨çš„ä¸€ä¸ªåº“Spaceshipã€‚ ä½¿ç”¨Spaceshipåœ¨å‘½ä»¤è¡Œè¾“å…¥irbæ‰“å¼€ä¸€ä¸ªäº¤äº’å¼çš„ruby shellç¯å¢ƒã€‚ ä¹‹åï¼Œè¾“å…¥require &#39;spaceship&#39;å’Œå›è½¦ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå°†è¿™ä¸ªåº“å¯¼å…¥åˆ°å½“å‰çš„shellç¯å¢ƒä¸­ã€‚æ¥ä¸‹æ¥ï¼Œè¾“å…¥ä¸‹é¢è¿™ä¸ªå‘½ä»¤æ¥ç™»å½•åˆ°apple developer portalï¼š 1Spaceship.login ç„¶åå°±æ˜¯è·å–è¯ä¹¦ä¿¡æ¯çš„å‘½ä»¤ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯è·å¾—å…¨éƒ¨çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æŒ‰ç…§è¯ä¹¦çš„ç±»å‹æ¥è·å–ã€‚ ç¬¬ä¸€ç§ï¼Œè·å–æ‰€æœ‰è¯ä¹¦ä¿¡æ¯ï¼š 1Spaceship.certificate.all ç¬¬äºŒç§ï¼Œè·å–æŒ‡å®šç±»å‹çš„è¯ä¹¦ä¿¡æ¯ï¼š è·å–å¼€å‘è¯ä¹¦ 1Spaceship.certificate.development.all è·å–å‘å¸ƒè¯ä¹¦ 1Spaceship.certificate.production.all è¯ä¹¦ä¿¡æ¯ä¾‹å­ï¼š 1234567891011&lt;Spaceship::Portal::Certificate::Development id="TB48U5GPM8", name="iOS Development", status="Issued", created=2018-06-29 10:35:08 UTC, expires=2019-06-29 10:25:08 UTC, owner_type="teamMember", owner_name="owner name", owner_id="X9EZKD2K8B", type_display_id="6QPB9NHCEX", can_download=true&gt; è¿™ä¸ªå‘½ä»¤ä¼šåˆ—å‡ºè¯ä¹¦æ‰€æœ‰çš„ä¿¡æ¯ï¼Œè€Œä¸”å¾ˆæœ‰å¯èƒ½ä¼šè¿”å›å¤šä¸ªè¯ä¹¦ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½ éœ€è¦ä»”ç»†å°†å…¶ä¸æœ¬åœ°è¯ä¹¦çš„æ—¶é—´å’Œè¿‡æœŸå¯¹æ¯”ï¼Œä¸€è‡´çš„å°±æ˜¯ä½ è¦æ‰¾çš„è¯ä¹¦ä¿¡æ¯ã€‚å½“ä½ æ‰¾åˆ°åŒ¹é…çš„ï¼Œå°±ä»¥è¯ä¹¦ä¿¡æ¯çš„idæ¥å‘½åæœ¬åœ°ä¿å­˜çš„ç›¸åº”çš„è¯ä¹¦å’Œç§é’¥ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°†è¯ä¹¦pushåˆ°matchä½¿ç”¨çš„git repoä¸Šã€‚ Push è¯ä¹¦å’ŒProvisionåœ¨å‘½ä»¤è¡Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤æ¥å‡†å¤‡ä¸€äº›éœ€è¦ç”¨åˆ°çš„å˜é‡ï¼š 123456789irb(main):004:0&gt; require 'match'=&gt; trueirb(main):005:0&gt; git_url='git@github.com:path-to/the-encrypted-certs-repo.git'=&gt; "git@github.com:path-to/the-encrypted-certs-repo.git"irb(main):006:0&gt; shallow_clone = false=&gt; falseirb(main):007:0&gt; manual_password = 'password-to-decrypt-the-repo'=&gt; "password-to-decrypt-the-repo"irb(main):008:0&gt; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŠŠå­˜æ”¾è¯ä¹¦çš„git repoç»™cloneä¸‹æ¥å¹¶ä¸”è§£å¯† 1234irb(main):005:0&gt; workspace = Match::GitHelper.clone(git_url, shallow_clone, manual_password: manual_password)[21:17:30]: Cloning remote git repo...[21:17:31]: ğŸ”“ Successfully decrypted certificates repo=&gt; "/var/folders/5s/5cgmqxkx4fx6bllwgp1y5dlh000gp/T/d2018-0411-3701-148akjh" è¿™ä¸ªå‘½ä»¤å°†repo cloneåˆ°äº†/var/folders/...æ‰“å¼€å®ƒã€‚ç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢ï¼Œæ ¹æ®è¯ä¹¦çš„ç±»å‹æ¥åˆ›å»ºä¸åŒçš„æ–‡ä»¶å¤¹ï¼š å¦‚æœåˆ›å»ºå¼€å‘è¯ä¹¦ï¼Œåˆ™æ”¾åˆ°certs/developmenté‡Œé¢ å¦‚æœæ˜¯å‘å¸ƒè¯ä¹¦ï¼Œåˆ™æ”¾åˆ°certs/distributioné‡Œé¢ å°†è¯ä¹¦å’Œç§é’¥éƒ½è¦å¯¹åº”æ”¾åˆ°ä¸Šè¿°çš„æ–‡ä»¶å¤¹é‡Œé¢ã€‚ æœ€åæ¥å¤„ç†provision profilesï¼Œé¦–å…ˆä½ å¾—ä»Apple developer portalä¸‹è½½æ‰€éœ€è¦çš„provision profilesã€‚ä¸‹è½½å®Œæˆåï¼Œæ ¹æ®ä¸åŒçš„ç±»å‹æ”¾å…¥ä¸åŒçš„æ–‡ä»¶å¤¹ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š adhoc: profiles/adhoc/AdHoc_&lt;appbundleid&gt;.mobileprovision appstore: profiles/appstore/AppStore_&lt;appbundleid&gt;.mobileprovision development: profiles/development/Development_&lt;appbundleid&gt;.mobileprovision åšå®Œè¿™äº›åï¼Œç°åœ¨æˆ‘ä»¬æ¥æŠŠè¯ä¹¦å’Œprovision profilesæ¨åˆ°git repoä¸Šå»å§ã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1irb(main):006:0&gt; Match::GitHelper.commit_changes(workspace, "add certificate, private key and provisioning profiles", git_url) å¤§åŠŸå‘Šæˆã€‚ç°åœ¨ä½ åº”è¯¥å¯ä»¥é€šè¿‡fastlaneå‘½ä»¤æ¥å®‰è£…è¯ä¹¦å’Œprovision profilesäº†ã€‚ 1fastlane match development --readonly]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨Fastlaneå’ŒJenkinsæ„å»ºè‡ªåŠ¨æ‰“åŒ…ç³»ç»Ÿ (Part 1)]]></title>
    <url>%2F2018%2F06%2F23%2Ffastlane-jenkins%2F</url>
    <content type="text"><![CDATA[å‘è¿™ç¯‡åšæ–‡çš„ç›®çš„ä¸»è¦æ˜¯æ€»ç»“ä¸€äº›åœ¨ä½¿ç”¨fastlaneè¿‡ç¨‹é‡åˆ°çš„å‘ï¼Œé¡ºä¾¿åæ§½ä¸€ä¸‹Fastlaneå®˜æ–¹ç½‘ç«™ï¼šå†™çš„å¥½é£˜é€¸ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´ä¸çœ‹å‡ éä¸è¯•å‡ æ¬¡ï¼Œå®Œå…¨ä¸çŸ¥åˆ°æ•´ä¸ªä½“ç³»æ˜¯å¦‚ä½•çš„ã€‚ã€‚ã€‚æœ€åæˆ‘å¸Œæœ›èƒ½å¤Ÿå¸®åŠ©çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„ä½ :] Fastlane Fastlaneæ˜¯ä¸€ç§èƒ½å¤Ÿå°†iOSå’Œandroidå¹³å°betaæµ‹è¯•æˆ–è€…æ­£å¼å‘å¸ƒå®Œå…¨è‡ªåŠ¨åŒ–çš„å·¥å…·ï¼Itâ€™s amazing dude! å®ƒèƒ½å¤Ÿåšçš„äº‹æƒ…æœ‰ï¼š ç”Ÿæˆåº”ç”¨å•†åº—éœ€è¦çš„æ‰€æœ‰æˆªå›¾ (æœ¬åœ°åŒ–çš„æˆªå›¾ï¼å¯ä»¥æ ¹æ®éœ€è¦ä¸ºå„ç§è¯­è¨€ç”Ÿæˆï¼‰ å¤„ç†æ‰“åŒ…æ—¶å€™çš„ç­¾å å‘å¸ƒåº”ç”¨åˆ°å•†åº— æˆ‘ä»¬æ¥ä¸‹æ¥ä»¥iOSä¸ºä¾‹è®²è§£å¦‚ä½•ä½¿ç”¨fastlaneæ‰“åŒ…iOS app fastlaneåˆå§‹åŒ–é…ç½®è¯¦ç»†çš„setupæ­¥éª¤è¿™é‡Œä¸èµ˜è¿°ï¼Œå¤§å®¶å¯ä»¥åˆ°Getting started with fastlane for iOSæŸ¥çœ‹ã€‚ æ ¹æ®æ–‡æ¡£ï¼Œå®‰è£…å®Œfastlaneåï¼Œé…ç½®å·¥ç¨‹çš„ç¬¬ä¸€ä¸ªå‘½ä»¤æ˜¯(è¿™é‡Œä¸å»ºè®®ä½¿ç”¨swiftç‰ˆæœ¬çš„initï¼Œä¸€ä¸ªæ˜¯ç›®å‰æ˜¯betaç‰ˆæœ¬ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å½“å‰èƒ½æŸ¥åˆ°çš„èµ„æ–™éƒ½æ˜¯ä»¥ruby DSLæ¥è¯´æ˜çš„): 1fastlane init è¿è¡Œè¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œä¼šçœ‹åˆ°å‘½ä»¤è¡Œå‡ºç°äº¤äº’å¼æé—®ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜ç»å¸¸æ˜¯é—®ä½ æƒ³ç”¨fastlane æ¥å¹²å˜›ï¼Ÿ 12341. ğŸ“¸ Automate screenshots (è‡ªåŠ¨åŒ–appstore æœ¬åœ°åŒ–æˆªå›¾)2. ğŸ‘©â€âœˆï¸ Automate beta distribution to TestFlight (è‡ªåŠ¨åŒ–å‘å¸ƒbetaæµ‹è¯•appåˆ°test flight)3. ğŸš€ Automate App Store distribution (appstore å‘å¸ƒè‡ªåŠ¨åŒ–)4. ğŸ›  Manual setup - manually setup your project to automate your tasks (æ‰‹åŠ¨é…ç½®è‡ªå·±çš„å·¥ç¨‹) å¦‚æœæ‚¨çš„appæœ‰å¤šä¸ªtargetæˆ–è€…æ²¡æœ‰æ‰¾åˆ°è·Ÿworkspaceåå­—ä¸€æ ·çš„schemeï¼Œfastlaneä¼šæç¤ºè¾“å…¥bundle idï¼Œç„¶åä¼šæç¤ºè¾“å…¥apple idåŠå…¶å¯†ç ï¼Œå¦‚æœapple idåœ¨å¤šä¸ªteamè¿˜ä¼šæç¤ºé€‰æ‹©teamç­‰ç­‰ï¼Œæ€»ä¹‹é—®é¢˜é—®å®Œï¼Œä½ çš„åˆå§‹é…ç½®ä¹Ÿå°±å®Œæˆäº†ã€‚ é…ç½®å®Œåï¼Œä¼šåœ¨æ‚¨çš„å·¥ç¨‹ä¸‹é¢ç”Ÿæˆä¸€ä¸ªåä¸ºfastlaneçš„æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å°±æ˜¯æ‰€æœ‰fastlaneçš„é…ç½®æ‰€åœ¨äº†ã€‚æ–‡ä»¶å¤¹ä¼šåŒ…å«ä¸¤ä¸ªæ–‡ä»¶: Appfile: ç”¨æ¥å­˜å‚¨åœ¨ä½¿ç”¨fastlaneè¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„æœ‰ç”¨ä¿¡æ¯ï¼Œä¾‹å¦‚apple idï¼Œbundle idç­‰ Fastfile: fastlaneç¼–è¯‘ä»¥åŠå‘å¸ƒçš„æ ¸å¿ƒæ–‡ä»¶ï¼Œæ‰€æœ‰éœ€è¦è‡ªåŠ¨ç¼–è¯‘é…ç½®çš„ä»£ç éƒ½æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶é‡Œé¢ Fastfileç°åœ¨é‡ç‚¹è®²ä¸€ä¸‹å¦‚ä½•é…ç½®Fastfileã€‚åˆå§‹åŒ–å®Œåï¼Œfastlaneä¼šè‡ªåŠ¨ä¸ºå·¥ç¨‹ç”Ÿæˆå¦‚ä¸‹ä»£ç åœ¨fastfileé‡Œé¢(æˆ‘åœ¨åˆå§‹åŒ–çš„æ—¶å€™é€‰æ‹©çš„æ˜¯ç¬¬3é¡¹â€“appstoreå‘å¸ƒè‡ªåŠ¨åŒ–ï¼Œå¦‚æœé€‰æ‹©åˆ«çš„é€‰é¡¹å¯èƒ½ä¼šä¸ä¸‹é¢çš„ä¾‹å­æœ‰ç¨å¾®ä¸åŒ)ã€‚ 1234567platform :ios do desc "Push a new release build to the App Store" lane :release do build_app(workspace: "Spacename.xcworkspace", scheme: "SchemeName") upload_to_app_store(skip_metadata: true, skip_screenshots: true) endend platform: å‘Šè¯‰fastlaneæ˜¯å“ªä¸ªå¹³å°ã€‚ desc: æ³¨è§£ã€‚ä¸€èˆ¬æ”¾åˆ°æ¯ä¸ªlaneä¹‹å‰ä¸€è¡Œç”¨äºè§£é‡Šè¿™ä¸ªlaneçš„ä½œç”¨ lane: ç®€å•æ¥è®²å°±æ˜¯ä¸€ä¸ªä»»åŠ¡çš„é…ç½®ï¼Œæ¯”å¦‚å‘å¸ƒåˆ°test flightç®—ä¸€ä¸ªä»»åŠ¡ï¼Œæ‰“å†…éƒ¨æµ‹è¯•AdhocåŒ…ç­‰ã€‚lane åé¢è·Ÿç€çš„æ˜¯å†’å·åŠ ä»»åŠ¡åç§°ï¼Œå¦‚ä¸Šä»£ç ï¼š :release, è¿™æ ·ä½ å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸‹é¢è¾“å…¥å¦‚ä¸‹å‘½ä»¤å°±å¯ä»¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡äº†ï¼š 1fastlane release laneçš„bodyé‡Œé¢èƒ½å¤Ÿä½¿ç”¨çš„å‘½ä»¤éƒ½å«åšactionï¼Œèƒ½è°ƒç”¨çš„actionså®˜æ–¹å·²ç»å¸®æˆ‘ä»¬åˆ—å‡ºæ¥äº†ï¼Œè€Œä¸”æ¯ä¸ªactionéƒ½æœ‰è¯¦ç»†çš„æ–‡æ¡£ã€‚ä¾‹å­ä¸­çš„ä»»åŠ¡ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥æ˜¯åšä»€ä¹ˆï¼šç¼–è¯‘åä¸ºSpacename.xcworkspaceï¼Œschemeä¸ºSchemeNameçš„å·¥ç¨‹ï¼Œç¼–è¯‘å®Œåä¸Šä¼ åˆ°app storeï¼ˆè·³è¿‡ä¸Šä¼ meta dataå’Œscreenshotsï¼‰ è¯»è€…å¯ä»¥äº²æ‰‹è¯•ä¸€è¯•ï¼Œè®²workspaceå’Œschemeæ”¹ä¸ºè‡ªå·±å·¥ç¨‹çš„åå­—ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œè¿è¡Œfastlane releaseï¼Œä¹‹åå¦‚æœç¼–è¯‘æ²¡æœ‰å¤±è´¥å¹¶ä¸”itunes connectè¿æ¥å’ŒéªŒè¯æˆåŠŸçš„è¯ï¼Œæ‚¨ä¼šçœ‹åˆ°ipaåŒ…å·²ç»æˆåŠŸçš„ä¼ åˆ°äº†itunes connectçš„åå°äº†ã€‚æ€ä¹ˆæ ·ï¼Ÿå¾ˆå‰å®³å§ï¼Œå°±2è¡Œä»£ç å°±æå®šäº†ç¼–è¯‘ï¼Œæ‰“åŒ…ï¼Œä¸Šä¼ åˆ°appstoreè¿™ç§å¹³æ—¶ç¹æ‚çš„ä»»åŠ¡ï¼ ç­‰ç­‰ï¼Œæˆ‘ä»¬å¥½åƒæ¼äº†ä»€ä¹ˆã€‚å¯¹ï¼Œæœ€é‡è¦çš„ç¨‹åºç­¾åï¼ Fastlane matchä»€ä¹ˆæ˜¯Fastlane match? Fastlane matchä¸ä»…ä»…æ˜¯åœ¨é…ç½®fastlaneè‡ªåŠ¨æ‰“åŒ…æ—¶å€™éœ€è¦ç”¨åˆ°ï¼Œè€Œä¸”æå¤§åœ°ç®€åŒ–äº†åœ¨ä¸€ä¸ªå¼€å‘å›¢é˜Ÿä¸­å…±äº«è¯ä¹¦å’Œprovisioning profilesçš„æµç¨‹ï¼ é¡¹ç›®ç»„ä¸­æ¯æ¥ä¸€ä¸ªæ–°æˆå‘˜ï¼Œæ˜¯ä¸æ˜¯éƒ½è¦èŠ±æ—¶é—´ä¸ºæ–°æˆå‘˜é…ç½®è¯ä¹¦ï¼Œå¹¶ä¸”æŠŠä»–åŠ å…¥åˆ°ç›¸åº”é¡¹ç›®çš„provisioning profilesé‡Œé¢ï¼Ÿå¦‚æœé¡¹ç›®ä¼—å¤šï¼Œæ˜¯ä¸æ˜¯ç®¡ç†çš„ä¸€åœºå™©æ¢¦ï¼Ÿæƒ³è¦ç®€åŒ–å—ï¼Ÿå¿«ä½¿ç”¨Fastlane match! è¿æ¥åˆ°è‹¹æœæœåŠ¡å™¨å¾ˆæ…¢ï¼Œä¸‹è½½provisioning profileå¾ˆæ…¢ï¼æƒ³æ¯æ¬¡éƒ½ä¸‹è½½å¿«å—ï¼Ÿå¿«ä½¿ç”¨Fastlane match! æƒ³åœ¨å›¢é˜Ÿä¸­æ–¹ä¾¿çš„ä½¿ç”¨ä¸ªäººå¼€å‘è€…è¯ä¹¦ï¼Œè€Œä¸ç”¨æ‹·æ¥æ‹·å»å—ï¼Ÿå¿«ä½¿ç”¨Fastlane match! é¡¹ç›®ç»„æœ‰æ–°è®¾å¤‡åï¼Œå¿«ä½¿ç”¨Fastlane match! ä¸€é”®æå®šï¼ è¯´äº†é‚£ä¹ˆå¤šå¥½å¤„ï¼Œå’±ä»¬æ¥çœ‹çœ‹æ€ä¹ˆç”¨ï¼é¦–å…ˆåœ¨å·¥ç¨‹æ‰€åœ¨æ–‡ä»¶å¤¹è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ˆç¡®ä¿åœ¨è¿è¡Œä¹‹å‰å…ˆè¿è¡Œè¿‡fastlane initå‘½ä»¤ï¼‰ 1fastlane match init è¿è¡Œå®Œåï¼Œfastlaneä¼šé—®ç”¨æ¥å­˜å‚¨å·¥ç¨‹çš„è¯ä¹¦å’Œprovisioning profilesçš„Git repoçš„URLæ˜¯ä»€ä¹ˆï¼Ÿæ‰€ä»¥ï¼Œé©¬ä¸Šå»Githubæˆ–è€…Gitlabä¸Šåˆ›å»ºä¸€ä¸ªå»å§ï¼ æ³¨æ„ï¼ï¼ï¼ æ‰€æœ‰ä¼ åˆ°æŒ‡å®šgit repoçš„è¯ä¹¦å’Œprovisioning profileså°†ä¼šè¢«fastlaneä½¿ç”¨OpenSSLæ¥åŠ å¯†å­˜å‚¨çš„ã€‚ ä½ å¿…é¡»å¯¹æ›¾git repoæœ‰å®Œå…¨çš„æ§åˆ¶æƒåŠ›ã€‚æœ€å¥½ä¿è¯ä½ æ‰€ä½¿ç”¨çš„git repoæ˜¯ç§æœ‰çš„å¹¶ä¸”ä½¿ç”¨å®‰å…¨çš„ç§é’¥ã€‚ å³ä½¿ä½ çš„è¯ä¹¦æ³„éœ²äº†ï¼Œåœ¨ä¸çŸ¥é“ä½ çš„itunes connectè´¦å·çš„æƒ…å†µä¸‹å¹¶ä¸èƒ½å¯¹ä½ é€ æˆä¼¤å®³ å¦‚æœä½ ä½¿ç”¨Git hubæˆ–è€…Bitbucktï¼Œå»ºè®®ä½ ä½¿ç”¨å¼€å¯ä¸¤æ­¥éªŒè¯çš„itunes connectè´¦å·æ¥ä½œä¸ºmatchè¿æ¥æ—¶ç”¨çš„è´¦å· è·Ÿéšç€æ‰€æœ‰æç¤ºåšå®Œåä¼šåœ¨fastlaneæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ªå«åšMatchfileçš„æ–‡ä»¶ï¼Œåˆå§‹çš„æ–‡ä»¶å†…å®¹ä¸ä¸‹é¢ç±»ä¼¼ï¼š 1234567891011git_url("git@xxx/certificates.git")type("development") # The default type, can be: appstore, adhoc, enterprise or developmentapp_identifier(["bundle identifier 1", "bundle identifier 2"])#username("xxx@xxx.com") # Your Apple Developer Portal username# For all available options run `fastlane match --help`# Remove the # in the beginning of the line to enable the other options#match(app_identifier: ["bundle identifier 1", "bundle identifier 2"], type: "adhoc") åˆå§‹åŒ–å®Œåï¼Œå°±åˆ°ä¸ºå·¥ç¨‹ç”Ÿæˆè¯ä¹¦å’Œprovisioning profilesäº† ï¼Œï¼ˆå¦‚æœä¸æ˜¯æ–°é¡¹ç›®ï¼Œæƒ³åˆ©ç”¨å·²ç»å­˜åœ¨çš„è¯ä¹¦æ€ä¹ˆåŠï¼Ÿè¿™éƒ¨åˆ†ä¹Ÿæœ‰è§£å†³æ–¹æ¡ˆï¼Œæˆ‘æ‰“ç®—æ”¾åˆ°part 2çš„æ—¶å€™å†è®²ï¼‰è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°±ä¼šä¸ºå·¥ç¨‹ç”Ÿæˆdevelopmentè¯ä¹¦å’Œç›¸åº”çš„provisiong profileï¼š 1fastlane match development ç¬¬ä¸€æ¬¡è¿è¡Œè¿™ä¸ªå‘½ä»¤ä¼šæç¤ºè¯·è¾“å…¥passphaseï¼Œè¿™ä¸ªpassphaseå°±æ˜¯ç”¨æ¥åŠ å¯†è¯ä¹¦å’Œprovisioning profilesç”¨çš„ã€‚ æ³¨æ„: è¿è¡Œä»¥ä¸Šå‘½ä»¤,å¦‚æœå‘ç°æ²¡æœ‰ç›¸åº”çš„è¯ä¹¦å’Œprovisiong profileså°±ä¼šç”Ÿæˆæ–°çš„è¯ä¹¦å’Œprovisioning profilesï¼Œæ‰€ä»¥è¯·æ…ç”¨ï¼ æ¥ä¸‹æ¥ï¼Œå¦‚æœæƒ³åœ¨ä¸€å°æ–°çš„æœºå™¨ä¸Šå®‰è£…è¯¥å·¥ç¨‹çš„è¯ä¹¦å°±å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1fastlane match development --readonly åŠ ä¸Šâ€“readonlyå°±èƒ½ä¿è¯ä¸ä¼šç”Ÿæˆæ–°çš„ï¼Œè€Œä»…ä»…åªæ˜¯æ‰§è¡Œå®‰è£…è€Œå·²ã€‚é™¤äº†development,æˆ‘ä»¬è¿˜èƒ½æŒ‡å®šadhoc, appstore, enterpriseç­‰å‚æ•°æ¥ç”Ÿæˆä¸åŒåœºæ™¯çš„è¯ä¹¦ã€‚ ç”Ÿæˆçš„è¯ä¹¦å’Œprovisioning profileséƒ½ä¼šè¢«åŠ å¯†æ”¾åˆ°åˆå§‹åŒ–matchæ—¶æŒ‡å®šçš„git repoä¸­ï¼Œè¿™æ ·å½“ä½¿ç”¨fastlane match developmentæˆ–è€…fastlane match development â€“readonlyçš„æ—¶å€™ï¼Œfastlaneä¼šç¬¬ä¸€æ—¶é—´ä»æŒ‡å®šçš„git repoä¸­å»å¯»æ‰¾å¹¶å®‰è£…ï¼Œæ‰€ä»¥ä¸éœ€è¦ç»è¿‡è‹¹æœæœåŠ¡å™¨ã€‚å¦‚æœgit repoæ˜¯è‡ªå·±å…¬å¸æœåŠ¡å™¨çš„ï¼Œé‚£å°±æ›´å¿«äº†:]ã€‚ å¦‚æœæƒ³ä¸€å£æ°”è£…ä¸Šæ‰€éœ€è¦çš„è¯ä¹¦å’Œprovisioning profiles, é‚£ä¹ˆå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬æ¥å®Œæˆï¼š 1234567#!/bin/sh#install appstore development profiles and certfastlane match development --readonly#uncomment below lines if you need install other types of certs#fastlane match adhoc --readonly#fastlane match appstore --readonly å°†è„šæœ¬ä¼ åˆ°å·¥ç¨‹gitä¸Šï¼Œè¿™æ ·åªè¦æœ‰æ–°æœºå™¨ï¼Œå°±è¿è¡Œä¸€ä¸‹è¿™ä¸ªè„šæœ¬å°±å…¨éƒ¨è£…ä¸Šäº†ã€‚ åœ¨Fastfileä¸­ä½¿ç”¨matché…ç½®å¥½matchåï¼Œå¦‚ä½•åœ¨fastfileä¸­ä½¿ç”¨å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š 12345678platform :ios do desc "Push a new release build to the App Store" lane :release do sync_code_signing build_app(workspace: "Spacename.xcworkspace", scheme: "SchemeName") upload_to_app_store(skip_metadata: true, skip_screenshots: true) endend åªéœ€è¦åœ¨ç¼–è¯‘ä¹‹å‰è°ƒç”¨sync_code_signingå³å¯ï¼]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•æ·è®¾è®¡ä¹‹SOLIDåŸåˆ™]]></title>
    <url>%2F2017%2F08%2F24%2Fagile-desgin%2F</url>
    <content type="text"><![CDATA[æ•æ·è®¾è®¡ä¹‹SOLIDåŸåˆ™æŠŠæ¡æ‰€å­¦ä¸œè¥¿çš„æœ¬è´¨åœ¨è®¨è®ºSOLIDåŸåˆ™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼Œå°±æ˜¯è¿™ä¸ªè§„åˆ™æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜è€Œè¢«å‘æ˜å‡ºæ¥çš„ã€‚åªæœ‰å¼„æ¸…æ¥šè¿™ä¸€ç‚¹ï¼Œæ‰èƒ½å¤Ÿåœ¨å®é™…å·¥ä½œä¸­æ­£ç¡®åº”ç”¨ã€‚ä¸¾ä¸ªæ —å­å§ï¼Œæ¯”å¦‚ä¸ºä»€ä¹ˆè¦é‡‡ç”¨MVCï¼Ÿæ•™ç§‘ä¹¦èˆ¬çš„å›ç­”å°±æ˜¯MVCå°±æ˜¯Model-View-Controllerï¼Œç„¶åå°†Model,Viewå’ŒControllerå„è‡ªæŒ‰ç…§æ•™ç§‘ä¹¦è¯´ä¸€éã€‚ä½ è§‰å¾—ä½ çœŸçš„ç†è§£ä¸ºä»€ä¹ˆè¦ç”¨MVCäº†å—ï¼Ÿä¸¾ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜éMVCæ˜¯ä»€ä¹ˆæ ·çš„å§ï¼Ÿ 123456789101112131415161718192021222324252627&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;%set conn=Server.CreateObject("ADODB.Connection")conn.Provider="Microsoft.Jet.OLEDB.4.0"conn.Open(Server.Mappath("/db/northwind.mdb"))set rs = Server.CreateObject("ADODB.recordset")rs.Open "Select * from Customers", conndo until rs.EOF for each x in rs.Fields Response.Write(x.name) Response.Write(" = ") Response.Write(x.value &amp; "&lt;br&gt;") next Response.Write("&lt;br&gt;") rs.MoveNextlooprs.closeconn.close%&gt;&lt;/body&gt;&lt;/html&gt; è¿™æ˜¯ä¸€æ®µASP classicçš„ä»£ç ã€‚è¿™æ®µä»£ç çš„é—®é¢˜ï¼š æ— æ³•åœ¨ç±»ä¼¼é€»è¾‘çš„é¡µé¢é‡ç”¨ä½¿ç”¨æ•°æ®åº“çš„ä»£ç ã€‚ä¸ºäº†æ»¡è¶³å¿«é€Ÿè¿­ä»£çš„éœ€æ±‚ï¼Œå°†ä¼šä¿ƒä½¿ç¨‹åºå‘˜è‡ªç„¶è€Œç„¶çš„ä½¿ç”¨copy-pasteå¤§æ³•ã€‚ é¡µé¢çš„æ˜¾ç¤ºä¸æ•°æ®åº“ä»£ç æ··åœ¨ä¸€èµ·ï¼Œå¦‚æœéœ€æ±‚å˜åŒ–ï¼Œè¦è°ƒæ•´é¡µé¢æ˜¾ç¤ºå°†ä¼šå˜å¾—å¾ˆéº»çƒ¦ã€‚ä¸€ä¸ªé¡µé¢è¿˜å¥½ï¼Œå¦‚æœæ˜¯å‡ åä¸ªè¿™ç§ä»£ç çš„é¡µé¢å‘¢ï¼Ÿ æ‰€ä»¥ï¼Œä»å¦‚ä½•èƒ½å¤Ÿè®©è¿™æ®µä»£ç é‡ç”¨ä¸ºå‡ºå‘ç‚¹ï¼ŒMVCåœ¨ä¸æ–­çš„è¯•éªŒä¸æµ‹è¯•ä¸­è¯ç”Ÿäº†ã€‚MVCçš„ä¼˜ç‚¹æ€»ç»“è¯·è‡ªè¡ŒGoogleã€‚ è®¾è®¡è‡­å‘³è®¾è®¡ä¸€ä¸ªè½¯ä»¶çš„ç»“æ„æˆ–è€…æ¶æ„çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„ç»éªŒï¼Œç»å¸¸ä¼šäº§ç”Ÿå¦‚ä¸‹é—®é¢˜: åƒµåŒ–æ€§åƒµåŒ–æ€§æ˜¯æŒ‡å¯¹è½¯ä»¶è¿›è¡Œæ”¹åŠ¨ï¼Œå³ä½¿æ˜¯ç®€å•çš„æ”¹åŠ¨ã€‚å¦‚æœå•ä¸€çš„æ”¹åŠ¨ä¼šå¯¼è‡´æœ‰ä¾èµ–å…³ç³»çš„æ¨¡å—ä¸­çš„è¿é”æ”¹åŠ¨ï¼Œé‚£ä¹ˆè®¾è®¡å°±æ˜¯åƒµåŒ–çš„ã€‚ è„†å¼±æ€§è„†å¼±æ€§æ˜¯æŒ‡ï¼Œåœ¨è¿›è¡Œä¸€ä¸ªæ”¹åŠ¨æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºçš„è®¸å¤šåœ°æ–¹å‡ºç°é—®é¢˜ã€‚ é¡½å›ºæ€§é¡½å›ºæ€§æ˜¯æŒ‡ï¼Œè®¾è®¡ä¸­åŒ…å«äº†å¯¹å…¶ä»–æœ‰ç”¨çš„éƒ¨åˆ†ï¼Œä½†æ˜¯è¦æŠŠè¿™äº›éƒ¨åˆ†ä»ç³»ç»Ÿä¸­åˆ†ç¦»å‡ºæ¥æ‰€éœ€è¦çš„åŠªåŠ›å’Œé£é™©å´æ˜¯å·¨å¤§çš„ï¼Œè¿™æ˜¯ä¸€ç§ä»¤äººé—æ†¾ï¼Œä½†éå¸¸å¸¸è§çš„æƒ…å†µã€‚ ç²˜æ»æ€§ç²˜æ»æ€§æ˜¯æŒ‡ï¼Œå½“é¢ä¸´ä¸€ä¸ªæ”¹åŠ¨æ—¶ï¼Œå¼€å‘äººå‘˜å°å°å‘ç°æœ‰å¤šç§æ”¹åŠ¨çš„æ–¹æ³•ã€‚å…¶ä¸­ï¼Œæœ‰ä¸€äº›ä¼šä¿æŒæ•æ·è®¾è®¡ï¼Œè€Œå¦å¤–ä¸€äº›åˆ™ä¼šç ´åè®¾è®¡ã€‚æ¯”å¦‚ï¼Œå¦‚æœç¼–è¯‘æ‰€èŠ±è´¹çš„æ—¶é—´å¾ˆé•¿ï¼Œé‚£ä¹ˆå¼€å‘äººå‘˜å°±ä¼šè¢«è¯±å¯¼å»åšä¸ä¼šå¯¼è‡´å¤§è§„æ¨¡ç¼–è¯‘çš„ä¸¾åŠ¨ã€‚ ä¸å¿…è¦çš„å¤æ‚æ€§å¦‚æœè®¾è®¡ä¸­åŒ…å«äº†å½“å‰æ²¡ç”¨çš„ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå°±å«æœ‰ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚å½“å¼€å‘äººå‘˜é¢„æµ‹éœ€æ±‚çš„å˜åŒ–ï¼Œå¹¶åœ¨è½¯ä»¶ä¸­æ”¾ç½®äº†å¤„ç†æ½œåœ¨å˜åŒ–çš„ä»£ç æ—¶ï¼Œå°å°å‡ºç°è¿™ç§æƒ…å†µã€‚èµ·åˆï¼Œè¿™æ ·åšçœ‹èµ·æ¥è²Œä¼¼æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œä½†æ˜¯ç»“æœå°å°æ­£å¥½ç›¸åã€‚ä¸ºè¿‡å¤šçš„å¯èƒ½æ€§åšå‡†å¤‡ï¼Œè‡´ä½¿è®¾è®¡ç”±äºå«æœ‰ç»ä¸ä¼šç”¨åˆ°çš„ç»“æ„è€Œå˜å¾—æ··ä¹±ã€‚ ä¸å¿…è¦çš„é‡å¤æ€§copy-paste æ™¦æ¶©æ€§æ™¦æ¶©æ€§æ˜¯æŒ‡æ¨¡å—éš¾ä»¥ç†è§£ã€‚ æ€ä¹ˆèƒ½å°½é‡é¿å…äº§ç”Ÿä»¥ä¸Šé—®é¢˜å‘¢ï¼Ÿé‚£å°±éœ€è¦å€Ÿé‰´æ•æ·è®¾è®¡ã€‚ æ•æ·è®¾è®¡åŸåˆ™ä¹‹SOLIDå¤§å®¶éƒ½å¬è¯´è¿‡æ•æ·å¼€å‘å®£è¨€ï¼Œ å…¶ä¸­æœ€åä¸€æ¡æ˜¯â€éšæ—¶åº”å¯¹å˜åŒ–é‡äºéµå¾ªè®¡åˆ’â€ã€‚è¦è¾¾è¿™ç›®çš„å¹¶ä¸”é¿å…å†™å‡ºæœ‰è‡­å‘³çš„ä»£ç ï¼Œå°±éœ€è¦å¼•å…¥æ•æ·è®¾è®¡ï¼Œå°±æ˜¯è¦è®©è‡ªå·±çš„ä»£ç å¤Ÿâ€œæ•æ·â€ã€‚æˆ‘è®¤ä¸ºåªæœ‰ä»£ç å…·æœ‰æ•æ·è®¾è®¡æ€æƒ³ï¼Œæ•æ·å¼€å‘å®£è¨€æ‰€å€¡å¯¼çš„æ‰èƒ½å¤Ÿé¡ºåˆ©å®ç°ã€‚æ‰“ä¸ªæ¯”å–»ï¼Œä¸­å›½å¤ä»£æ‰“æˆ˜æœ‰è®¸å¤šæ’å…µå¸ƒé˜µçš„é˜µæ³•ï¼Œæƒ³æƒ³çœ‹å¦‚æœä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç„å¦™æ— æ¯”çš„é˜µæ³•ï¼Œæ¯”å¦‚å…«å¦é˜µï¼Œä½†æ˜¯æ‰§è¡Œé˜µæ³•çš„å£«å…µå¤§éƒ¨åˆ†éƒ½æ˜¯è€å¼±æ®‹å…µä»¥åŠè€å¹¼å¦‡å­ºï¼Œææ€•è¿é˜µåŠ¿éƒ½æ‘†ä¸å‡ºæ¥å°±æˆ˜è´¥äº†å§ã€‚æˆ‘ä»¬è¿™é‡Œè¯´çš„æ•æ·è®¾è®¡åŸåˆ™å°±åƒå£«å…µä¸€æ ·ï¼Œæ˜¯åŸºçŸ³ã€‚ é‚£åˆ°åº•ä»€ä¹ˆæ˜¯æ•æ·è®¾è®¡å‘¢ï¼Ÿæ•æ·è®¾è®¡æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€ä¸ªäº‹ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªæŒç»­çš„åº”ç”¨åŸåˆ™ã€æ¨¡å¼ä»¥åŠå®è·µæ¥æ”¹è¿›è½¯ä»¶çš„ç»“æ„å’Œå¯è¯»æ€§çš„è¿‡ç¨‹ã€‚å®ƒè‡´åŠ›äºä¿æŒç³»ç»Ÿåœ¨ä»»ä½•äº‹ä»¶éƒ½å°½å¯èƒ½çš„ç®€å•å¹²å‡€ä»¥åŠå¯Œæœ‰è¡¨è¾¾åŠ›ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å­¦ä¹ æ•æ·è®¾è®¡åŸåˆ™ï¼Œä½†è¯·è®°ä½ï¼Œæ•æ·å¼€å‘äººå‘˜ä¸ä¼šæŠŠè¿™äº›åŸåˆ™åº”ç”¨åˆ°ä¸€ä¸ªåºå¤§çš„é¢„å…ˆè®¾è®¡ä¸­ã€‚ç›¸åï¼Œè¿™äº›åŸåˆ™è¢«åº”ç”¨åœ¨ä¸€æ¬¡æ¬¡çš„è¿­ä»£ä¸­ï¼ŒåŠ›å›¾ä½¿ä»£ç ä»¥åŠä»£ç æ‰€è¡¨è¾¾çš„è®¾è®¡ä¿æŒå¹²å‡€ã€‚ å•ä¸€èŒè´£åŸåˆ™(SRP) ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå‘ç”Ÿå˜åŒ–çš„åŸå›  å¦‚æœä¸€ä¸ªç±»æ‰¿æ‹…çš„èŒè´£è¿‡å¤šï¼Œå°±ç­‰äºæŠŠè¿™äº›èŒè´£è€¦åˆåœ¨äº†ä¸€èµ·ã€‚ä¸€ä¸ªèŒè´£çš„å˜åŒ–å¯èƒ½ä¼šå‰Šå¼±æˆ–è€…æŠ‘åˆ¶è¿™ä¸ªç±»å®Œæˆå…¶ä»–èŒè´£çš„èƒ½åŠ›ã€‚ è€ƒè™‘ä¸‹å›¾çš„è®¾è®¡ï¼š è¿™ä¸ªè®¾è®¡è¿åäº†SRPï¼Œæ˜¾ç„¶Rectangleæœ‰ä¸¤ä¸ªèŒè´£ã€‚å¯¼è‡´çš„é—®é¢˜ï¼š æ‰“åŒ…åˆ°GUIç¨‹åºä¸­çš„æ—¶å€™ï¼Œéœ€è¦å°†è®¡ç®—æœºå‡ ä½•åº”ç”¨åº“ä¸å›¾å½¢ç»˜åˆ¶åº”ç”¨åº“ä¸€èµ·æ‰“åŒ… å¦‚æœä¾èµ–çš„ä»»ä½•ä¸€ä¸ªåº“å‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™éœ€è¦é‡æ–°å¯¹ç¨‹åºæ‰“åŒ…ã€‚å¦‚æœå¿˜è®°åšï¼Œè€Œä»…ä»…åªæ˜¯æ›´æ–°å…¶ä¸­ä¸€ä¸ªåº“çš„è¯ï¼Œå°†ä¼šå¯¼è‡´ä¸å¯é¢„æ–™çš„é”™è¯¯ã€‚ æ”¹è¿›ï¼š å¼€æ”¾å…³é—­åŸåˆ™(OCP) ä¸€ä¸ªç±»å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œä¸€ä¸ªç±»åœ¨ä¸ä¿®æ”¹å®ƒæœ¬èº«çš„ä»£ç çš„å‰æä¸‹å…è®¸æ‰©å±•å®ƒçš„è¡Œä¸º(å¦‚æœä¸ä¿®æ”¹åšä¸åˆ°åˆ°è¯ï¼Œå°½é‡æŠŠä¿®æ”¹åšåˆ°æœ€å°åŒ–) OCP å¬èµ·æ¥å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯å´ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“å®è·µçš„ã€‚å› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºä¸€ä¸ªåŠŸèƒ½è€Œè®¾è®¡å¯ä»¥å¯¹æœªæ¥éœ€æ±‚å¼€æ”¾çš„ç±»å¹¶ä¸ç®€å•ã€‚è¿™é‡Œé‡è¦çš„ç‚¹æ˜¯æœªæ¥éœ€æ±‚ã€‚å½“æˆ‘ä»¬å¹¶ä¸çŸ¥é“æœªæ¥è½¯ä»¶çš„éœ€æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†æ€æ ·è®¾è®¡ç±»ï¼Œæ¨¡å—ï¼ŒåŠŸèƒ½ç­‰æ¥è¿åˆéœ€æ±‚å‘¢ï¼Ÿè¿™å°±æ˜¯OCPä¸å®¹æ˜“å®è·µçš„åŸå› ï¼Œé€šå¸¸éœ€è¦å½»åº•çš„æ€è€ƒè®¾è®¡ã€‚ æˆ‘ä»¬è¯¥å¦‚ä½•å»è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå½“è®¾è®¡ç±»ç»“æ„çš„æ—¶å€™ï¼Œéœ€è¦ç”¨å¿ƒç¡®ç±»çš„æ‰©å±•ç®€å•ã€‚è®¾è®¡é˜¶æ®µï¼Œå°†æ‰€æœ‰ç±»çš„ç”¨ä¾‹è®°ä¸‹æ¥ï¼Œå¹¶å¯¹æ‰€æœ‰ç”¨ä¾‹ç»™å‡ºåˆé€‚çš„æ¥å£ã€‚æŠ½è±¡ç±»æ˜¯ä¸€ç§èƒ½å¤Ÿç¡®ä¿ç±»èƒ½å¤Ÿè¢«æ‰©å±•çš„æ‰‹æ®µï¼Œä½†æ˜¯è¦å°å¿ƒä¸è¦è¿åSRPï¼Œå½“æƒ³è®©ä¸€ä¸ªç±»åšæ›´å¤šäº‹æƒ…çš„æ—¶å€™å°±å¾ˆå®¹æ˜“å‘ç”Ÿã€‚ ä¾‹å­è¯¥ä¾‹å­æ˜¯ä¸€ä¸ªè®¡ç®—ä¸ªäººæ‰€å¾—ç¨çš„ä¾‹å­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637class Individual: NSObject &#123; let salary : Double; let age : NSInteger; let name : String; let countryCode : String; init(salary : Double, age : NSInteger, name : String, countryCode : String) &#123; self.countryCode = countryCode; self.salary = salary; self.age = age; self.name = name; &#125;&#125;class TaxCalculator : NSObject &#123; public func calculate(_ individual : Individual) -&gt; Double &#123; var tax : Double; //Just use flat calculation algorithm for simplicity as //here we just use it to demostrate OCP. switch individual.countryCode &#123; case "cn": tax = individual.salary * 0.18; case "us": tax = individual.salary * 0.20; case "jp": tax = individual.salary * 0.50; default: tax = 0.1; &#125; return tax; &#125;&#125; ç°æœ‰è®¾è®¡çš„ç¼ºç‚¹ç°æœ‰è®¾è®¡çš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å¢åŠ ä¸€ä¸ªæ–°çš„å›½å®¶çš„ä¸ªç¨è®¡ç®—ï¼Œåˆ™ä¸€å®šéœ€è¦æ›´æ”¹ç°æœ‰çš„TaxCalculatorçš„ä»£ç ã€‚æ˜¾ç„¶ï¼Œå½“å‰è®¾è®¡ä¸å¯¹æ‰©å±•å¼€æ”¾ã€‚ ä¸€ä¸ªæ›´å¥½çš„ç¬¦åˆOCPçš„è®¾è®¡123456789101112131415161718192021222324252627protocol CalculateTax &#123; func calculate(_ individual : Individual) -&gt; Double;&#125;class ChinaTaxCalculator: NSObject, CalculateTax &#123; public func calculate(_ individual: Individual) -&gt; Double &#123; return individual.salary * 0.18; &#125;&#125;class USATaxCalculator: NSObject, CalculateTax &#123; public func calculate(_ individual: Individual) -&gt; Double &#123; return individual.salary * 0.20; &#125;&#125;class JapanTaxCalculator: NSObject, CalculateTax &#123; public func calculate(_ individual: Individual) -&gt; Double &#123; return individual.salary * 0.50; &#125;&#125;class TaxCalculator: NSObject &#123; public func calculate(taxHandler : CalculateTax, individual : Individual) -&gt; Double &#123; return taxHandler.calculate(individual); &#125;&#125; ç°åœ¨ï¼Œå¦‚æœå¢åŠ ä¸€ä¸ªå›½å®¶çš„ç¨æ”¶è®¡ç®—ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ªç›¸åº”å›½å®¶çš„ç¨æ”¶è®¡ç®—ç±»XXTaxCalculatorå³å¯ï¼Œå¹¶ä¸éœ€è¦æ›´æ”¹ä»»ä½•å·²æœ‰ä»£ç ã€‚å¦‚æœé¡¹ç›®æŒ‰ç…§ä»¥ä¸‹åˆ’åˆ†ç¨‹åºä¾èµ–åº“çš„ç»“æ„ï¼Œåˆ™åªéœ€è¦é‡æ–°ç¼–è¯‘å…·ä½“å®ç°äº†å„ä¸ªå›½å®¶ç¨æ”¶çš„åº“å°±è¡Œäº†ã€‚ Liskovæ›¿æ¢åŸåˆ™(LSP) Liskov æ›¿æ¢åŸåˆ™è¯´çš„æ˜¯å¦‚æœDæ˜¯Bçš„æ´¾ç”Ÿç±»ï¼Œåˆ™ä»»ä½•Bçš„åº”ç”¨éƒ½å¿…é¡»èƒ½å¤Ÿè¢«Dçš„å®ä¾‹æ›¿æ¢è€Œä¸ä¼šå½±å“åˆ°ç¨‹åºè¿è¡Œçš„é€»è¾‘æˆ–è€…åŠŸèƒ½ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ´¾ç”Ÿç±»å¿…é¡»èƒ½å¤Ÿå®Œå…¨æ›¿æ¢åŸºç±»ã€‚ æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªå¤§æ¦‚åªè¦ä½ å­¦LiskovåŸåˆ™éƒ½ä¼šçœ‹åˆ°çš„ä¸€ä¸ªè¿åLiskovåŸåˆ™çš„ä¾‹å­ã€‚ è¿åLiskovæ›¿æ¢åŸåˆ™çš„ä¾‹å­1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253class Rectangle &#123; public var width : Double; public var height : Double; init(width : Double, height : Double) &#123; self.width = width; self.height = height; &#125; func area() -&gt; Double &#123; return self.width * height; &#125;&#125;class Square : Rectangle &#123; fileprivate var _width : Double = 0; fileprivate var _height : Double = 0; override public var width: Double &#123; get &#123; return _width; &#125; set(newWidth) &#123; _width = newWidth; _height = newWidth; &#125; &#125; override public var height: Double &#123; get &#123; return _height; &#125; set (newHeight) &#123; _width = newHeight; _height = newHeight; &#125; &#125;&#125;func createRectangle(width : Double, height : Double) -&gt; Rectangle &#123; return Square(width: width, height: height);&#125;///////////////////////////////////////////////////////////////////////Someday we use createRectangle method somewhere in our application.var rect:Rectangle = createRectangle(width : 3, height : 3);rect.area();//result is 9 as expectedrect.height = 10;rect.width = 5;rect.area();//opps!result is 25 not 50! ç»“è®ºè¿™ä¸ªåŸåˆ™æ˜¯å¯¹OCPçš„ä¸€ä¸ªæ‰©å±•ï¼Œä»–å‘Šè¯‰æˆ‘ä»¬ä»åŸºç±»æ´¾ç”Ÿå‡ºæ–°çš„æ´¾ç”Ÿç±»çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯ä¸è¦ç ´ååŸæœ‰çš„è¡Œä¸ºã€‚ æ¥å£éš”ç¦»åŸåˆ™(ISP) æ¥å£éš”ç¦»åŸåˆ™è®²çš„æ˜¯æ¥å£å®ç°è€…ä¸èƒ½è¢«å¼ºè¿«å®ç°æˆ–è€…ä¾èµ–ä¸€äº›ä¸ä¼šç”¨åˆ°çš„æ–¹æ³• ä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬å°†ä¸€ä¸ªæ¨¡å—ä»åº”ç”¨ç¨‹åºä¸­æŠ½è±¡å‡ºå¤šä¸ªå­æ¨¡å—çš„æ—¶å€™éœ€è¦å°å¿ƒæ³¨æ„äº†ã€‚å‡è®¾è¿™ä¸ªæ¨¡å—æ˜¯åŸºäºç±»å®ç°çš„ï¼Œé‚£æˆ‘ä»¬èƒ½å¤Ÿä»ç±»æŠ½è±¡å‡ºæ¥å£ï¼ˆæ³¨ï¼šè¿™äº›æ¥å£éƒ½ä¼šåœ¨ç°æœ‰ç³»ç»Ÿè¢«é€ä¸€å®ç°ï¼‰ã€‚ä½†å½“æˆ‘ä»¬æŠŠæ¨¡å—åŠ å…¥åˆ°ä¸€ä¸ªä¸åŸç³»ç»Ÿç›¸æ¯”ä»…å«æœ‰æŸäº›æ¥å£çš„å®ç°ï¼Œæœ‰å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§ç»“æœï¼šä¸ºäº†ä¿è¯æ¨¡å—èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä¸å¾—ä¸åœ¨æ–°ç³»ç»Ÿä¸­è¢«è¿«å®ç°æ‰€æœ‰çš„æ¥å£å¹¶ä¸”æœ‰ç›¸å½“ä¸€éƒ¨åˆ†æ¥å£ä¸ä¼šè¢«ç”¨åˆ°ï¼Œè¿™éƒ¨åˆ†ä¸ä¼šè¢«ç”¨åˆ°çš„æ¥å£é€šå¸¸ä¸ºç©ºå®ç°æˆ–è€…è¿”å›è™šå‡å€¼ï¼Œå°±ä¸ºäº†å®ç°æ¥å£è€Œå®ç°ã€‚é€šå¸¸å‘ç”Ÿè¿™ç§æƒ…å†µçš„æ¥å£å«åšèƒ–æ¥å£æˆ–è€…è¢«æ±¡æŸ“çš„æ¥å£ã€‚ ä¸€ä¸ªè¿åäº†ISPçš„å®é™…ä¾‹å­åœ¨æ—©æœŸçš„ASP.NET 2.0ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœç½‘ç«™æƒ³å®ç°è‡ªå·±çš„membership providerï¼Œåˆ™éœ€è¦å°†éœ€è¦æˆ–è€…ä¸éœ€è¦çš„æ‰€æœ‰æ¥å£éƒ½å®ç°ä¸€éã€‚å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149public class CustomMembershipProvider : MembershipProvider&#123; public override string ApplicationName &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; set &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override bool ChangePassword(string username, string oldPassword, string newPassword) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override bool ChangePasswordQuestionAndAnswer(string username, string password, string newPasswordQuestion, string newPasswordAnswer) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override MembershipUser CreateUser(string username, string password, string email, string passwordQuestion, string passwordAnswer, bool isApproved, object providerUserKey, out MembershipCreateStatus status) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override bool DeleteUser(string username, bool deleteAllRelatedData) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override bool EnablePasswordReset &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override bool EnablePasswordRetrieval &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override MembershipUserCollection FindUsersByEmail(string emailToMatch, int pageIndex, int pageSize, out int totalRecords) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override MembershipUserCollection FindUsersByName(string usernameToMatch, int pageIndex, int pageSize, out int totalRecords) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override MembershipUserCollection GetAllUsers(int pageIndex, int pageSize, out int totalRecords) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override int GetNumberOfUsersOnline() &#123; throw new Exception("The method or operation is not implemented."); &#125; public override string GetPassword(string username, string answer) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override MembershipUser GetUser(string username, bool userIsOnline) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override MembershipUser GetUser(object providerUserKey, bool userIsOnline) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override string GetUserNameByEmail(string email) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override int MaxInvalidPasswordAttempts &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override int MinRequiredNonAlphanumericCharacters &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override int MinRequiredPasswordLength &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override int PasswordAttemptWindow &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override MembershipPasswordFormat PasswordFormat &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override string PasswordStrengthRegularExpression &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override bool RequiresQuestionAndAnswer &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override bool RequiresUniqueEmail &#123; get &#123; throw new Exception("The method or operation is not implemented."); &#125; &#125; public override string ResetPassword(string username, string answer) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override bool UnlockUser(string userName) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override void UpdateUser(MembershipUser user) &#123; throw new Exception("The method or operation is not implemented."); &#125; public override bool ValidateUser(string username, string password) &#123; throw new Exception("The method or operation is not implemented."); &#125;&#125; Holy crap! è¿™æ˜¯ä¸€å¤§å †ä¸œè¥¿ï¼å¯èƒ½æœ‰çš„æ—¶å€™ï¼Œä½ ä»…ä»…æ˜¯æƒ³å°†ç°æœ‰çš„membership providerçš„ä¸€éƒ¨åˆ†æ”¹å˜æˆè‡ªå·±çš„è€Œå·²ï¼Œä½†æ˜¯ä½ è¦é¢å¯¹çš„æ˜¯å…¨éƒ¨å®ç°ï¼Œè¿™å°±éº»çƒ¦äº†ã€‚å¦‚æœä½ ä¸æ‡‚ASP.NETæ²¡å…³ç³»ï¼Œè¿™é‡Œè¿™ä¸ªä¾‹å­åªæ˜¯æƒ³å±•ç¤ºä¸€ç§è¿åäº†ISPåçš„ç»“æœã€‚ ä¸€ä¸ªæ›´ç®€å•é€šä¿—çš„ä¾‹å­æ¥è¯´æ˜ISPé¦–å…ˆçœ‹ä»£ç ï¼š 123456789101112131415protocol Animal &#123; func feed();&#125;class Dog : Animal &#123; func feed() &#123; print("feed with bone"); &#125;&#125;class Snake : Animal &#123; func feed() &#123; print("feed with mice"); &#125;&#125; éšåï¼Œä½ æ³¨æ„åˆ°æœ‰äº›åŠ¨ç‰©æ˜¯å® ç‰©ï¼Œæœ‰å® ç‰©çš„ä¸€äº›ç‰¹æ€§æˆ–è€…ä¸äººäº’åŠ¨çš„æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425protocol Animal &#123; func feed(); //æ¢³ç†æ¯›å‘ func groom();&#125;class Dog : Animal &#123; func feed() &#123; print("feed with bone"); &#125; func groom() &#123; print("grooming and dog feel comfortable"); &#125;&#125;class Snake : Animal &#123; func feed() &#123; print("feed with mice"); &#125; func groom() &#123; //ignore this method as I am not going to groom a feaking snake. &#125;&#125; å†™åˆ°è¿™é‡Œï¼Œä½ å°±å‘ç°é—®é¢˜äº†ã€‚Animalæ¥å£è¢«æ±¡æŸ“äº†ã€‚åœ¨Snakeç±»ä¸Šå®ƒè¦æ±‚æˆ‘ä»¬å®ç°ä¸€ä¸ªå¹¶ä¸éœ€è¦çš„æ–¹æ³•ã€‚å¥½çš„åšæ³•æ˜¯æŠŠå® ç‰©ç›¸å…³çš„æ–¹æ³•æŠ½è±¡å‡ºæ¥ã€‚ 123456789101112131415161718192021222324protocol Animal &#123; func feed();&#125;protocol Pet &#123; //æ¢³ç†æ¯›å‘ func groom();&#125;class Dog : Animal, Pet &#123; func feed() &#123; print("feed with bone"); &#125; func groom() &#123; print("grooming and dog feel comfortable"); &#125;&#125;class Snake : Animal &#123; func feed() &#123; print("feed with mice"); &#125;&#125; ä¾èµ–åè½¬(DIP) A. High-level æ¨¡å—ä¸åº”è¯¥ä¾èµ– low-level æ¨¡å—ã€‚ä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡B. æŠ½è±¡ä¸èƒ½ä¾èµ–äºå…·ä½“å®ç°ã€‚å…·ä½“å®ç°åº”è¯¥ä¾èµ–äºæŠ½è±¡ ä¾‹å­ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨DAO(Database access object)æ¥å°è£…æ•°æ®åº“æ“ä½œçš„é€»è¾‘ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå°†æ•°æ®åº“å…·ä½“çš„ç±»OracleConnectionç›´æ¥åœ¨DAOç±»é‡Œé¢äº†ã€‚é‚£å¦‚æœæˆ‘ä»¬æƒ³æŠŠæ•°æ®åº“æ¢æˆMysqlï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿï¼ˆæƒ³æƒ³ä¸€ä¸‹ï¼Œæœ‰å¾ˆå¤šDAOç±»ï¼Œé‡Œé¢çš„é€»è¾‘éƒ½å¾ˆå¤æ‚å¾ˆå¤šï¼‰ 123456789101112131415161718192021222324252627class OracleConnection &#123; public func open() &#123; //open database connection logic &#125; public func close() &#123; &#125;&#125;class DAO &#123; public var databaseConnection : OracleConnection; init() &#123; databaseConnection = OracleConnection(); &#125; public func commitChanges() &#123; databaseConnection.open(); //deal with data base changes databaseConnection.close(); &#125;&#125; ç¬¦åˆDIPçš„å†™æ³•: 1234567891011121314151617181920212223242526272829303132333435363738394041protocol DatabaseConnection &#123; func open(); func close();&#125;class OracleConnection : DatabaseConnection &#123; public func open() &#123; //open database connection logic &#125; public func close() &#123; &#125;&#125;class MysqlConnection : DatabaseConnection &#123; public func open() &#123; //open database connection logic &#125; public func close() &#123; &#125;&#125;class DAO &#123; public let databaseConnection : DatabaseConnection; init(databaseConnection : DatabaseConnection) &#123; self.databaseConnection = databaseConnection; &#125; public func commitChanges() &#123; databaseConnection.open(); //deal with data base changes databaseConnection.close(); &#125;&#125; å’‹ä¸€çœ‹ï¼Œç»†èŠ‚ä¸Šå¯èƒ½è·ŸLiskovè¦æ±‚çš„å¾ˆåƒï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼ŒDIPä¸»è¦å¼ºè°ƒçš„æ˜¯æ¨¡å—ä¹‹é—´çš„ä¾èµ–ã€‚ä¸‹é¢ç”¨ä¸€ä¸ªä¾‹å­æ¥æ„Ÿå—ä¸€ä¸‹]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>OOD</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>æ•æ·å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœ€çŸ­è·¯å¾„ä¹‹è¿ªæ°æ–¯ç‰¹æ‹‰ç®—æ³•]]></title>
    <url>%2F2017%2F07%2F28%2Falgorithm-dijstra%2F</url>
    <content type="text"><![CDATA[123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137#include &lt;iostream&gt;#include &lt;fstream&gt;#include &lt;vector&gt;using std::cin;using std::cout;using std::vector;//maximum number of nodesconst int maxnum = 100;//maxWeight represents infinite largeconst int maxWeight = 99999;//////Calculate the shortest path based on dijstra algorithm.//////@param v source node index///@param n number of nodes///@param dist to save the distance between the ith node and the source node ///@param record the ith node's previous node.///@param arcs line matrixvoid dijstra(int v, int n, int *dist, int *prev, int arcs[maxnum][maxnum]) &#123; //bool array marks which node has been put to S. //S is an array that contains nodes which makes up of the shortest path. bool included[n]; for(int i = 0; i &lt; n; i++) &#123; included[i] = false; dist[i] = arcs[v][i]; //if the distance is not maxWeight, then it means there //is a line between the v and the ith node. so set the ith //node's previous to v. if(dist[i] &lt; maxWeight) &#123; prev[i] = v; &#125; else &#123; prev[i] = -1; &#125; &#125; //start from the source node v, so put it to S by default. included[v] = true; //self to self is 0. dist[v] = 0; for(int i = 1; i &lt; n; i++) &#123; int min = maxWeight; int w; //find min distance between the source node and the ith //node. the ith node must not be in S. for(int j = 0; j &lt; n; j++) &#123; if(!included[j] &amp;&amp; dist[j] &lt; min) &#123; min = dist[j]; w = j; &#125; &#125; //put the w node into the S. included[w] = true; for(int j = 0; j &lt; n; j++) &#123; if(!included[j] &amp;&amp; min + arcs[w][j] &lt; dist[j]) &#123; dist[j] = min + arcs[w][j]; prev[j] = w; &#125; &#125; &#125;&#125;int main() &#123; std::ifstream ifin; //number of nodes int n; //number of lines int lines; int arcs[maxnum][maxnum]; ifin.open("sample.txt"); if(ifin.is_open()) &#123; ifin &gt;&gt; n; ifin &gt;&gt; lines; for(int i = 0; i &lt; lines; i++) &#123; int row, column, weight; ifin &gt;&gt; row &gt;&gt; column &gt;&gt; weight; arcs[row][column] = weight; &#125; &#125; else &#123; cout &lt;&lt; "could not open sample.txt " &lt;&lt; std::endl; return 0; &#125; ifin.close(); cout &lt;&lt; n &lt;&lt; " nodes " &lt;&lt; std::endl; cout &lt;&lt; lines &lt;&lt; " lines " &lt;&lt; std::endl; //to save the distance between the ith node and the source node int dist[n]; //to record the ith node's previous node. int prev[n]; //init arcs for(int i = 0; i &lt; n; i++) &#123; for(int j = 0; j &lt; n; j++) &#123; if(arcs[i][j] == 0) &#123; arcs[i][j] = maxWeight; &#125; cout &lt;&lt; arcs[i][j] &lt;&lt; "\t"; &#125; cout &lt;&lt; std::endl; &#125; const int v = 0; dijstra(v, n, dist, prev, arcs); cout &lt;&lt; "distance between "&lt;&lt; v &lt;&lt;" and last point is :" &lt;&lt; dist[n-1] &lt;&lt; std::endl; cout &lt;&lt; "shortest path is ["; int k = n - 1; vector&lt;int&gt; path(1,k); while(prev[k] &gt;= 0) &#123; k = prev[k]; path.push_back(k); &#125; for(vector&lt;int&gt;::reverse_iterator iter = path.rbegin(); iter != path.rend(); ++iter) &#123; cout &lt;&lt; *iter &lt;&lt; " "; &#125; cout &lt;&lt; "]" &lt;&lt; std::endl; return 0;&#125;]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ‰¾å‡ºä¸åŒ…å«æŸä¸ªå­—ç¬¦ä¸²çš„æ­£åˆ™è¡¨è¾¾å¼]]></title>
    <url>%2F2017%2F07%2F23%2Ffind-non-include-regex%2F</url>
    <content type="text"><![CDATA[æ‰¾å‡ºä¸åŒ…å«æŸä¸ªå­—ç¬¦ä¸²çš„æ­£åˆ™è¡¨è¾¾å¼ç»å¸¸æˆ‘ä»¬ä¼šé‡åˆ°æƒ³æ‰¾å‡ºä¸åŒ…å«æŸä¸ªå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚â€helloâ€çš„æ–‡æœ¬ï¼Œæœ€å®¹æ˜“æƒ³åˆ°çš„æ˜¯åœ¨æ­£åˆ™è¡¨è¾¾å¼é‡Œä½¿ç”¨[^hello]ï¼Œä½†è¿™æ ·çš„æ­£åˆ™è¡¨è¾¾å¼å®Œå…¨æ˜¯å¦å¤–ä¸€ä¸ªæ„æ€ï¼Œå®ƒçš„æ„æ€æ˜¯å­—ç¬¦ä¸²é‡Œä¸èƒ½åŒ…å«â€™hâ€™ï¼Œâ€™eâ€™ï¼Œâ€™lâ€™, â€˜oâ€™å››ä¸ªå•å­—ç¬¦ã€‚é‚£ä»€ä¹ˆæ ·çš„æ­£åˆ™è¡¨è¾¾å¼èƒ½è¿‡æ»¤å‡ºä¸åŒ…å«å®Œæ•´â€œhelloâ€å­—ä¸²çš„ä¿¡æ¯å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œè¯´æ­£åˆ™è¡¨è¾¾å¼é‡Œä¸æ”¯æŒé€†å‘åŒ¹é…å¹¶ä¸æ˜¯ç™¾åˆ†ä¹‹ç™¾çš„æ­£ç¡®ã€‚ æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¦å®šå¼æŸ¥æ‰¾æ¥æ¨¡æ‹Ÿå‡ºé€†å‘åŒ¹é…ï¼Œä»è€Œè§£å†³æˆ‘ä»¬çš„é—®é¢˜, è¡¨è¾¾å¼å¦‚ä¸‹ï¼š 1^((?!hello).)*$ ä¸Šé¢è¿™ä¸ªè¡¨è¾¾å¼å°±èƒ½è¿‡æ»¤å‡ºä¸åŒ…å«â€˜helloâ€™å­—ä¸²çš„ä¿¡æ¯ã€‚ å…ˆè§£é‡Šä¸€ä¸‹?!çš„ç”¨æ³•ï¼š é›¶å®½è´Ÿå‘å…ˆè¡Œæ–­è¨€(?!exp)ï¼Œåªä¼šåŒ¹é…åç¼€expä¸å­˜åœ¨çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œ\d{3}(?!\d)åŒ¹é…ä¸‰ä½æ•°å­—ï¼Œè€Œä¸”è¿™ä¸‰ä½æ•°å­—çš„åé¢ä¸èƒ½æ˜¯æ•°å­— ç°åœ¨è§£é‡Šè¡¨è¾¾å¼((?!hello).)*ï¼š è¡¨è¾¾å¼(?!hello).ä¼šå¾€å‰æŸ¥æ‰¾ï¼Œçœ‹çœ‹å‰é¢æ˜¯ä¸æ˜¯æ²¡æœ‰â€œhelloâ€å­—ä¸²ï¼Œå¦‚æœæ²¡æœ‰(æ˜¯å…¶å®ƒå­—ç¬¦)ï¼Œé‚£ä¹ˆ.(ç‚¹å·)å°±ä¼šåŒ¹é…è¿™äº›å…¶å®ƒå­—ç¬¦ã€‚è¿™ç§æ­£åˆ™è¡¨è¾¾å¼çš„â€œæŸ¥æ‰¾â€ä¹Ÿå«åšâ€œzero-width-assertionsâ€(é›¶å®½åº¦æ–­è¨€)ï¼Œå› ä¸ºå®ƒä¸ä¼šæ•è·ä»»ä½•çš„å­—ç¬¦ï¼Œåªæ˜¯åˆ¤æ–­ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹â€œNonnullhelloworldâ€è¿™ä¸ªå­—ç¬¦ä¸²ã€‚ (?!hello)ä¼šæ£€æŸ¥æ¯ä¸ªå­—ç¬¦ä¸²åé¢è·Ÿçš„æ˜¯ä¸æ˜¯â€˜helloâ€™ï¼Œå¦‚æœä¸æ˜¯ï¼Œ.å°±åŒ¹é…è¿™ä¸ªå­—ç¬¦ã€‚è¡¨è¾¾å¼(?!hello)åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥å°†è¿™ä¸ªè¡¨è¾¾å¼ç”¨æ‹¬å¼§åŒ…è£¹ç»„æˆç»„ï¼Œç„¶åç”¨æ˜Ÿå·*ä¿®é¥°æ¥åŒ¹é…é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ åŒ¹é…Nonnullhelloworldè¿”å›false, è¯´æ˜è¯¥å­—ç¬¦ä¸²å«æœ‰â€˜helloâ€™å­ä¸²ã€‚åŒ¹é…Nonnullworldè¿”å›trueåŒ¹é…Nonnullworldhelloè¿”å›falseåŒ¹é…helloè¿”å›false æ‰€ä»¥ï¼Œä½ å¯ä»¥è®¤ä¸ºå½“è¡¨è¾¾å¼è¿”å›falseçš„æ—¶å€™ï¼Œè¯´æ˜è¯¥å­—ç¬¦ä¸²åŒ…å«æŒ‡å®šå­ä¸²ã€‚ æœ€åæ¨èä¸€ä¸ªå¥½çš„ï¼Œå¿«é€Ÿçš„æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼çš„åœ¨çº¿ç½‘ç«™ï¼Œæˆ‘ç”¨èµ·æ¥å¾ˆä¸é”™(å±…ç„¶è¿˜æœ‰æ­£åˆ™è¡¨è¾¾å¼çš„è§£é‡Šï¼ŒçœŸæ˜¯æœ‰ç‚¹å¼ºå¤§å“ˆï¼Œè¿˜ä¸å¿«è‡ªå·±å°è¯•ä¸€ä¸‹)ï¼šhttps://regex101.com/]]></content>
      <categories>
        <category>æ­£åˆ™è¡¨è¾¾å¼</category>
      </categories>
      <tags>
        <tag>æ­£åˆ™è¡¨è¾¾å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React Component lifecycle]]></title>
    <url>%2F2017%2F07%2F18%2Freact-life-cycle%2F</url>
    <content type="text"><![CDATA[React Component lifecycleæœ€è¿‘åˆšå¼€å§‹ä½¿ç”¨react-nativeåšé¡¹ç›®ï¼Œæœ‰ä¸€äº›å¿ƒå¾—ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå‘è¡¨ä¸€ä¸‹ã€‚å¯¹æ²¡æœ‰æ¥è§¦è¿‡çš„æŠ€æœ¯å’Œå¼€å‘ç¯å¢ƒï¼Œäº†è§£æ ¸å¿ƒcomponentçš„ç”Ÿå‘½å‘¨æœŸæ˜¯éå¸¸é‡è¦çš„ã€‚èƒ½å¤Ÿä¿è¯åœ¨å†™ä»£ç çš„è¿‡ç¨‹ä¸­ä¸å®¹æ˜“çŠ¯é”™ã€‚ ä»€ä¹ˆæ˜¯componentï¼Ÿæ ¹æ®Reactå®˜æ–¹æ–‡æ¡£ï¼ŒReact.componentæ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ã€‚èƒ½å¤Ÿè®©ä½¿ç”¨è€…å°†UIæ‹†æˆå„ä¸ªç‹¬ç«‹åœ°ï¼Œå¯é‡ç”¨çš„componentã€‚å¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯ç»§æ‰¿å®ƒå¹¶æä¾›ä¸€ä¸ªrender()æ–¹æ³•ã€‚ 12345class Greeting extends React.Component &#123; render() &#123; return &lt;h1&gt;Hello, &#123;this.props.name&#125;&lt;/h1&gt;; &#125;&#125; React lifecycle methods ä¸Šé¢è¿™å¼ å›¾å±•ç¤ºäº†ä¸€ä¸ªReact componentçš„å£°æ˜å‘¨æœŸï¼Œä»åˆ›å»ºåˆ°é”€æ¯ã€‚æ¥ä¸‹æ¥å°†é€æ­¥ä»‹ç»ä»¥ä¸Šå„ä¸ªæ–¹æ³•å¹¶é˜è¿°ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä½¿ç”¨å®ƒä»¬ã€‚ Mountå•è¯ï¼Œå­—å…¸ä¸Šçš„æ„æ€æ˜¯ï¼šâ€to get up on something above the level of the ground; especially:to seat oneself (as on a horse) for ridingâ€ åé¢è¿™æ®µæ„æ€å¾ˆå½¢è±¡ï¼Œéª‘ä¸Šé©¬ï¼Œå¯ä»¥è·‘äº† :[ componentWillMount1componentWillMount() å½“è¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œè¯´æ˜ä½ çš„componentå°†è¦å‡ºç°åœ¨å±å¹•ä¸Šã€‚æ¸²æŸ“æ–¹æ³•renderå°†è¦è¢«è°ƒç”¨ã€‚åœ¨è¿™ä¸ªæ–¹æ³•å†…ä½ èƒ½å¹²ä»€ä¹ˆå‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼Œä½ å¯èƒ½ä¸èƒ½å¹²å¤ªå¤šçš„äº‹æƒ…ã€‚å› ä¸ºå½“componentWillMountè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰ä»»ä½•componentèƒ½å¤Ÿä½¿ç”¨ï¼Œæ‰€ä»¥ä½ ä¹Ÿæ— æ³•å¯¹DOMåšä»»ä½•äº‹æƒ…ã€‚ å¦å¤–ï¼Œå¤§éƒ¨åˆ†åˆå§‹åŒ–å·²ç»è¢«componentçš„constructorå®Œæˆäº†(æ„é€ å‡½æ•°æ˜¯ä½ åˆå§‹åŒ–é»˜è®¤å€¼çš„æœ€ä½³åœ°æ–¹) è¯´åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½è§‰å¾—è¿™ä¸ªæ–¹æ³•çœŸæ²¡ç”¨ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å¤–åœºæ™¯ï¼Œå°±æ˜¯å½“ä½ è¦åœ¨è¿è¡Œæ—¶ä¸ºæ•´ä¸ªappåˆå§‹åŒ–å…¨å±€é…ç½®çš„æ—¶å€™, å¹¶ä¸”è¦ä¿è¯ç¬¬ä¸€æ—¶é—´åˆå§‹åŒ–æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æœ‰ç‰¹åˆ«æœ‰ç”¨çš„ã€‚è¿™å°±æ„å‘³ç€ä½ çš„componentä¸­å‡ ä¹99%ä»¥ä¸Šéƒ½ä¸ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³•ã€‚ ä½ å¯èƒ½ä¼šçœ‹åˆ°æœ‰äººåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å¯åŠ¨AJAX callsæˆ–è€…æ‰§è¡Œä¸€ä¸ªPromiseå‡½æ•°ã€‚ä¸è¦è¿™æ ·åšï¼Œä¸‹é¢ä¼šè¯¦ç»†è®²è¿°åŸå› ã€‚ å¸¸ç”¨åœºæ™¯ï¼šéœ€è¦åœ¨è¿è¡Œæ—¶ç¡®å®šçš„Appç›¸å…³çš„é…ç½®æ˜¯å¦èƒ½å¤Ÿä½¿ç”¨setState: å¦ componentDidMount1componentDidMount() è¿™ä¸ªæ–¹æ³•è¿è¡Œæ—¶ï¼Œä½ çš„componentå·²ç»åŠ è½½ä¸Šå¹¶å·²å¯ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ä½ å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œä¾‹å¦‚ï¼š åœ¨ä¸€ä¸ªå·²ç»æ¸²æŸ“å¥½çš„ç”»æ¿ä¸Šç»˜åˆ¶æ–°çš„å…ƒç´  æ·»åŠ event listeners åŠ è½½æ•°æ®ã€‚ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ³•é‡Œé¢é€‚åˆåŠ è½½æ•°æ®å‘¢ï¼Ÿå› ä¸ºä½ æ— æ³•ä¿è¯ä¸€ä¸ªå¼‚æ­¥çš„è¯·æ±‚åœ¨componentåŠ è½½å®Œæˆä¹‹å‰å®Œæˆï¼Œå®ƒæ˜¯ä¸ç¡®å®šçš„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿˜å¯èƒ½ä¼šåœ¨component unmountä¹‹åè¯·æ±‚çš„responseæ‰è¿”å›å›æ¥ï¼Œè€Œè¿™ä¸ªæ—¶å€™å¦‚æœæ ¹æ®responseæ¥è®¾ç½®stateçš„è¯å°±ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚ä½¿ç”¨componentDidMountè‡³å°‘å¯ä»¥ä¿è¯åœ¨ç»“æœè¿”å›ä¹‹å‰æ˜¯æœ‰componentå¯ä»¥ä½¿ç”¨çš„ï¼ˆä½†æ˜¯ï¼Œå¦‚æœresponseè¿”å›æ—¶ä¸è¿›è¡Œå¤„ç†çš„è¯ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ã€‚æœ¬æ–‡æä¾›ä¸€ç§ES6 promiseçš„è§£å†³æ–¹æ¡ˆï¼Œè¯·çœ‹make cancelable promiseï¼‰ åŸºæœ¬ä¸Šï¼Œä½ å¯ä»¥åšä»»ä½•äº‹æƒ… å¸¸ç”¨åœºæ™¯ï¼šå‘èµ·Ajaxè¯·æ±‚æ¥åŠ è½½æ•°æ®æ˜¯å¦èƒ½å¤Ÿä½¿ç”¨setState: æ˜¯ componentWillReceiveProps1componentWillReceiveProps(nextProps) è¿™ä¸ªæ–¹æ³•è¢«ç”¨æ¥æ¥æ”¶æ–°çš„propsã€‚ä¹Ÿè®¸ä¸€äº›æ•°æ®åœ¨parent componentä¸­åŠ è½½å¹¶è¢«ä¼ åˆ°å½“å‰compoentä¸­ã€‚ å½“componentèƒ½å¤Ÿå¯¹æ–°çš„propsåšå‡ºä»»ä½•åŠ¨ä½œä¹‹å‰ï¼ŒcomponentWillReceivePropsä¼šè¢«è°ƒç”¨ã€‚ 12345componentWillReceiveProps(nextProps) &#123; if(nextProps.text !=== this.props.text) &#123; this.setState(&#123;text: nextProps.text&#125;); &#125;&#125; é€šè¿‡ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶è®¿é—®å½“å‰propså’ŒnextPropsã€‚æ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯ï¼š æ£€æŸ¥propsæ˜¯å¦æœ‰å˜åŒ– å¦‚æœæœ‰å˜åŒ–ï¼Œå°±åšå‡ºç›¸åº”çš„å˜åŒ– æ³¨æ„ Reactä¹Ÿè®¸ä¼šåœ¨propsæ²¡æœ‰å˜åŒ–çš„æ—¶å€™è°ƒç”¨è¯¥æ–¹æ³•ã€‚æ‰€ä»¥æ€»æ˜¯åˆ¤æ–­propsæ˜¯å¦å˜åŒ–æ˜¯æœ‰å¿…è¦çš„ã€‚è¿™ç§æƒ…å†µå¯èƒ½å‘ç”Ÿåœ¨parent componentå¼•èµ·å½“å‰ç»„ä»¶re-renderã€‚ Reactä¸ä¼šåœ¨componentåˆå§‹åŒ–ï¼Œè®¾ç½®åˆå§‹propsçš„è°ƒç”¨è¯¥æ–¹æ³• è°ƒç”¨this.setStateé€šå¸¸ä¸ä¼šè§¦å‘è¯¥æ–¹æ³• å¸¸ç”¨åœºæ™¯ï¼šé’ˆå¯¹propsçš„å˜åŒ–åšå‡ºç›¸åº”çš„çŠ¶æ€æ”¹å˜æ˜¯å¦èƒ½å¤Ÿä½¿ç”¨setState: æ˜¯ shouldComponentUpdate1shouldComponentUpdate(nextProps, nextState) ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å‘Šè¯‰Reactå½“å‰stateæˆ–è€…propsçš„å˜åŒ–æ˜¯å¦ä¼šå¼•èµ·re-renderã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•æ€»æ˜¯è¿”å›trueï¼Œå³éœ€è¦re-renderã€‚å¦‚æœä½ æƒ³è¦é¿å…ä¸€äº›æ— æ„ä¹‰æˆ–è€…çº¯å±æµªè´¹çš„re-renderï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä½ æœ€å¥½çš„é€‰æ‹©ã€‚ P.S æ ¹æ®reactæœ€æ–°å®˜æ–¹æ–‡æ¡£ï¼Œç›®å‰ï¼Œå¦‚æœshouldComponentUpdateæ–¹æ³•è¿”å›false,åˆ™componentWillUpdate(), render() å’Œ componentDidUpdate()æ–¹æ³•éƒ½ä¸ä¼šè¢«è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œåœ¨æœªæ¥çš„reactç‰ˆæœ¬ä¸­ï¼Œ shouldComponentUpdateçš„è¿”å›å€¼åªå…·æœ‰å‚è€ƒä»·å€¼è€Œä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œæ‰€ä»¥æ–¹æ³•è¿”å›falseåcomponentä¹Ÿæœ‰å¯èƒ½ä¼šre-renderã€‚ å¸¸ç”¨åœºæ™¯ï¼šæ§åˆ¶componentæ˜¯å¦éœ€è¦re-renderæ˜¯å¦èƒ½å¤Ÿä½¿ç”¨setState: NO componentWillUpdate1componentWillUpdate(nextProps, nextState) è¿™ä¸ªæ–¹æ³•åœ¨re-renderä¹‹å‰ä¼šè¢«è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•è·Ÿ componentWillReceivePropsç±»ä¼¼ï¼Œåªæ˜¯ä½ ä¸èƒ½åœ¨è¯¥æ–¹æ³•é‡Œè°ƒç”¨this.setStateã€‚ å¦‚æœä½ çš„componentä½¿ç”¨äº†shouldComponentUpdateå¹¶ä¸”å½“propså˜åŒ–çš„æ—¶å€™éœ€è¦åšä¸€äº›äº‹æƒ…ï¼Œé‚£ä¹ˆcomponentWillUpdateæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ å¸¸ç”¨åœºæ™¯ï¼šåœ¨æœ‰shouldComponentUpdateæ–¹æ³•çš„componentä¸­é…åˆç€ç”¨æ˜¯å¦èƒ½å¤Ÿä½¿ç”¨setState: NO componentDidUpdate1componentDidUpdate(prevProps, prevState) åœ¨component æ›´æ–°ä¹‹åï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥æ“ä½œDOMã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªå‘é€ç½‘ç»œè¯·æ±‚çš„å¥½çš„é€‰æ‹©ä¹‹ä¸€ï¼Œå‰ææ˜¯éœ€è¦åˆ¤æ–­å½“å‰propså’ŒprevPropsç›¸æ¯”æ˜¯å¦äº§ç”Ÿäº†å˜åŒ–ï¼ˆå¦‚æœpropsæ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸éœ€è¦å‘é€ç½‘ç»œè¯·æ±‚ï¼‰ å¸¸ç”¨åœºæ™¯ï¼šæ ¹æ®propsæˆ–è€…stateçš„å˜åŒ–ï¼Œå¯¹DOMè¿›è¡Œç›¸åº”çš„å˜åŒ–æ˜¯å¦èƒ½å¤Ÿä½¿ç”¨setState: YES componentDidUpdate1componentWillUnmount() è¿™ä¸ªæ–¹æ³•ä¼šåœ¨componentä»å±å¹•ä¸Šç§»é™¤å’Œé”€æ¯ä¹‹å‰è°ƒç”¨ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä½ éœ€è¦è¿›è¡Œä»»ä½•å¿…è¦çš„æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚å–æ¶ˆnetwork requestï¼Œinvalidate timersï¼Œremove event listenersæˆ–è€…æ¸…é™¤ä»»ä½•åœ¨componentDidMount()ä¸­åˆ›å»ºçš„DOMå…ƒç´ ã€‚ å¸¸ç”¨åœºæ™¯ï¼šæ¸…ç†ä¸€åˆ‡éœ€è¦å¿…é¡»æ¸…ç†çš„èµ„æºï¼Œäº‹åŠ¡æˆ–è€…äº‹ä»¶æ˜¯å¦èƒ½å¤Ÿä½¿ç”¨setState: NO make cancelable promiseä½¿ç”¨Promiseå‘èµ·å¼‚æ­¥è¯·æ±‚ï¼Œç­‰åˆ°å¼‚æ­¥è¯·æ±‚è¿”å›çš„æ—¶å€™ï¼Œcomponentæœ‰å¯èƒ½å·²ç»unmountedäº†ã€‚è¿™ä¸ªæ—¶å€™åœ¨responseçš„callbackå°è¯•setStateä¼šå¼•å‘å¼‚å¸¸ã€‚æ€ä¹ˆé¿å…è¿™ç§æƒ…å†µå‘¢ï¼Ÿ æ„Ÿè°¢@istarkovæä¾›äº†ä¸€ç§å¯å–æ¶ˆçš„Promiseçš„æ–¹æ¡ˆï¼š 1234567891011121314151617const makeCancelable = (promise) =&gt; &#123; let hasCanceled_ = false; const wrappedPromise = new Promise((resolve, reject) =&gt; &#123; promise.then( val =&gt; hasCanceled_ ? reject(&#123;isCanceled: true&#125;) : resolve(val), error =&gt; hasCanceled_ ? reject(&#123;isCanceled: true&#125;) : reject(error) ); &#125;); return &#123; promise: wrappedPromise, cancel() &#123; hasCanceled_ = true; &#125;, &#125;;&#125;; å¦‚ä½•ä½¿ç”¨ï¼š 12345678910const cancelablePromise = makeCancelable( new Promise(r =&gt; component.setState(&#123;...&#125;&#125;)));cancelablePromise .promise .then(() =&gt; console.log('resolved')) .catch((reason) =&gt; console.log('isCanceled', reason.isCanceled));cancelablePromise.cancel(); // Cancel the promise]]></content>
      <categories>
        <category>javascript</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOS å†…è´­å•†å“ç±»å‹]]></title>
    <url>%2F2017%2F07%2F16%2Fios-iap-product-types%2F</url>
    <content type="text"><![CDATA[iOS å†…è´­å•†å“ç±»å‹ç”±äºæœ€è¿‘çš„é¡¹ç›®æœ‰IAPï¼Œæ‰€ä»¥åˆé‡æ¸©äº†ä¸€éiOS IAPçš„çŸ¥è¯†ã€‚åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ç½‘ç»œä¸Šçš„å„ç§æ–‡æ¡£éƒ½æœ‰ï¼Œå½“ç„¶æœ€è¯¦ç»†çš„è¿˜æ˜¯è‹¹æœå®˜æ–¹IAPæ–‡æ¡£ï¼Œä½†æ˜¯è‹¹æœå¯¹æ¯ç§ç±»å‹ä»‹ç»å¤ªå®˜æ–¹(å®˜è¯)ï¼Œè®©åˆšå¼€å§‹çœ‹çš„äººä¸å¤ªå®¹æ˜“å¼„æ‡‚æ¯ç§å•†å“çš„åŒºåˆ«ã€‚å¦å¤–ï¼Œæ·±åˆ»ç†è§£æ¯ç§å•†å“å¯¹åé¢çš„å¼€å‘éå¸¸æœ‰å¸®åŠ©ã€‚æ‰€ä»¥ï¼Œæˆ‘è§‰å¾—æœ‰å¿…è¦è¯´ä¸€ä¸‹ã€‚ IAPçš„ç±»å‹ä¸€å…±4ç§ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘å°†å¯¹æ¯ä¸€ç§è¿›è¡Œé€šä¿—æ˜“æ‡‚çš„è§£é‡Šã€‚ Consumable products (æ¶ˆè´¹ç±»å‹å†…è´­)è‹¹æœå®˜æ–¹è§£é‡Š Items that get used up over the course of running your app. Examples include minutes for a Voice over IP app and one-time services such as voice transcription. è¿™ç§äº§å“ç±»å‹åº”è¯¥å¤§å®¶éƒ½çŸ¥é“ï¼Œå¾ˆå¥½æ‡‚ã€‚ä½†æ˜¯å¦‚æœä»…æ ¹æ®è‹¹æœçš„ä¸¤ä¸ªä¾‹å­ï¼Œè¿™ä¸¤ä¸ªä¾‹å­éƒ½æ˜¯è·Ÿè¯­éŸ³é€šè¯ç›¸å…³ï¼Œä¸€ä¸ªæ²¡ä½¿ç”¨è¿‡ä»»ä½•å†…è´­çš„äººè¿˜çœŸä¸å¥½ç†è§£ã€‚é€šä¿—æ¥è®²ï¼Œå°±å¥½æ¯”ä½ å»èœå¸‚åœºé‡Œè¾¹ï¼Œä½ èŠ±Xå…ƒä¹°äº†Yä¸ªè‹¹æœï¼Œç„¶åè¿™ä¸ªäº¤æ˜“å°±å®Œæˆäº†ã€‚ è¯¥ç±»å‹çš„å†…è´­çš„ä¾‹å­å¾ˆå¤šï¼Œæ¯”å¦‚ä½ ç©æ¸¸æˆçš„æ—¶å€™ï¼ŒèŠ±äº†Xå…ƒä¹°äº†Nä¸ªé’»çŸ³ï¼›èŠ±Xå…ƒå…‘æ¢äº†Nä¸ªè™šæ‹Ÿå¸ç”¨äºè´­ä¹°appä¸­çš„æŸäº›è™šæ‹ŸæœåŠ¡ç­‰ã€‚ é¡¾åæ€ä¹‰ï¼Œè¿™ç§ç±»å‹çš„å•†å“çš„ç‰¹ç‚¹å°±æ˜¯å•†å“å¯æ¶ˆè€—ï¼Œå¯é‡å¤è´­ä¹°ã€‚æ¯æ¬¡è´­ä¹°çš„å€¼ä¸€èˆ¬éƒ½ä¼šå åŠ ã€‚å¦‚æœä¹°äº†åï¼Œç”¨æˆ·ä¸æ¶ˆè€—ï¼Œåˆ™ä¸€ç›´å­˜åœ¨ç”¨æˆ·ç›¸å…³çš„è´¦å·ä¸­ã€‚ Non-consumable products (éæ¶ˆè´¹ç±»å‹å†…è´­)è¯¥ç§ç±»å‹çš„å•†å“ä¸»è¦ç”¨äºè§£é”appä¸Šçš„ä¸€äº›åŠŸèƒ½ï¼Œæˆ–è€…æ¸¸æˆçš„æŸä¸ªå…³å¡ï¼Œåˆæˆ–è€…æ˜¯è·å¾—æŸé¡¹ä¸»é¢˜ä¹‹ç±»çš„ã€‚æ€»ä¹‹å°±æ˜¯å½“ç”¨æˆ·è´­ä¹°åï¼Œè¿™ä¸ªå•†å“å°±ä¸€ç›´ç”Ÿæ•ˆï¼Œä¸éœ€è¦é‡å¤è´­ä¹°ã€‚ Auto-renewable subscriptions (è‡ªåŠ¨ç»­è´¹ç±»å‹çš„å†…è´­)è¿™ç§ç±»å‹çš„å•†å“æœ‰ç‚¹è·ŸNon-consumableå•†å“ç±»ä¼¼ï¼Œç›®çš„éƒ½æ˜¯ç”¨æˆ·ä»˜é’±åæä¾›appä¸­ç‰¹å®šçš„æŸäº›åŠŸèƒ½ã€‚æœ€å¤§çš„ä¸åŒæ˜¯ï¼Œè¯¥ç±»å•†å“æœ‰æ˜¯æœ‰æœŸé™çš„ã€‚æ¯”å¦‚ï¼ŒæŸäº›appçš„VIPç³»ç»Ÿï¼Œè¿™ç§ç³»ç»Ÿä¸€èˆ¬æŒ‰æœˆè®¡ç®—ï¼Œéœ€è¦ç”¨æˆ·æŒ‰ç…§ä»·æ ¼æ¯æœˆæ‰£è´¹ã€‚åªæœ‰ç”¨æˆ·ç»­è´¹åï¼ŒVIPæ‰ç”Ÿæ•ˆå¹¶ä¸”VIPç›¸å…³çš„ç‰¹æƒæ‰èƒ½å¤Ÿç”Ÿæ•ˆã€‚è¿‡æœŸä¸ç»­è´¹ï¼Œåˆ™VIPå¤±æ•ˆã€‚ è¯¥ç±»å•†å“ä¸Non-consumable productsçš„åŒºåˆ«æ˜¯ æœ‰è¿‡æœŸæ—¶é—´ å¯é‡å¤è´­ä¹°(ç³»ç»Ÿè‡ªåŠ¨ç»­è®¢) è¯¥ç±»å•†å“çš„å†…å®¹ä¸€èˆ¬éƒ½ä¼šä¸æ–­çš„æ›´æ–° ä¸Consumable productsçš„åŒºåˆ«æ˜¯ è¿™ç§å•†å“ä¹°äº†å°±ç­‰äºå¼€å§‹æ¶ˆè€—ï¼Œä¸ç”¨ç”¨æˆ·ä¸»åŠ¨è¿›è¡Œåç»­æ“ä½œ æœ‰è¿‡æœŸæ—¶é—´ è‹¹æœç³»ç»Ÿè‡ªåŠ¨å¸®ç”¨æˆ·ç»­è´¹è´­ä¹° Non-renewable subscriptionsè¿™ç§ç±»å‹çš„å•†å“è·ŸAuto-renewable subscriptionsçš„å•†å“éå¸¸åƒï¼Œç›®çš„ä¹Ÿæ˜¯ä¸ºäº†ç»™ç”¨æˆ·æä¾›æŒç»­æœåŠ¡çš„ç±»å‹ã€‚æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼Œä¸è¯¥å•†å“ç›¸å…³çš„ç»­è®¢çš„ä¿¡æ¯éƒ½ç”±ä½ çš„æœåŠ¡å™¨ä¿å­˜å’Œå¤„ç†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å¦‚æœä½ é€‰äº†Auto-renewable subscriptionsï¼Œåˆ™è‹¹æœå¸®ä½ æå®šä¸€åˆ‡ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„è‡ªåŠ¨ç»­è®¢ã€‚ä½†å¦‚æœä½ é€‰äº†Non-renewable subscriptionsåšä¸ºä½ æä¾›çš„å•†å“çš„ç±»å‹ï¼Œåˆ™ä½ éœ€è¦è´Ÿè´£ç»­è®¢ä»¥åŠè¿‡æœŸæ—¶é—´çš„ç®¡ç†ï¼Œä»¥åŠè®©ç”¨æˆ·è´­ä¹°çš„å•†å“åœ¨ç”¨æˆ·æ‰€æœ‰çš„è®¾å¤‡ä¸Šå¯ç”¨ï¼ˆåªè¦ç”¨æˆ·æ­£ç¡®ç™»å½•ä½ çš„æœåŠ¡å™¨ï¼‰ã€‚å“¦ï¼Œå¯¹äº†ï¼Œè¿˜æœ‰æ¢å¤è´­ä¹°ä¹Ÿéœ€è¦ä½ è´Ÿè´£ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»€ä¹ˆæ˜¯Javascript Hoistingï¼Ÿ]]></title>
    <url>%2F2017%2F07%2F08%2Fjavascript-Hoisting%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯Javascript hoisting?Javascript hoisting å›½å†…ä¸€èˆ¬ç¿»è¯‘ä¸ºå˜é‡æå‡ã€‚ Hoistingè¿™ä¸ªè¯æ˜¯ç”¨æ¥æè¿°Javascriptåœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå°¤å…¶æ˜¯åˆ›å»ºå’Œæ‰§è¡Œå˜é‡æ—¶æ—¶å¦‚ä½•å·¥ä½œçš„ã€‚ä½†æ˜¯ï¼Œhoistingä½¿å¾—Javascriptçš„æ‰§è¡Œå®¹æ˜“è¢«è¯¯è§£ã€‚ä¾‹å¦‚ï¼Œhoistingé€šå¸¸è¢«è®¤ä¸ºæ˜¯æŠŠå˜é‡æˆ–è€…æ–¹æ³•åœ¨è¿è¡Œæ—¶ç¯å¢ƒè¢«ç‰©ç†åœ°ç§»åŠ¨åˆ°ä»£ç çš„é¡¶éƒ¨ï¼Œä½†æ˜¯å®é™…ä¸Šå´ä¸æ˜¯è¿™æ ·ã€‚å®é™…ä¸Šå‘ç”Ÿçš„æ˜¯ï¼Œå˜é‡æˆ–è€…æ–¹æ³•çš„å£°æ˜åœ¨ç¼–è¯‘æ—¶å°±è¢«æå‰æ”¾å…¥å†…å­˜ï¼Œè€Œä»£ç ä»ç„¶æ”¾åˆ°åŸæ¥çš„ä½ç½®ä¸Šã€‚ æ¥ä¸‹æ¥ï¼Œé€šè¿‡å‡ ä¸ªä¾‹å­æ¥å¸®åŠ©ç†è§£ æ–¹æ³•æå‡ä¾‹å­å°†æ–¹æ³•çš„å£°æ˜åœ¨ä»»ä½•ä»£ç æ‰§è¡Œä¹‹å‰æ”¾å…¥å†…å­˜çš„å¥½å¤„æ˜¯èƒ½å¤Ÿåœ¨æ–¹æ³•å£°æ˜ä¹‹å‰å°±èƒ½å¤Ÿä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒå·²ç»è¢«æå‰æ”¾å…¥å†…å­˜é‡Œäº†ã€‚ 123456789function catName(name) &#123; console.log("My cat's name is " + name);&#125;catName("Tigger");/*è¿è¡Œç»“æœæ˜¯: "My cat's name is Tigger"*/ ä¸Šé¢çš„ä»£ç æ˜¯ä¸€ä¸ªéå¸¸æ­£å¸¸çš„ä»£ç ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚æœæŠŠè°ƒç”¨æ”¾åˆ°ç”³æ˜ä¹‹å‰ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ 12345678catName("Chloe");function catName(name) &#123; console.log("My cat's name is " + name);&#125;/*è¿è¡Œç»“æœæ˜¯: "My cat's name is Chloe"*/ ç»“æœæ˜¯ï¼Œè·Ÿæˆ‘ä»¬ä¹‹å‰å†™çš„ä»£ç è¿è¡Œçš„ç»“æœä¸€æ¨¡ä¸€æ ·ã€‚è¿™æ˜¯å› ä¸ºJavascriptå°±æ˜¯è¿™ä¹ˆè¿è¡Œçš„ã€‚ å˜é‡æå‡ä¾‹å­1234num = 6;num + 7;var num; /* åªè¦numå£°æ˜è¿‡ï¼Œæ— è®ºå®ƒåœ¨ä»€ä¹ˆä½ç½®ä¸Šï¼Œè¿™ä¸ªä»£ç éƒ½è¿è¡Œæ­£å¸¸*/ æ³¨æ„: Javascript åªæå‡å˜é‡çš„å£°æ˜ï¼Œè€Œä¸æå‡å˜é‡çš„å®šä¹‰ã€‚å¦‚æœä½ åœ¨å£°æ˜å’Œå®šä¹‰ä¹‹å‰è¯•å›¾è·å¾—å˜é‡çš„å€¼ï¼Œä½ ä¼šå¾—åˆ°undefinedã€‚ 12345678910var x = 1; // åˆå§‹åŒ– xconsole.log(x + " " + y); // '1 undefined'ï¼Œå› ä¸ºå®šä¹‰ä¸ä¼šè¢«æå‡var y = 2;// ä¸‹é¢è¿™æ®µä»£ç çš„ç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„var x = 1; // Initialize xvar y; // Declare yconsole.log(x + " " + y); // '1 undefined'y = 2; // Initialize y]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOS memory types]]></title>
    <url>%2F2017%2F07%2F07%2Fios-memory-types%2F</url>
    <content type="text"><![CDATA[iOS memoryClean memoryclean memory are memories that can be recreated, on iOS it is memory of: system framework binary executable of your app memory mapped files Also notice this situation: when your app link to a framework, the clean memory will increase by the size of the framework binary. But most of time, only part of binary is really loaded in physical memory. Dirty memoryAll memory that is not clean memory is dirty memory, dirty memory canâ€™t be recreated by system. When there is a memory pressure, system will unload some clean memory, when the memory is needed again, system will recreate them. But for dirty memory, system canâ€™t unload them, and iOS has no swap mechanism, so dirty memory will always be kept in physical memory, till it reach a certain limit, then your App will be terminated and all memory for it is recycled by system. Virtual memoryvirtual memory = clean memory + dirty memory.That means virtual memory is all the memory your App want. Resident memoryresident memory = dirty memory + clean memory that loaded in physical memoryresident memory is the memory really loaded in your physical memory, it mean all the dirty memory and parts of your clean memory. ConclusionAt any time, this is always true:virtual memory == (clean memory + dirty memory) &gt; resident memory &gt; dirty memoryIf you are worrying about the physical memory your App is taking(which is the key reason your App is terminated due to low memory), you should mainly focus on resident memory.]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŸ¥æ‰¾ç´ æ•°]]></title>
    <url>%2F2017%2F07%2F07%2Ffind-primes%2F</url>
    <content type="text"><![CDATA[ä¸€ä¸ªEratosthenes ç®—æ³•çš„å®ç°è´¨æ•°çš„å®šä¹‰ è´¨æ•°ï¼ˆprime numberï¼‰åˆç§°ç´ æ•°ï¼Œæœ‰æ— é™ä¸ªã€‚è´¨æ•°å®šä¹‰ä¸ºåœ¨å¤§äº1çš„è‡ªç„¶æ•°ä¸­ï¼Œé™¤äº†1å’Œå®ƒæœ¬èº«ä»¥å¤–ä¸å†æœ‰å…¶ä»–å› æ•°ï¼Œè¿™æ ·çš„æ•°ç§°ä¸ºè´¨æ•°ã€‚ ç®—æ³•æ ¸å¿ƒæ€æƒ³ï¼šè¿™ä¸ªç®—æ³•çš„ç›®çš„ä¸»è¦æ˜¯æ‰¾ç»™å®šè‡ªç„¶æ•°Nï¼Œæ‰¾åˆ°Nä»¥å†…çš„æ‰€æœ‰è´¨æ•°ã€‚ä¸‹é¢è¿™ä¸ªç®—æ³•çš„å®ç°çš„æ€æƒ³æ˜¯ï¼šè®¡ç®—å‡ºè´¨æ•°Pï¼Œç„¶åå°†è‡ªç„¶æ•°Nå†…æ‰€æœ‰èƒ½å¤Ÿæ•´é™¤Pçš„æ•°éƒ½å‰”é™¤æ‰ï¼Œä¹‹åè®¡ç®—å‡ºä¸‹ä¸€ä¸ªè´¨æ•°ï¼Œé‡å¤ä»¥ä¸Šè¿‡ç¨‹ç›´åˆ°æ‰€æœ‰æ•°éƒ½éå†è¿‡ä¸€æ¬¡ã€‚ 12345678910111213141516171819202122232425262728293031void findPrimes(bool *isPrimeFlags, const unsigned int n) &#123; isPrimeFlags[1] = false; for (unsigned int i = 2; i &lt; n; i++) &#123; isPrimeFlags[i] = true; &#125; //åˆå§‹åŒ–ï¼Œè®¾ç½®ç¬¬ä¸€ä¸ªç´ æ•°ä¸º2 unsigned int p = 2; //è®¾ç½®jä¸ºpçš„å¹³æ–¹çš„åŸå› æ˜¯ //1. ä¾‹å¦‚ç´ æ•°7ï¼Œèƒ½å¤Ÿæ•´é™¤å®ƒçš„æ•°ä¸º14,21,28,35,42,49,56,63,etc. ä»¥æ­¤ç±»æ¨ï¼Œè®¾èƒ½å¤Ÿæ•´é™¤ //å®ƒçš„æ•°ä¸ºK, åˆ™K = x * 7, è¿™é‡Œx &lt; 7æ—¶ï¼Œæ¯”å¦‚2ï¼Œåœ¨ç®—æ³•å¾ªç¯åˆå§‹çš„æ—¶å€™ï¼Œå·²ç»è¢«è®¾ç½®ä¸ºfalseäº†ï¼Œåˆ™æ²¡å¿…è¦å† //åœ¨ç´ æ•°ä¸º7çš„æ—¶å€™å†æ¯”è¾ƒä¸€æ¬¡äº†ã€‚ //2. p * p å¦‚æœå¤§äºnï¼Œåˆ™èƒ½å¤Ÿæå‰é€€å‡ºè€Œä¸ç”¨éå†æ‰€æœ‰ä»2åˆ°Nçš„ç´ æ•°ã€‚ä¾‹å¦‚æ‰¾100å†…çš„æ‰€æœ‰ç´ æ•°çš„æ—¶å€™ï¼Œæ‰¾åˆ°11çš„æ—¶å€™ï¼Œ //11 * 11 &gt; 100 å°±èƒ½å¤Ÿæå‰é€€å‡ºäº†ã€‚ unsigned int j = p * p; while (j &lt; n) &#123; //å°†æ‰€æœ‰èƒ½å¤Ÿæ•´é™¤pçš„æ•°éƒ½è®¾ç½®ä¸ºfalse while(j &lt; n) &#123; isPrimeFlags[j] = false; j += p; &#125; //æ‰¾åˆ°ä¸‹ä¸€ä¸ªç´ æ•° while(!isPrimeFlags[++p] &amp;&amp; p &lt; n) &#123;&#125; j = p * p; &#125;&#125; Reference:https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[URL&URL encoding]]></title>
    <url>%2F2015%2F10%2F15%2FURL-URL-encoding%2F</url>
    <content type="text"><![CDATA[ä»‹ç»å½“æˆ‘ä»¬æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼Œå…¶ä¸­æ¶‰åŠåˆ°ä¸å°‘æŠ€æœ¯ã€‚å…¶ä¸­ï¼Œæœ‰ä¸€é¡¹æœ€åŸºæœ¬çš„æœºåˆ¶ä½¿å¾—æˆ‘ä»¬å¯ä»¥é¡ºåˆ©çš„åœ¨æµ©ç€šçš„äº’è”ç½‘æµ·æ´‹ä¸­å¿«é€Ÿçš„å®šä½åˆ°æˆ‘ä»¬æƒ³è¦çš„èµ„æºå¹¶æ¥æ”¶æ•°æ®ã€‚è¿™é¡¹æŠ€æœ¯æ˜¯ç½‘é¡µçš„æ ¹æœ¬ï¼Œæ˜¯å½¢æˆäº’è”ç½‘çš„åŸºçŸ³ã€‚å®ƒå°±æ˜¯URLã€‚ URL è‹±æ–‡å…¨å Uniform resource locatorï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ã€‚ä¾‹å¦‚ï¼Œâ€http://www.baidu.comâ€ æ˜¯ä¸€ä¸ªURLã€‚å…³äºURLæ€ä¹ˆå®šä¹‰ï¼Œè¯¥éµå®ˆä»€ä¹ˆè§„åˆ™ï¼Œæ˜¯æœ‰ç€ä¸€å¥—ä¸–ç•Œå…¬è®¤çš„è§„åˆ™çš„ï¼Œç¬¬ä¸€ç‰ˆè§„åˆ™æ˜¯åœ¨1994å¹´è¯ç”Ÿçš„ã€‚ ä¸€èˆ¬URLè¯­æ³•æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼šhttps://jay:123456@www.example.com:8080/file;p=1?q=2#section2 åˆ†è§£è¯¥URLï¼Œæˆ‘ä»¬èƒ½å¤Ÿè·å¾—ä»¥ä¸‹ä¿¡æ¯ï¼š ç»„ä»¶å æ•°æ® scheme https user jay password 123456 host address www.example.com port 8080 path file path parameter p=1 query parameter q=2 fragment section2 HTTP URL è¯­æ³•HTTP URLçš„schemeé€šå¸¸ç»„æˆä¸º Scheme: httpæˆ–è€…https Path: æŒ‡å®šè·å–æ•°æ®çš„è·¯å¾„ Queryå‚æ•°ï¼ˆå¯é€‰ï¼‰ fragmentå‚æ•°ï¼ˆå¯é€‰ï¼‰ Path ä¸ Path parameterså…¶ä¸­ï¼ŒPathè·Ÿæˆ‘ä»¬ç†ŸçŸ¥çš„æ–‡ä»¶è·¯å¾„éå¸¸ç±»ä¼¼ã€‚Pathé€šå¸¸æ˜¯ä»¥ä¸€ä¸ªâ€œ/â€å¼€å¤´ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶å¤¹åˆéƒ½è¢«ä¸€ä¸ªâ€/â€äº’ç›¸åˆ†éš”ï¼Œä¾‹å¦‚â€/Study/URLSyntax/starter/first.docxâ€åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼šâ€studyâ€ï¼Œâ€URLSyntaxâ€ï¼Œâ€starterâ€ï¼Œâ€first.docxâ€ã€‚ æ¯ä¸€ä¸ªPathéƒ¨åˆ†åéƒ½èƒ½å¤Ÿè·Ÿä¸€ä¸ªå¯é€‰çš„å‚æ•°(path parameters)éƒ¨åˆ†ï¼Œåˆ¤æ–­çš„æ ¹æ®æ˜¯ä»¥â€;â€å­—ç¬¦å¼€å§‹ã€‚å‚æ•°å¯ä»¥æœ‰å¤šä¸ªï¼Œå¹¶ä»¥â€;â€åˆ†éš”ã€‚æ¯ä¸ªå‚æ•°éƒ½æœ‰å€¼ï¼Œä»¥â€=â€åˆ†éš”ï¼Œä¾‹å¦‚â€/file;a=1â€ï¼Œå®šä¹‰äº†â€fileâ€è¿™ä¸ªpathçš„å‚æ•°ä¸ºâ€aâ€ï¼Œå€¼ä¸ºâ€1â€ã€‚è¿™äº›å‚æ•°æ˜¯å¾ˆå°‘ç”¨åˆ°çš„ï¼Œä½†æ˜¯ä»–ä»¬æ˜¯ç¡®å®å­˜åœ¨çš„ã€‚ Queryåœ¨Pathåé¢ä»¥â€?â€å¼€å§‹çš„éƒ¨åˆ†å°±æ˜¯Queryäº†ï¼ŒQueryåŒ…å«ä¸€ç»„ä»¥â€&amp;â€åˆ†éš”çš„å‚æ•°ä¸æ•°å€¼å¯¹ã€‚å‚æ•°åŠå…¶æ•°å€¼ä»¥â€=â€åˆ†éš”ã€‚ä¾‹å¦‚ï¼Œâ€?url=http://domain.tld/&amp;title=The title of a postâ€ï¼Œå®šä¹‰äº†ä¸¤ä¸ªå‚æ•°â€urlâ€å’Œâ€titleâ€ï¼Œä»–ä»¬çš„å€¼åˆ†åˆ«ä¸ºâ€http://domain.tldâ€œå’Œâ€The title of a postâ€ã€‚Query ç”¨çš„æœ€å¤šçš„æƒ…å†µæ˜¯æäº¤ä¸€ä¸ªformçš„æ—¶å€™æˆ–è€…æ˜¯æœç´¢çš„æ—¶å€™ã€‚ FragmentFragmentæ˜¯ç”¨æ¥å®šä½åˆ°å½“å‰é¡µé¢æŸä¸€ä¸ªå…·ä½“ä½ç½®çš„urléƒ¨åˆ†ã€‚åœ¨urléƒ¨åˆ†ä»¥â€#â€å¼€å§‹çš„éƒ¨åˆ†ä¸ºfragmentã€‚ URL encodingå¥½äº†ï¼ŒèŠå®ŒURLåŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼Œæ¥ä¸‹æ¥å°±è¦ä»‹ç»URL encodingäº†ã€‚ç»å¸¸ä¸Šç½‘çš„åŒå­¦ä¸€å®šå¯¹ä¸‹é¢è¿™ç§URLä¸é™Œç”Ÿå§ï¼Ÿhttps://www.baidu.com/s?ie=utf-8&amp;f=8&amp;rsv_bp=1&amp;rsv_idx=2&amp;tn=baiduhome_pg&amp;wd=%E7%BA%A2%E7%B1%B3note2&amp;rsv_spt=1&amp;oq=green&amp;rsv_pq=947783b70000 å¯ä»¥çœ‹åˆ°ï¼Œè¯¥URLåŒ…æ‹¬äº†ä¸€äº›ç¥ç§˜çš„å­—ç¬¦ï¼Œä¾‹å¦‚â€wd=%E7%BA%A2%E7%B1%B3note2â€ï¼Œä¸€èˆ¬çš„äººæ˜¯æ— æ³•è¯»çš„ã€‚è¿™å°±æ˜¯è¢«ç¼–ç åçš„æ ·å­äº†ã€‚ ä¸ºä»€ä¹ˆç»™URL ç¼–ç å‘¢ï¼ŸåŸå› å¾ˆç®€å•ï¼Œå› ä¸ºå¦‚æœå…è®¸ä»»æ„å­—ç¬¦çš„è¯ï¼Œè§£æURLçš„ä»»åŠ¡å°†ä¼šéå¸¸è‰°å·¨è€Œä¸”æ•ˆç‡ä½ä¸‹ï¼Œæ¯”å¦‚URLå…è®¸ä¸­æ–‡æˆ–è€…é˜¿æ‹‰ä¼¯æ–‡ã€‚æ‰€ä»¥W3Cç»„ç»‡å°±è§„å®šäº†ä¸€å¥—åè®®ï¼Œç°åœ¨æœ€æ–°çš„åº”è¯¥æ˜¯RFC 3986ï¼Œæœ‰å…´è¶£æ·±å…¥ç ”ç©¶çš„åŒå­¦æ¨èé˜…è¯»ã€‚ç¼–ç å°±æ˜¯å¯¹URLæ¯ä¸ªéƒ¨åˆ†ï¼Œä¸å…è®¸å‡ºç°çš„å­—ç¬¦è¿›è¡Œç¼–ç ã€‚é‚£ä¹ˆå…è®¸çš„å­—ç¬¦æœ‰å“ªäº›å‘¢ï¼Ÿå¦‚ä¸‹æ‰€ç¤ºï¼šæ‘˜å–è‡ª:https://en.wikipedia.org/wiki/Percent-encoding#Types_of_URI_characters. URL encodingä»‹ç»çš„å·®ä¸å¤šäº†ï¼Œç°åœ¨æ¥è®²è®²URL encodingéœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚ URL encoding é™·é˜±RFCæ ‡å‡†ä¸­æ²¡æœ‰æŒ‡æ˜ä½¿ç”¨å“ªç§ç‰¹å®šçš„ç¼–ç æ ¼å¼æ¥å¯¹url è¿›è¡Œç¼–ç ã€‚ä¸€èˆ¬æ¥è¯´ASCIIå­—ç¬¦éƒ½æ˜¯å¯ä»¥è¢«ä½¿ç”¨çš„ï¼Œä½†æ˜¯å¯¹äºä¿ç•™å­—ç¬¦(reserved characters)å’ŒéASCIIå­—ç¬¦ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘éœ€è¦ä½¿ç”¨å“ªç§ç¼–ç æ–¹å¼æ¥è¿›è¡Œç¼–ç ã€‚æœ€æ–°çš„RFCæ ‡å‡†æ˜¯ä½¿ç”¨UTF-8æ¥è¿›è¡Œç¼–ç ã€‚ä½†æ˜¯ï¼Œå¼€å‘è€…ä¹Ÿè®¸ä¹Ÿä¼šé‡åˆ°ä¸æ˜¯ç”¨UTF-8ç¼–ç çš„æ—¶å€™ã€‚ã€‚ã€‚ å¯¹äºHTTP URTsæ¥è¯´ï¼Œç©ºæ ¼ç¬¦å·åœ¨Pathéƒ¨åˆ†ä¼šè¢«ç¼–ç ä¸ºâ€%20â€ï¼Œè€Œâ€+â€æ˜¯ä¸ç”¨è¢«ç¼–ç çš„ã€‚å¯¹äºQueryéƒ¨åˆ†æ¥è¯´ï¼Œç©ºæ ¼ç¬¦å·ä¼šè¢«ç¼–ç ä¸ºâ€+â€æˆ–è€…â€%20â€ï¼Œè€Œâ€+â€ä¼šè¢«ç¼–ç ä¸ºâ€%2Bâ€ã€‚ è¿™æ ·å°±æ„å‘³ç€ä¸€ä¸ªå­—ç¬¦ä¸²åœ¨ä¸åŒçš„éƒ¨åˆ†å°±ä¼šè¢«ç¼–ç ä¸ºä¸åŒçš„å½¢å¼ã€‚ä¾‹å¦‚â€blue+light blueâ€å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼šhttp://example.com/blue+light%20blue?blue%2Blight+blueâ€œã€‚ä»è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºå¦‚æœå¯¹URLè¯­æ³•ä¸ç†Ÿæ‚‰çš„è¯ï¼Œæ˜¯æ— æ³•å¯¹ä¸€ä¸ªURLè¿›è¡Œç¼–ç çš„ã€‚è¦å¯¹URLè¿›è¡Œç¼–ç ï¼Œå°±éœ€è¦çŸ¥é“æ¯ä¸€éƒ¨åˆ†å¯¹åº”çš„ä¿ç•™å­—ç¬¦æ˜¯å“ªäº›è€Œä¸æ˜¯ç®€å•çš„å¯¹URLè¿›è¡Œéå†å¹¶ç¼–ç ã€‚ æ¯ä¸ªéƒ¨åˆ†çš„ä¿ç•™å­—ç¬¦ â€œ?â€åœ¨Queryéƒ¨åˆ†æ˜¯ä¸ç”¨è¢«ç¼–ç çš„ â€œ/â€åœ¨Queryéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ç”¨è¢«ç¼–ç çš„ â€œ:@-._~!$&amp;â€™()*+,;=â€åœ¨Pathéƒ¨åˆ†æ˜¯ä¸ç”¨è¢«ç¼–ç çš„ â€œ/?:@-._~!$&amp;â€™()*+,;=â€åœ¨fragmentéƒ¨åˆ†æ˜¯ä¸ç”¨è¢«ç¼–ç çš„ è§£ç åçš„URLæ— æ³•è¢«æ­£ç¡®åˆ†æé€šè¿‡ä¸€ä¸ªä¾‹å­æ¥åˆ†ææ›´æ¸…æ¥šï¼šâ€http://example.com/blue%2Fred%3Fand+greenâ€ è¯¥URLæœ‰å¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š éƒ¨åˆ† å€¼ scheme http host example.com path blue%2Fred%3Fand+green è§£ç åçš„path blue/red?and+green åˆ†æåï¼Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬æ˜¯åœ¨æ‰¾ä¸€ä¸ªâ€blue/red?and+greenâ€çš„èµ„æºï¼Œè€Œä¸æ˜¯æ‰¾ä¸€ä¸ªåœ¨blueæ–‡ä»¶å¤¹ä¸‹çš„â€red?and+greenâ€çš„èµ„æºã€‚ å¦‚æœæˆ‘ä»¬é¦–å…ˆå¯¹URLè§£ç ï¼Œç„¶åå†åˆ†æå‘¢ï¼Ÿè§£ç åçš„URL:â€http://example.com/blue/red?and+greenâ€ éƒ¨åˆ† å€¼ scheme http host example.com path blue/red query parameter name and+green å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªæ˜¯é”™è¯¯çš„ã€‚è¿™ä¸ªä¾‹å­å‘Šè¯‰æˆ‘ä»¬ï¼Œåˆ†æå¹¶æ‹†è§£ä¸€ä¸ªURLå¿…é¡»è¦åœ¨è§£ç ä¹‹å‰è¿›è¡Œã€‚ è§£ç åçš„URLæœ‰å¯èƒ½æ— æ³•è¢«ç¼–ç å›åŸæ¥çš„æ ¼å¼å¦‚æœå¯¹â€http://example.com/blue%2Fred%3Fand+greenâ€œè§£ç ï¼Œä½ å°†å¾—åˆ°â€http://example.com/blue/red?and+greenâ€œï¼Œç„¶ååˆè¿›è¡Œç¼–ç ï¼Œä½ å°†å¾—åˆ°â€http://example.com/blue/red?and+greenâ€œï¼Œå› ä¸ºè¿™ä¸ªæ˜¯åˆæ³•çš„URLä¸éœ€è¦è¿›è¡Œcharacter escapeã€‚ å‚è€ƒåŸæ–‡ï¼šhttp://blog.lunatech.com/2009/02/03/what-every-web-developer-must-know-about-url-encoding]]></content>
      <categories>
        <category>http</category>
      </categories>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Objective-C Dynamic binding ç ”ç©¶]]></title>
    <url>%2F2015%2F09%2F22%2Fobjc-dynamic-binding%2F</url>
    <content type="text"><![CDATA[Objective-C Dynamic binding ç ”ç©¶å¯¹äºä¹ æƒ¯ç¼–å†™é™æ€ç¼–ç¨‹è¯­è¨€(C#/java/C++)çš„åŒå­¦ï¼Œåˆè¯†Objective-Cï¼Œå¯èƒ½ä¼šè·Ÿæˆ‘æœ‰ä¸€æ ·çš„è¿·æƒ‘ã€‚ä»€ä¹ˆè¿·æƒ‘å‘€ï¼Ÿè¯·çœ‹ä¸‹é¢è¿™æ®µocçš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435@interface MyObject : NSObject+ (id)factoryMethod;-(NSString*)tell;@end@implementation MyObject+ (id)factoryMethodB &#123; return [[[self class] alloc] init]; &#125;- (NSString*)tell&#123; return @"I'm MyObject";&#125;@end@interface MyOtherObject : NSObject-(void)say;-(NSString*)tell;@end@implementation MyOtherObject-(void)say&#123; NSLog(@"Hello world");&#125;-(NSString*)tell&#123; return @"I'm MyOtherObject";&#125;@endvoid DoSometing()&#123; MyOtherObject *obj = [MyObject factoryMethod]; (1) NSLog(@"%@",[obj tell]); (2) [obj say]; (3)&#125; ä»£ç é¡ºåˆ©é€šè¿‡ç¼–è¯‘ã€‚è°ƒç”¨DoSomethingï¼Œè¿è¡Œåˆ°ç¬¬(3)è¡Œæ—¶å‡ºé”™ã€‚å…ˆæ¥çœ‹ç¬¬ï¼ˆ1ï¼‰è¡Œï¼Œæˆ‘æ‰“èµŒè¿™è¡Œå·²ç»è®©åªç†Ÿæ‚‰é™æ€è¯­è¨€çš„ç¨‹åºå‘˜ä»¬ä¸æ˜ç™½äº†ï¼Œå› ä¸ºç…§ç†æ¥è¯´ï¼ŒMyObjectçš„factoryMethodè¿”å›çš„æ˜¯è‡ªå·±çš„å®ä¾‹ï¼Œè¦æ˜¯ç”¨åˆ«çš„è¯­è¨€ç¼–å†™ï¼Œç¼–è¯‘å™¨ç¬¬(1)è¡Œå°±æŠ¥é”™äº†ï¼Œå› ä¸ºç±»å‹ä¸åŒ¹é…å‘€ã€‚ä¸ºä»€ä¹ˆOCçš„ç¼–è¯‘å™¨ä¸æŠ¥é”™å‘¢ï¼Ÿä¸æ€¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªè¿”å›å€¼idçš„å®šä¹‰ï¼š Objective-C provides a special type that can hold a pointer to anyobject you can construct with Objective-Câ€”regardless of class. Thistype is called id, and can be used to make your Objective-Cprogramming generic. ï¼ˆå¤§è‡´æ„æ€å°±æ˜¯idæ˜¯ä¸€ä¸ªä¸ç±»å‹æ— å…³çš„æŒ‡å‘ä»»æ„å¯¹è±¡çš„ä¸œä¸œã€‚èƒ½å¤Ÿè®©ä½ OCç¼–ç¨‹æ³›å‹åŒ–ã€‚ï¼‰ å‡ ä¸ªæ„æ€å‘¢ï¼Ÿå…¶å®idå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œä½†æ˜¯å®ƒåˆä¸åŒäºc/c++é‡Œé¢çš„voidã€‚voidæ˜¯æŒ‡å‘å†…å­˜ä¸­ä»»æ„å—çš„æœªçŸ¥å¯¹è±¡æˆ–è€…æœªçŸ¥å†…å®¹çš„ã€‚idå¾ˆæ˜ç¡®ï¼Œå®ƒå°±æ˜¯ç”¨æ¥æŒ‡å‘OCå¯¹è±¡çš„ã€‚ï¼ˆå…³äºvoid*æ˜¯å¦èƒ½è½¬æ¢ä¸ºOCå¯¹è±¡è¿™é‡Œæš‚æ—¶ä¸è®¨è®ºï¼‰ã€‚å¥½äº†ï¼Œè¿™å°±è§£é‡Šäº†ç¬¬(1)è¡Œçš„å¯è¡Œæ€§ã€‚ è¿è¡Œåˆ°ç¬¬äºŒè¡Œçš„æ—¶å€™ï¼ŒNSLogè¾“å‡º: Iâ€™m MyObject å®ƒå±…ç„¶æ­£ç¡®çš„è°ƒç”¨äº†MyObjectçš„tellæ–¹æ³•ï¼è¿™å°±è¦Dynamic bindingï¼ˆåŠ¨æ€ç»‘å®šï¼‰çŸ¥è¯†æ¥è§£é‡Šäº†ï¼š Dynamic binding means that when we call a certain objectâ€™s method, and there are several implementations of that method, the right one is figured out at runtime. In Objective-C, this idea is used, but is also extended - you are permitted to send any message to any object. At first glance this may sound rather dangerous, but in fact this allows you a lot of flexibility. ï¼ˆå¤§æ„æ˜¯ï¼šOCçš„åŠ¨æ€ç»‘å®šçš„æ„æ€æ˜¯OCæ‰©å±•äº†Dynamic bindingï¼Œä½¿ç¼–ç¨‹äººå‘˜èƒ½å¤Ÿè¢«å…è®¸å‘é€ä»»ä½•æ¶ˆæ¯ç»™ä»»ä½•å¯¹è±¡ã€‚å’‹ä¸€å¬è¿™ç§æ‰©å±•éå¸¸å±é™©ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒå¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼ï¼‰ ç”±äºMyOtherObject*ä»…ä»…æ˜¯å£°æ˜ä¸€ä¸ªæŒ‡é’ˆï¼Œè¢«èµ‹äºˆidã€‚æ‰€ä»¥ç¬¬(2)è¡Œæ€ä¹ˆæ‰§è¡Œæ˜¯åœ¨è¿è¡Œæ—¶å†³å®šçš„ï¼Œæ‰€ä»¥[obj tell]ä¹Ÿå°±é¡ºç†æˆç« èƒ½å¤Ÿæ¯«æ— é”™è¯¯çš„è¿è¡Œäº†ã€‚ ç¬¬(3)è¡Œè¿è¡Œçš„æ—¶å€™ï¼ŒæŠ¥é”™: unrecognized selector sent to instance 0x100400100 ç»“åˆä¸Šé¢çš„çŸ¥è¯†ï¼Œå¾ˆå®¹æ˜“åˆ¤æ–­ï¼Œå› ä¸ºMyOtherObjectæœ‰sayæ–¹æ³•ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨é€šè¿‡ã€‚ä½†æ˜¯è¿è¡Œæ—¶ï¼Œå…¶å®æŒ‡é’ˆçš„å†…å®¹æ˜¯MyObjectï¼ŒMyObjectå¹¶æ²¡æœ‰å£°æ˜sayæ–¹æ³•ï¼Œæ‰€ä»¥å°±æŠ¥é”™äº†ã€‚ å…³äºDynamic bindingè¿˜æœ‰ä¸ªæ›´æœ‰è¶£çš„ä¾‹å­ï¼Œè¯·çœ‹ï¼š 123456789101112131415161718192021@interface LinkedListNode : NSObject@property id data;@property LinkedListNode * child;@end@implementation LinkedListNode@endvoid DoSometing2()&#123; LinkedListNode *p = [[LinkedListNode alloc] init]; p.data = [MyOtherObject new]; LinkedListNode *child = [LinkedListNode new]; child.data = [MyObject new]; p.child = child; LinkedListNode *node; for (node = p; node != nil; node = node.child) &#123; [[node data] say]; &#125;&#125; ç¼–è¯‘ï¼Œæ²¡ä»»ä½•é”™è¯¯ã€‚è¿è¡Œï¼ŒæŠ¥çš„æ˜¯è·Ÿä¸Šé¢(3)ä¸€æ ·çš„é”™è¯¯ã€‚åŒæ ·çš„åŸå› ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿä½ å¯èƒ½ä¼šæƒ³ï¼Œå¤ªçµæ´»äº†ï¼Œå¤ªå®¹æ˜“å‡ºé”™äº†ã€‚å¹¸å¥½ï¼Œæœ‰è§£å†³çš„åŠæ³•ï¼š 1234567891011121314LinkedListNode *p = [LinkedListNode new];p.data = [MyOtherObject new]; LinkedListNode *child = [LinkedListNode new]; child.data = [MyObject new]; p.child = child; LinkedListNode *node; for (node = p; node != nil; node = node.child) &#123; if ([[node data] respondsToSelector:@selector(say)]) &#123; [[node data] say]; &#125; &#125; &#125; å¦å¤–ï¼Œè¿˜å¯ä»¥åˆ¤æ–­æ˜¯å¦æ˜¯æŸä¸€ç‰¹å®šç±»ï¼š 123if ([node isKindOfClass:[MyOtherObject class]]) &#123; [[node data] say]; &#125; ä¸Šè¿°ä¾‹å­çš„factoryMethodçš„è¿”å›å€¼idï¼Œè‹¹æœå·²ç»ä¸æ¨èè¿™ä¹ˆç”¨äº†ã€‚è‹¹æœæ¨èè¿”å›instancetypeã€‚å®ƒè·Ÿidç”¨æ³•ä¸€æ ·ï¼Œä½†æ˜¯ä¸»è¦æ˜¯ç”¨åœ¨alloc, initæˆ–è€…ç±»çš„å·¥å‚æ–¹æ³•ä¸Šçš„ã€‚å®ƒçš„å¥½å¤„æ˜¯ ç¼–è¯‘å™¨èƒ½å¤Ÿæ£€æµ‹è¢«è°ƒç”¨çš„å¯¹è±¡ä¸Šæ˜¯å¦èƒ½å¤Ÿååº”ä¼ å…¥çš„æ¶ˆæ¯ï¼Œå¦‚æœä¸èƒ½ï¼Œåˆ™å‘å‡ºè­¦å‘Šã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>objective-c</tag>
      </tags>
  </entry>
</search>
